import{V as I,aw as _}from"./B34q5ZhI.js";import{i as E,b as x}from"./B3FnF0oJ.js";import"./DumpmRuy.js";function J(e,n){var t=e.$$events?.[n.type],s=I(t)?t.slice():t==null?[]:[t];for(var a of s)a.call(this,n)}const z=globalThis.__sveltekit_2mu9iq.env;async function P(e){let n;try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);n=await t.text()}catch(t){throw new Error(`Failed to fetch plugin: ${t.message}`)}return new Promise((t,s)=>{const a=Math.random().toString(36).substring(7),i=document.createElement("iframe");i.style.display="none",i.setAttribute("sandbox","allow-scripts");let r;const o=()=>{r&&clearTimeout(r),window.removeEventListener("message",d),document.body.contains(i)&&document.body.removeChild(i)},d=b=>{const c=b.data;if(!c||c.type!=="furnarchy-plugin-register"||c.requestId!==a)return;const l=c.plugin;if(!l.id||!l.name||!l.version){o(),s(new Error("Plugin registered but missing id, name, or version"));return}t({id:l.id,name:l.name,description:l.description,version:l.version,author:l.author,sourceUrl:e,toggle:l.toggle}),o()};window.addEventListener("message",d);const S=`
            window.Furnarchy = {
                version: '0.0.0-sandbox',
                loadingPluginUrl: ${JSON.stringify(e)},
                register: function(meta, arg) {
                    if (typeof arg === 'function') {
                        // Send metadata immediately
                        window.parent.postMessage({
                            type: 'furnarchy-plugin-register',
                            requestId: '${a}',
                            plugin: meta
                        }, '*');

                        const api = {
                            send: function() {},
                            inject: function() {},
                            notify: function() {},
                            disable: function() {},
                            onIncoming: function() {},
                            onOutgoing: function() {},
                            onLoggedIn: function() {},
                            onPause: function() {},
                            onLoad: function() {}
                        };
                        try { arg(api); } catch(e) {}
                    }
                },
                onRegister: function() {},
                send: function() {}
            };
        `,v=`
            try {
                const content = decodeURIComponent(escape(atob('${btoa(unescape(encodeURIComponent(n)))}')));
                const script = document.createElement('script');
                script.textContent = content;
                document.body.appendChild(script);
            } catch(e) {
                console.error('Sandbox execution error:', e);
            }
        `,w=`
            <!DOCTYPE html>
            <html>
            <head>
                <script>${S}<\/script>
            </head>
            <body>
                <script>${v}<\/script>
            </body>
            </html>
        `;i.srcdoc=w,document.body.appendChild(i),r=setTimeout(()=>{o(),s(new Error("Plugin load timed out (5s) - did not call Furnarchy.register()?"))},5e3)})}const N=["/plugins/life-support.js","/plugins/auto-spinner.js","/plugins/wire-shrek.js","/plugins/stalker.js","/plugins/fly.js","/plugins/hush.js","/plugins/notifier.js","/plugins/markdown-chat.js","/plugins/color-copy.js","/plugins/chat-enhance.js","/plugins/roll-troll.js","/plugins/remote-furc.js","/plugins/seek.js"],u="furnarchy_plugins",f="furnarchy_deleted_plugins",g="furnarchy_auth_url",p="furnarchy_version",m="furnarchy_zoom_settings",h=_([]);function A(){if(typeof localStorage>"u")return{zoomLevel:1.5,fitWidth:!1};const e=localStorage.getItem(m);if(!e)return{zoomLevel:1.5,fitWidth:!1};try{return JSON.parse(e)}catch{return{zoomLevel:1.5,fitWidth:!1}}}function M(e){typeof localStorage>"u"||localStorage.setItem(m,JSON.stringify(e))}function y(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(f);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function D(e){if(typeof localStorage>"u")return;const n=y();n.includes(e)||(n.push(e),localStorage.setItem(f,JSON.stringify(n)))}function O(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(u);if(!e)return[];try{const n=JSON.parse(e);return Array.isArray(n)?n.map(t=>typeof t=="string"?{url:t}:t):[]}catch(n){return console.error("Failed to load plugins",n),[]}}function k(e){typeof localStorage>"u"||(localStorage.setItem(u,JSON.stringify(e)),h.set(e))}function F(e,n){h.update(t=>{const s=t.findIndex(o=>o.url===e);if(s===-1)return t;const a=t[s],i={...a,...n};if(JSON.stringify(a)===JSON.stringify(i))return t;const r=[...t];return r[s]=i,typeof localStorage<"u"&&localStorage.setItem(u,JSON.stringify(r)),r})}function Y(){return typeof localStorage>"u"?null:localStorage.getItem(g)}function K(e){typeof localStorage>"u"||localStorage.setItem(g,e)}function L(){return typeof localStorage>"u"?null:localStorage.getItem(p)}function j(e){typeof localStorage>"u"||localStorage.setItem(p,e)}async function R(e){if(typeof localStorage>"u")return;const n=L();let t=O();const s=y();let a=!1;const i=[...N];for(const r of i)if(!t.some(o=>o.url===r))try{const o=await P(r);if(s.includes(o.id)){console.log(`Skipping deleted default plugin: ${o.name} (${o.id})`);continue}t.push({id:o.id,url:r,name:o.name,description:o.description,version:o.version,author:o.author,enabled:typeof o.toggle=="boolean"?!o.toggle:!0,toggle:o.toggle}),a=!0}catch(o){console.error(`Failed to load default plugin ${r}:`,o)}a&&k(t),n!==e&&j(e)}var U=E('<svg width="16.933332mm" height="16.933336mm" viewBox="0 0 16.933332 16.933336" version="1.1" id="svg1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><defs id="defs1"></defs><g id="layer1" transform="translate(-78.987757,-57.85233)"><g style="overflow:hidden;fill:currentColor" id="g1" transform="matrix(0.26458333,0,0,0.26458333,-30.427081,12.964585)"><g id="g2" transform="matrix(0.07161125,0,0,0.07161125,408.88215,164.97088)"><path d="m 950.70753,449.97413 v 126.85714 c 0,4.57143 -1.52381,8.95238 -4.57143,13.14286 -3.04761,4.19047 -6.85714,6.66666 -11.42857,7.42857 l -105.71428,16 c -7.2381,20.57143 -14.66667,37.90476 -22.28572,52 13.33333,19.04762 33.71429,45.33333 61.14286,78.85714 3.80953,4.57143 5.71429,9.33333 5.71429,14.28571 0,4.95239 -1.71429,9.33334 -5.14286,13.14286 -10.28571,14.09524 -29.14286,34.66667 -56.57143,61.71429 -27.42857,27.04762 -45.33334,40.57143 -53.71429,40.57143 -4.57143,0 -9.52381,-1.71429 -14.85714,-5.14286 l -78.85714,-61.71429 c -16.76191,8.76191 -34.09524,16 -52,21.71429 -6.09524,51.80952 -11.61905,87.23809 -16.57143,106.28571 -2.66667,10.66667 -9.52381,16 -20.57143,16 H 448.42182 c -5.33333,0 -10,-1.61905 -14,-4.85714 -4,-3.23809 -6.19048,-7.33333 -6.57143,-12.28571 l -16,-105.14286 c -18.66667,-6.09524 -35.80952,-13.14286 -51.42857,-21.14286 l -80.57143,61.14286 c -3.80953,3.42857 -8.57143,5.14286 -14.28572,5.14286 -5.33333,0 -10.09524,-2.09524 -14.28571,-6.28572 -48,-43.42857 -79.42857,-75.42857 -94.28571,-96 -2.66667,-3.80952 -4,-8.19047 -4,-13.14286 0,-4.57143 1.52381,-8.95238 4.57143,-13.14285 5.71428,-8 15.42856,-20.66667 29.14285,-38 13.71429,-17.33333 24,-30.76191 30.85715,-40.28572 -10.28572,-19.04762 -18.09525,-37.90476 -23.42858,-56.57143 L 89.564678,595.11698 c -4.952381,-0.7619 -8.952381,-3.14285 -12,-7.14285 -3.047619,-4 -4.571429,-8.47619 -4.571429,-13.42857 V 447.68841 c 0,-4.57143 1.52381,-8.95238 4.571429,-13.14285 3.047619,-4.19048 6.666667,-6.66667 10.857143,-7.42858 l 106.285709,-16 c 5.33333,-17.52381 12.76191,-35.04761 22.28572,-52.57142 -15.2381,-21.71429 -35.61905,-48 -61.14286,-78.85715 -3.80953,-4.57143 -5.71429,-9.14285 -5.71429,-13.71428 0,-3.80953 1.71429,-8.19048 5.14286,-13.14286 9.90476,-13.71429 28.66666,-34.19048 56.28571,-61.42857 27.61905,-27.23809 45.61905,-40.85714 54,-40.85714 4.95239,0 9.90477,1.90476 14.85715,5.71428 l 78.85714,61.14286 c 16.76191,-8.76191 34.09524,-16 52,-21.71429 6.09524,-51.80952 11.61905,-87.23809 16.57143,-106.285708 2.66667,-10.666667 9.52381,-16 20.57143,-16 h 126.85714 c 5.33333,0 10,1.619048 14,4.857143 4,3.238095 6.19048,7.333333 6.57143,12.285714 l 16,105.142851 c 18.66667,6.09524 35.80952,13.14286 51.42857,21.14286 l 81.14286,-61.14286 c 3.42857,-3.42857 8,-5.14285 13.71428,-5.14285 4.95239,0 9.71429,1.90476 14.28572,5.71428 49.14285,45.33333 80.57142,77.71429 94.28571,97.14286 2.66667,3.04762 4,7.2381 4,12.57143 0,4.57143 -1.52381,8.95238 -4.57143,13.14285 -5.71429,8 -15.42857,20.66667 -29.14285,38 -13.71429,17.33333 -24,30.76191 -30.85715,40.28572 9.90477,19.04762 17.71429,37.71429 23.42857,56 l 104.57143,16 c 4.95238,0.76191 8.95238,3.14286 12,7.14286 3.04762,4 4.57143,8.47619 4.57143,13.42857 z" id="path1" style="fill:currentColor;stroke-width:16;stroke-dasharray:none;"></path><path style="font-weight:bold;font-size:585.303px;line-height:0;letter-spacing:182.908px;fill:white;stroke-width:3.77953;stroke-linecap:square" d="m 513.02075,729.40751 q -43.89772,0 -73.74818,-16.38848 -29.85045,-16.38849 -47.40954,-45.65363 -17.55909,-29.26515 -25.16803,-69.06576 -7.60893,-39.8006 -7.60893,-86.03953 0,-46.82424 7.60893,-86.03954 7.60894,-39.8006 25.16803,-69.06575 17.55909,-29.26515 47.40954,-45.65364 29.85046,-16.38848 73.74818,-16.38848 43.89772,0 73.16287,16.38848 29.85045,16.38849 46.82424,45.65364 16.97379,29.26515 23.99742,69.06575 7.60894,39.2153 7.60894,86.03954 0,46.23893 -7.60894,86.03953 -7.02363,39.80061 -23.99742,69.06576 -16.97379,29.26514 -46.82424,45.65363 -29.26515,16.38848 -73.16287,16.38848 z M 435.17545,511.6748 q 0,22.24152 0.58531,41.55651 1.1706,18.7297 4.09712,35.11818 l 118.8165,-205.44134 q -16.97379,-12.87667 -45.65363,-12.87667 -33.36227,0 -50.33606,18.7297 -16.38848,18.72969 -22.24151,50.92136 -5.26773,32.19166 -5.26773,71.99226 z m 77.8453,142.81393 q 33.36227,0 49.16545,-18.7297 16.38848,-19.31499 21.07091,-51.50666 5.26772,-32.77696 5.26772,-72.57757 0,-21.0709 -0.5853,-39.2153 -0.5853,-18.72969 -2.92651,-33.94757 l -117.6459,203.10013 q 16.97378,12.87667 45.65363,12.87667 z" id="text1" aria-label="0"></path></g></g></g></svg>');function V(e){var n=U();x(e,n)}export{V as M,Y as a,K as b,J as c,R as d,z as e,A as f,O as g,M as h,D as m,h as p,k as s,F as u,P as v};
