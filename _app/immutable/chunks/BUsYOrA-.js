import{V as ie,m as p,W as le,a as z,b as fe,Y as ce,Z as ue,_ as J,$ as Y,a0 as O,R as M,ad as de,aO as ge,aw as ve,J as T,Q as R,O as K,U as he,a3 as me,ao as H,aM as W,aR as G,aS as pe,K as Z,N as _e,aT as ye,aU as Se,aV as x,ae as be,aW as Ee,aX as we,aL as Ie,M as ke,q as Ne,aY as Te,aZ as Ae,a_ as Le,a$ as Me,b0 as Oe,b1 as B,ai as xe,u as j,r as X,b2 as Ce,af as Pe}from"./ClPHtEvL.js";import{a as Ue}from"./M9_E9NUF.js";import{i as Re,a as De}from"./B-NAx5GU.js";import"./C-bUfnIF.js";function rt(e,t){return t}function $e(e,t,r){for(var l=[],o=t.length,a=0;a<o;a++)Ee(t[a].e,l,!0);we(l,()=>{var s=l.length===0&&r!==null;if(s){var n=r,c=n.parentNode;Ie(c),c.append(n),e.items.clear(),m(e,t[0].prev,t[o-1].next)}for(var i=0;i<o;i++){var u=t[i];s||(e.items.delete(u.k),m(e,u.prev,u.next)),ke(u.e,!s)}e.first===t[0]&&(e.first=t[0].prev)})}function nt(e,t,r,l,o,a=null){var s=e,n=new Map,c=null;p&&le();var i=null,u=fe(()=>{var h=r();return G(h)?h:h==null?[]:W(h)}),d,v=!0;function _(){qe(g,d,s,t,l),i!==null&&(d.length===0?(i.fragment?(s.before(i.fragment),i.fragment=null):Z(i.effect),f.first=i.effect):_e(i.effect,()=>{i=null}))}var f=ie(()=>{d=z(u);var h=d.length;let E=!1;if(p){var y=ce(s)===ue;y!==(h===0)&&(s=J(),Y(s),O(!1),E=!0)}for(var A=new Set,w=T,k=null,N=he(),b=0;b<h;b+=1){p&&M.nodeType===de&&M.data===ge&&(s=M,E=!0,O(!1));var L=d[b],I=l(L,b),S=v?null:n.get(I);S?(ve(S.v,L),S.i=b,N&&w.skipped_effects.delete(S.e)):(S=ze(v?s:null,k,L,I,b,o,t,r),v&&(S.o=!0,k===null?c=S:k.next=S,k=S),n.set(I,S)),A.add(I)}if(h===0&&a&&!i)if(v)i={fragment:null,effect:R(()=>a(s))};else{var $=document.createDocumentFragment(),q=K();$.append(q),i={fragment:$,effect:R(()=>a(q))}}if(p&&h>0&&Y(J()),!v)if(N){for(const[oe,se]of n)A.has(oe)||w.skipped_effects.add(se.e);w.oncommit(_),w.ondiscard(()=>{})}else _();E&&O(!0),z(u)}),g={effect:f,items:n,first:c};v=!1,p&&(s=M)}function qe(e,t,r,l,o){var a=t.length,s=e.items,n=e.first,c,i=null,u=[],d=[],v,_,f,g;for(g=0;g<a;g+=1){if(v=t[g],_=o(v,g),f=s.get(_),e.first??=f,!f.o){f.o=!0;var h=i?i.next:n;m(e,i,f),m(e,f,h),C(f,h,r),i=f,u=[],d=[],n=i.next;continue}if((f.e.f&x)!==0&&Z(f.e),f!==n){if(c!==void 0&&c.has(f)){if(u.length<d.length){var E=d[0],y;i=E.prev;var A=u[0],w=u[u.length-1];for(y=0;y<u.length;y+=1)C(u[y],E,r);for(y=0;y<d.length;y+=1)c.delete(d[y]);m(e,A.prev,w.next),m(e,i,A),m(e,w,E),n=E,i=w,g-=1,u=[],d=[]}else c.delete(f),C(f,n,r),m(e,f.prev,f.next),m(e,f,i===null?e.first:i.next),m(e,i,f),i=f;continue}for(u=[],d=[];n!==null&&n.k!==_;)(n.e.f&x)===0&&(c??=new Set).add(n),d.push(n),n=n.next;if(n===null)continue;f=n}u.push(f),i=f,n=f.next}let k=s.size>a;if(n!==null||c!==void 0){for(var N=c===void 0?[]:W(c);n!==null;)(n.e.f&x)===0&&N.push(n),n=n.next;var b=N.length;if(k=s.size-b>a,b>0){var L=null;$e(e,N,L)}}if(k)for(const I of s.values())I.o||(m(e,i,I),i=I);e.effect.last=i&&i.e}function ze(e,t,r,l,o,a,s,n){var c=(s&ye)!==0,i=(s&Se)===0,u=c?i?me(r,!1,!1):H(r):r,d=(s&pe)===0?o:H(o),v={i:d,v:u,k:l,a:null,e:null,o:!1,prev:t,next:null};try{if(e===null){var _=document.createDocumentFragment();_.append(e=K())}return v.e=R(()=>a(e,u,d,n)),t!==null&&(t.next=v),v}finally{}}function C(e,t,r){for(var l=e.next?e.next.e.nodes_start:r,o=t?t.e.nodes_start:r,a=e.e.nodes_start;a!==null&&a!==l;){var s=be(a);o.before(a),a=s}}function m(e,t,r){t===null?(e.first=r,e.effect.first=r&&r.e):(t.e.next&&(t.e.next.prev=null),t.next=r,t.e.next=r&&r.e),r!==null&&(r.e.prev&&(r.e.prev.next=null),r.prev=t,r.e.prev=t&&t.e)}function at(e,t,r,l,o,a){var s=e.__className;if(p||s!==r||s===void 0){var n=Ue(r,l,a);(!p||n!==e.getAttribute("class"))&&(n==null?e.removeAttribute("class"):e.className=n),e.__className=r}else if(a&&o!==a)for(var c in a){var i=!!a[c];(o==null||i!==!!o[c])&&e.classList.toggle(c,i)}return a}const Je=Symbol("is custom element"),Ye=Symbol("is html");function ot(e){if(p){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var l=e.value;V(e,"value",null),e.value=l}if(e.hasAttribute("checked")){var o=e.checked;V(e,"checked",null),e.checked=o}}};e.__on_r=r,Ne(r),Te()}}function V(e,t,r,l){var o=He(e);p&&(o[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||o[t]!==(o[t]=r)&&(t==="loading"&&(e[Ae]=r),r==null?e.removeAttribute(t):typeof r!="string"&&Ve(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function He(e){return e.__attributes??={[Je]:e.nodeName.includes("-"),[Ye]:e.namespaceURI===Le}}var F=new Map;function Ve(e){var t=e.getAttribute("is")||e.nodeName,r=F.get(t);if(r)return r;F.set(t,r=[]);for(var l,o=e,a=Element.prototype;a!==o;){l=Oe(o);for(var s in l)l[s].set&&r.push(s);o=Me(o)}return r}function st(e,t,r=t){var l=new WeakSet;B(e,"input",async o=>{var a=o?e.defaultValue:e.value;if(a=P(e)?U(a):a,r(a),T!==null&&l.add(T),await xe(),a!==(a=t())){var s=e.selectionStart,n=e.selectionEnd,c=e.value.length;if(e.value=a??"",n!==null){var i=e.value.length;s===n&&n===c&&i>c?(e.selectionStart=i,e.selectionEnd=i):(e.selectionStart=s,e.selectionEnd=Math.min(n,i))}}}),(p&&e.defaultValue!==e.value||j(t)==null&&e.value)&&(r(P(e)?U(e.value):e.value),T!==null&&l.add(T)),X(()=>{var o=t();if(e===document.activeElement){var a=Ce??T;if(l.has(a))return}P(e)&&o===U(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function it(e,t,r=t){B(e,"change",l=>{var o=l?e.defaultChecked:e.checked;r(o)}),(p&&e.defaultChecked!==e.checked||j(t)==null)&&r(e.checked),X(()=>{var l=t();e.checked=!!l})}function P(e){var t=e.type;return t==="number"||t==="range"}function U(e){return e===""?null:+e}function lt(e){return function(...t){var r=t[0];return r.stopPropagation(),e?.apply(this,t)}}function ft(e,t){var r=e.$$events?.[t.type],l=G(r)?r.slice():r==null?[]:[r];for(var o of l)o.call(this,t)}const ct=globalThis.__sveltekit_1ma2k9o.env;async function Fe(e){let t;try{const r=await fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status}`);t=await r.text()}catch(r){throw new Error(`Failed to fetch plugin: ${r.message}`)}return new Promise((r,l)=>{const o=Math.random().toString(36).substring(7),a=document.createElement("iframe");a.style.display="none",a.setAttribute("sandbox","allow-scripts");let s;const n=()=>{s&&clearTimeout(s),window.removeEventListener("message",c),document.body.contains(a)&&document.body.removeChild(a)},c=_=>{const f=_.data;if(!f||f.type!=="furnarchy-plugin-register"||f.requestId!==o)return;const g=f.plugin;if(!g.id||!g.name||!g.version){n(),l(new Error("Plugin registered but missing id, name, or version"));return}r({id:g.id,name:g.name,description:g.description,version:g.version,author:g.author,sourceUrl:e,toggle:g.toggle}),n()};window.addEventListener("message",c);const i=`
            window.Furnarchy = {
                version: '0.0.0-sandbox',
                loadingPluginUrl: ${JSON.stringify(e)},
                register: function(meta, arg) {
                    if (typeof arg === 'function') {
                        // Send metadata immediately
                        window.parent.postMessage({
                            type: 'furnarchy-plugin-register',
                            requestId: '${o}',
                            plugin: meta
                        }, '*');

                        const api = {
                            send: function() {},
                            inject: function() {},
                            notify: function() {},
                            disable: function() {},
                            onIncoming: function() {},
                            onOutgoing: function() {},
                            onLoggedIn: function() {},
                            onPause: function() {},
                            onLoad: function() {}
                        };
                        try { arg(api); } catch(e) {}
                    }
                },
                onRegister: function() {},
                send: function() {}
            };
        `,d=`
            try {
                const content = decodeURIComponent(escape(atob('${btoa(unescape(encodeURIComponent(t)))}')));
                const script = document.createElement('script');
                script.textContent = content;
                document.body.appendChild(script);
            } catch(e) {
                console.error('Sandbox execution error:', e);
            }
        `,v=`
            <!DOCTYPE html>
            <html>
            <head>
                <script>${i}<\/script>
            </head>
            <body>
                <script>${d}<\/script>
            </body>
            </html>
        `;a.srcdoc=v,document.body.appendChild(a),s=setTimeout(()=>{n(),l(new Error("Plugin load timed out (5s) - did not call Furnarchy.register()?"))},5e3)})}const Ke=["/plugins/life-support.js","/plugins/auto-spinner.js","/plugins/wire-shrek.js","/plugins/stalker.js","/plugins/fly.js","/plugins/hush.js","/plugins/notifier.js","/plugins/markdown-chat.js"],D="furnarchy_plugins",Q="furnarchy_deleted_plugins",ee="furnarchy_auth_url",te="furnarchy_version",re="furnarchy_zoom_settings",ne=Pe([]);function ut(){if(typeof localStorage>"u")return{zoomLevel:1.5,fitWidth:!1};const e=localStorage.getItem(re);if(!e)return{zoomLevel:1.5,fitWidth:!1};try{return JSON.parse(e)}catch{return{zoomLevel:1.5,fitWidth:!1}}}function dt(e){typeof localStorage>"u"||localStorage.setItem(re,JSON.stringify(e))}function ae(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(Q);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function gt(e){if(typeof localStorage>"u")return;const t=ae();t.includes(e)||(t.push(e),localStorage.setItem(Q,JSON.stringify(t)))}function We(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(D);if(!e)return[];try{const t=JSON.parse(e);return Array.isArray(t)?t.map(r=>typeof r=="string"?{url:r}:r):[]}catch(t){return console.error("Failed to load plugins",t),[]}}function Ge(e){typeof localStorage>"u"||(localStorage.setItem(D,JSON.stringify(e)),ne.set(e))}function vt(e,t){ne.update(r=>{const l=r.findIndex(n=>n.url===e);if(l===-1)return r;const o=r[l],a={...o,...t};if(JSON.stringify(o)===JSON.stringify(a))return r;const s=[...r];return s[l]=a,typeof localStorage<"u"&&localStorage.setItem(D,JSON.stringify(s)),s})}function ht(){return typeof localStorage>"u"?null:localStorage.getItem(ee)}function mt(e){typeof localStorage>"u"||localStorage.setItem(ee,e)}function Ze(){return typeof localStorage>"u"?null:localStorage.getItem(te)}function Be(e){typeof localStorage>"u"||localStorage.setItem(te,e)}async function pt(e){if(typeof localStorage>"u")return;const t=Ze();let r=We();const l=ae();let o=!1;const a=[...Ke];for(const s of a)if(!r.some(n=>n.url===s))try{const n=await Fe(s);if(l.includes(n.id)){console.log(`Skipping deleted default plugin: ${n.name} (${n.id})`);continue}r.push({id:n.id,url:s,name:n.name,description:n.description,version:n.version,author:n.author,enabled:typeof n.toggle=="boolean"?!n.toggle:!0,toggle:n.toggle}),o=!0}catch(n){console.error(`Failed to load default plugin ${s}:`,n)}o&&Ge(r),t!==e&&Be(e)}var je=Re('<svg width="16.933332mm" height="16.933336mm" viewBox="0 0 16.933332 16.933336" version="1.1" id="svg1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><defs id="defs1"></defs><g id="layer1" transform="translate(-78.987757,-57.85233)"><g style="overflow:hidden;fill:currentColor" id="g1" transform="matrix(0.26458333,0,0,0.26458333,-30.427081,12.964585)"><g id="g2" transform="matrix(0.07161125,0,0,0.07161125,408.88215,164.97088)"><path d="m 950.70753,449.97413 v 126.85714 c 0,4.57143 -1.52381,8.95238 -4.57143,13.14286 -3.04761,4.19047 -6.85714,6.66666 -11.42857,7.42857 l -105.71428,16 c -7.2381,20.57143 -14.66667,37.90476 -22.28572,52 13.33333,19.04762 33.71429,45.33333 61.14286,78.85714 3.80953,4.57143 5.71429,9.33333 5.71429,14.28571 0,4.95239 -1.71429,9.33334 -5.14286,13.14286 -10.28571,14.09524 -29.14286,34.66667 -56.57143,61.71429 -27.42857,27.04762 -45.33334,40.57143 -53.71429,40.57143 -4.57143,0 -9.52381,-1.71429 -14.85714,-5.14286 l -78.85714,-61.71429 c -16.76191,8.76191 -34.09524,16 -52,21.71429 -6.09524,51.80952 -11.61905,87.23809 -16.57143,106.28571 -2.66667,10.66667 -9.52381,16 -20.57143,16 H 448.42182 c -5.33333,0 -10,-1.61905 -14,-4.85714 -4,-3.23809 -6.19048,-7.33333 -6.57143,-12.28571 l -16,-105.14286 c -18.66667,-6.09524 -35.80952,-13.14286 -51.42857,-21.14286 l -80.57143,61.14286 c -3.80953,3.42857 -8.57143,5.14286 -14.28572,5.14286 -5.33333,0 -10.09524,-2.09524 -14.28571,-6.28572 -48,-43.42857 -79.42857,-75.42857 -94.28571,-96 -2.66667,-3.80952 -4,-8.19047 -4,-13.14286 0,-4.57143 1.52381,-8.95238 4.57143,-13.14285 5.71428,-8 15.42856,-20.66667 29.14285,-38 13.71429,-17.33333 24,-30.76191 30.85715,-40.28572 -10.28572,-19.04762 -18.09525,-37.90476 -23.42858,-56.57143 L 89.564678,595.11698 c -4.952381,-0.7619 -8.952381,-3.14285 -12,-7.14285 -3.047619,-4 -4.571429,-8.47619 -4.571429,-13.42857 V 447.68841 c 0,-4.57143 1.52381,-8.95238 4.571429,-13.14285 3.047619,-4.19048 6.666667,-6.66667 10.857143,-7.42858 l 106.285709,-16 c 5.33333,-17.52381 12.76191,-35.04761 22.28572,-52.57142 -15.2381,-21.71429 -35.61905,-48 -61.14286,-78.85715 -3.80953,-4.57143 -5.71429,-9.14285 -5.71429,-13.71428 0,-3.80953 1.71429,-8.19048 5.14286,-13.14286 9.90476,-13.71429 28.66666,-34.19048 56.28571,-61.42857 27.61905,-27.23809 45.61905,-40.85714 54,-40.85714 4.95239,0 9.90477,1.90476 14.85715,5.71428 l 78.85714,61.14286 c 16.76191,-8.76191 34.09524,-16 52,-21.71429 6.09524,-51.80952 11.61905,-87.23809 16.57143,-106.285708 2.66667,-10.666667 9.52381,-16 20.57143,-16 h 126.85714 c 5.33333,0 10,1.619048 14,4.857143 4,3.238095 6.19048,7.333333 6.57143,12.285714 l 16,105.142851 c 18.66667,6.09524 35.80952,13.14286 51.42857,21.14286 l 81.14286,-61.14286 c 3.42857,-3.42857 8,-5.14285 13.71428,-5.14285 4.95239,0 9.71429,1.90476 14.28572,5.71428 49.14285,45.33333 80.57142,77.71429 94.28571,97.14286 2.66667,3.04762 4,7.2381 4,12.57143 0,4.57143 -1.52381,8.95238 -4.57143,13.14285 -5.71429,8 -15.42857,20.66667 -29.14285,38 -13.71429,17.33333 -24,30.76191 -30.85715,40.28572 9.90477,19.04762 17.71429,37.71429 23.42857,56 l 104.57143,16 c 4.95238,0.76191 8.95238,3.14286 12,7.14286 3.04762,4 4.57143,8.47619 4.57143,13.42857 z" id="path1" style="fill:currentColor;stroke-width:16;stroke-dasharray:none;"></path><path style="font-weight:bold;font-size:585.303px;line-height:0;letter-spacing:182.908px;fill:white;stroke-width:3.77953;stroke-linecap:square" d="m 513.02075,729.40751 q -43.89772,0 -73.74818,-16.38848 -29.85045,-16.38849 -47.40954,-45.65363 -17.55909,-29.26515 -25.16803,-69.06576 -7.60893,-39.8006 -7.60893,-86.03953 0,-46.82424 7.60893,-86.03954 7.60894,-39.8006 25.16803,-69.06575 17.55909,-29.26515 47.40954,-45.65364 29.85046,-16.38848 73.74818,-16.38848 43.89772,0 73.16287,16.38848 29.85045,16.38849 46.82424,45.65364 16.97379,29.26515 23.99742,69.06575 7.60894,39.2153 7.60894,86.03954 0,46.23893 -7.60894,86.03953 -7.02363,39.80061 -23.99742,69.06576 -16.97379,29.26514 -46.82424,45.65363 -29.26515,16.38848 -73.16287,16.38848 z M 435.17545,511.6748 q 0,22.24152 0.58531,41.55651 1.1706,18.7297 4.09712,35.11818 l 118.8165,-205.44134 q -16.97379,-12.87667 -45.65363,-12.87667 -33.36227,0 -50.33606,18.7297 -16.38848,18.72969 -22.24151,50.92136 -5.26773,32.19166 -5.26773,71.99226 z m 77.8453,142.81393 q 33.36227,0 49.16545,-18.7297 16.38848,-19.31499 21.07091,-51.50666 5.26772,-32.77696 5.26772,-72.57757 0,-21.0709 -0.5853,-39.2153 -0.5853,-18.72969 -2.92651,-33.94757 l -117.6459,203.10013 q 16.97378,12.87667 45.65363,12.87667 z" id="text1" aria-label="0"></path></g></g></g></svg>');function _t(e){var t=je();De(e,t)}export{_t as M,ht as a,st as b,ct as c,V as d,nt as e,lt as f,We as g,Ge as h,rt as i,mt as j,ft as k,pt as l,gt as m,ut as n,dt as o,ne as p,it as q,ot as r,at as s,vt as u,Fe as v};
