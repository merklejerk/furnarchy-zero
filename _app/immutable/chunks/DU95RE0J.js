const w=[...` 	
\r\fÂ \v\uFEFF`];function R(t,e,r){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),r){for(var n in r)if(r[n])s=s?s+" "+n:n;else if(s.length)for(var u=n.length,i=0;(i=s.indexOf(n,i))>=0;){var c=i+u;(i===0||w.includes(s[i-1]))&&(c===s.length||w.includes(s[c]))?s=(i===0?"":s.substring(0,i))+s.substring(c+1):i=c}}return s===""?null:s}function v(t,e=!1){var r=e?" !important;":";",s="";for(var n in t){var u=t[n];u!=null&&u!==""&&(s+=" "+n+": "+u+r)}return s}function m(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function L(t,e){if(e){var r="",s,n;if(Array.isArray(e)?(s=e[0],n=e[1]):s=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var u=!1,i=0,c=!1,f=[];s&&f.push(...Object.keys(s).map(m)),n&&f.push(...Object.keys(n).map(m));var h=0,l=-1;const C=t.length;for(var p=0;p<C;p++){var g=t[p];if(c?g==="/"&&t[p-1]==="*"&&(c=!1):u?u===g&&(u=!1):g==="/"&&t[p+1]==="*"?c=!0:g==='"'||g==="'"?u=g:g==="("?i++:g===")"&&i--,!c&&u===!1&&i===0){if(g===":"&&l===-1)l=p;else if(g===";"||p===C-1){if(l!==-1){var W=m(t.substring(h,l).trim());if(!f.includes(W)){g!==";"&&p++;var E=t.substring(h,p).trim();r+=" "+E+";"}}h=p+1,l=-1}}}}return s&&(r+=v(s)),n&&(r+=v(n,!0)),r=r.trim(),r===""?null:r}return t==null?null:String(t)}function $(t,e=0){let r="";do{const s=t%95;t=Math.floor(t/95),r=String.fromCharCode(s+32)+r}while(t>0||r.length<e);return r}function b(t){let e=0;for(let r=0;r<t.length;r++)e=e*95+(t.charCodeAt(r)-32);return e}function a(t,e=0){let r="";do{const s=t%220;t=Math.floor(t/220);const n=s+35;r=r+String.fromCharCode(n)}while(t>0||r.length<e);return r}function o(t){let e=0,r=1;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e+=(n-35)*r,r*=220}return e}function y(t){const e={species:1,gender:0,colors:[0,0,0,0,0,0,0,0,0,0,0,0]};if(!t)return e;if(t.startsWith("w")){const r=Math.min(t.length,16);for(let s=0;s<12&&s+1<r;s++)e.colors[s]=o(t[s+1]);r>13&&(e.gender=o(t[13])),r>14&&(e.species=o(t.substring(14,16)))}else if(t.startsWith("t")){const r=Math.min(t.length,14);for(let s=0;s<10&&s+1<r;s++)e.colors[s]=o(t[s+1]);r>11&&(e.gender=o(t[11])),r>12&&(e.species=o(t[12])+1)}else{const r=Math.min(t.length,12);for(let s=0;s<10&&s<r;s++)e.colors[s]=b(t[s]);r>10&&(e.gender=b(t[10])),r>11&&(e.species=b(t[11])+1)}return e}function S(t){if(t.species>220||t.colors[10]>0||t.colors[11]>0){let r="w";for(let s=0;s<12;s++)r+=a(t.colors[s]||0,1);return r+=a(t.gender,1),r+=a(t.species,2),r}else{let r="t";for(let s=0;s<10;s++)r+=a(t.colors[s]||0,1);return r+=a(t.gender,1),r+=a(Math.max(0,t.species-1),1),r}}function d(t,e){return t||(e?S(e):"")}const k=/^(?:<img [^>]+>)?<font color='whisper'>\[ <name shortname='([^']+)' src='whisper-from'>([^<]+)<\/name> whispers, "(.*)" to you\. \]<\/font>$/,I=/^(?:<img [^>]+>)?<font color='whisper'>\[ You whisper "(.*)" to <name shortname='([^']+)'[^>]*>([^<]+)<\/name>\. \]<\/font>$/,M=/^<font color='myspeech'>You say, "(.*)"<\/font>$/,A=/^<name shortname='([^']+)'>([^<]+)<\/name>: (.*)$/,x=/^<font color='emote'><name shortname='([^']+)'>([^<]+)<\/name> (.*)<\/font>$/,P=/^<font color='roll'>.*?<name shortname='([^']+)'>([^<]+)<\/name> rolls (.*?)(<\/font>)?$/,T=/^<desc shortname='([^']+)' \/>&gt; (.*)$/;function j(t){if(t.startsWith("]B")){const e=t.substring(2).split(" ");if(e.length>=2){const r=parseInt(e[0],10),s=e[1];return{type:"set-user-info",uid:r,name:s}}}else if(t.startsWith("(")){const e=t.substring(1),r=e.match(k);if(r)return{type:"whisper",fromShort:r[1],from:r[2],message:r[3],isSelf:!1};const s=e.match(I);if(s)return{type:"whisper",message:s[1],toShort:s[2],to:s[3],isSelf:!0};const n=e.match(M);if(n)return{type:"speech",message:n[1],isSelf:!0};const u=e.match(A);if(u)return{type:"speech",fromShort:u[1],from:u[2],message:u[3],isSelf:!1};const i=e.match(x);if(i)return{type:"emote",fromShort:i[1],from:i[2],message:i[3]};const c=e.match(P);if(c)return{type:"roll",fromShort:c[1],from:c[2],message:c[3]};const f=e.match(T);return f?{type:"description",shortname:f[1],description:f[2]}:{type:"chat",text:e}}else if(t.startsWith("]f")){const e=t.substring(2,18);return{type:"set-character-info",name:t.substring(18).replace(/\|/g," "),colorCode:e,colorCodeParsed:y(e)}}else{if(t.startsWith("]&"))return{type:"load-portrait",uid:parseInt(t.substring(2),10)};if(t.startsWith("]W")){const e=o(t.substring(2,4)),r=o(t.substring(4,6)),s=o(t.substring(6,8)),n=o(t.substring(8,10)),u=o(t.substring(10,12)),i=o(t.substring(12,14)),c=o(t.substring(14,16)),f=o(t.substring(16,18)),h=o(t.substring(18,20));return{type:"world-metadata",wallDef:e,roofDef:r,floorDef:s,objDef:n,wallAlt:u,roofAlt:i,floorAlt:c,objAlt:f,regionThreshold:h}}else if(t.startsWith("]q")){const e=t.substring(3).split(" "),r=e[0]||"",s=e[1]||"",n=t.endsWith(" modern");return{type:"load-dream",map:r,patch:s,modern:n}}else if(t.startsWith("]M%")){let e=4;const r=[];for(;e+8<=t.length;){const s=o(t.substring(e,e+1)),n=o(t.substring(e+2,e+3)),u=o(t.substring(e+3,e+4)),i=o(t.substring(e+4,e+8)),c=n+220*(u>>1);r.push({version:s,id:c,checksum:i}),e+=8}return{type:"avatar-manifest",records:r}}else if(t.startsWith("]-")){const e=t.substring(2,4),r=t.substring(4);return{type:"chat-badge",subType:e,content:r}}else{if(t.startsWith("]G"))return{type:"name-visibility",visible:t[2]==="0"};if(t.startsWith("]j"))return{type:"play-music",trackId:o(t.substring(2,4))};if(t.startsWith("]s")){const e=o(t.substring(2,4)),r=o(t.substring(4,6)),s=t.substring(6,6+r);return{type:"set-tag",tagType:e,tag:s}}else{if(t.startsWith("]#"))return{type:"dialog-box",content:t.substring(2)};if(t.startsWith("]?"))return{type:"pounce-update",data:t.substring(2)};if(t.startsWith("]H")){const e=o(t.substring(2,6)),r=o(t.substring(6,8)),s=o(t.substring(8,10));return{type:"set-offsets",uid:e,yl:r,al:s}}else if(t.startsWith("]_")){const e=o(t.substring(2,6)),r=o(t.substring(6,7));return{type:"set-scale",uid:e,scale:r}}else if(t.startsWith("]O")){const e=o(t.substring(2,6)),r=o(t.substring(6,8));return{type:"set-gloam",uid:e,gloam:r}}else{if(t.startsWith("]I"))return{type:"batch-particle",data:t.substring(2)};if(t.startsWith("]%")){const e=t[2]==="1",r=t.substring(3);return{type:"online-status",online:e,name:r}}else if(t.startsWith("]v")){const e=t.charCodeAt(2),r=b(t.substring(3,5)),s=b(t.substring(5,7));return{type:"legacy-visual-effect",x:r,y:s,effectId:e}}else if(t.startsWith("@")){const e=b(t.substring(1,3)),r=b(t.substring(3,5));return{type:"camera-sync",x:e,y:r}}else if(t.startsWith("<")){const e=o(t.substring(1,5)),r=o(t.substring(5,7)),s=o(t.substring(7,9)),n=o(t.substring(9,10)),u=o(t.substring(10,11)),i=o(t.substring(11,12)),c=t.substring(12,12+i),f=12+i,h=t[f]==="w"?16:14,l=t.substring(f,f+h),p=y(l),g=o(t.substring(f+h+1,f+h+5)),W=o(t.substring(f+h+5,f+h+6));return{type:"add-avatar",uid:e,x:r,y:s,direction:n,pose:u,name:c,colorCode:l,colorCodeParsed:p,afkTime:g,scale:W}}else if(t.startsWith("/")||t.startsWith("A")){const e=t.startsWith("/")?"walk":"teleport",r=o(t.substring(1,5)),s=o(t.substring(5,7)),n=o(t.substring(7,9)),u=o(t.substring(9,10)),i=o(t.substring(10,11));return{type:"move-avatar",uid:r,x:s,y:n,direction:u,pose:i,moveType:e}}else if(t.startsWith("B")){const e=o(t.substring(1,5)),r=o(t.substring(5,6)),s=o(t.substring(6,7)),n=t.substring(7),u=y(n);return{type:"update-avatar-appearance",uid:e,direction:r,pose:s,colorCode:n,colorCodeParsed:u}}else{if(t.startsWith("C"))return{type:"remove-object",uid:o(t.substring(1,5))};if(t.startsWith(")"))return{type:"delete-object",uid:o(t.substring(1,5))};if(t.startsWith("D"))return{type:"dragonroar",message:t.substring(1)};if(t.startsWith("!"))return{type:"play-sound",soundId:o(t.substring(1,2))};if(["1","2",">","4","5","E","F"].includes(t[0]))return{type:"update-map",layer:{1:"floor",2:"wall",">":"item",4:"region",5:"effect",E:"lighting",F:"ambience"}[t[0]],data:t.substring(1)};if(t.startsWith("&"))return{type:"login-ready"};if(t.startsWith(";"))return{type:"load-map-legacy",mapName:t.substring(1)};if(t.startsWith("0"))return{type:"ds-variable",data:t.substring(1)};if(t.startsWith("3"))return{type:"ds-string",data:t.substring(1)};if(t.startsWith("6"))return{type:"ds-trigger-server",data:t.substring(1)};if(t.startsWith("7"))return{type:"ds-trigger-client",data:t.substring(1)};if(t.startsWith("8"))return{type:"ds-init",data:t.substring(1)}}}}}}return{type:"unknown",raw:t}}function D(t){if(t.startsWith('"'))return{type:"speech",message:t.substring(1)};if(t.startsWith(":"))return{type:"emote",message:t.substring(1)};if(t.startsWith("wh ")){const e=t.substring(3).split(" ");let r=e[0];const s=e.slice(1).join(" ");let n=!1;return r.startsWith("%")&&!r.startsWith("%%")&&(n=!0,r=r.substring(1)),{type:"whisper",target:r,message:s,exact:n}}else{if(t.startsWith("m "))return{type:"move",direction:parseInt(t.substring(2),10)};if(t==="<")return{type:"rotate",direction:"left"};if(t===">")return{type:"rotate",direction:"right"};if(t==="get")return{type:"get"};if(t==="use")return{type:"use"};if(t==="sit")return{type:"sit"};if(t==="stand")return{type:"stand"};if(t==="liedown")return{type:"liedown"};if(t.startsWith("loginNG "))return{type:"login",auth:t.substring(8)};if(t.startsWith("l")){if(t.length>=5){const e=o(t.substring(1,3)),r=o(t.substring(3,5));return{type:"look",x:e,y:r}}}else{if(t.startsWith("glook "))return{type:"glook",name:t.substring(6)};if(t==="vascodagama")return{type:"ready"};if(t==="quit")return{type:"quit"};if(t==="iamhere")return{type:"keep-alive"};if(t.startsWith("desc "))return{type:"set-desc",description:t.substring(5)};if(t.startsWith("color ")){const e=t.substring(6);return{type:"set-color",data:e,dataParsed:y(e)}}else{if(t.startsWith("costume "))return{type:"costume",args:t.substring(8)};if(t.startsWith("chcol ")){const e=t.substring(6);return{type:"chcol",colorCode:e,colorCodeParsed:y(e)}}else if(t.startsWith("afk")){if(t==="afk")return{type:"afk"};if(t.startsWith("afk "))return{type:"afk",message:t.substring(4)}}else{if(t==="unafk")return{type:"unafk"};if(t.startsWith("dsbtn "))return{type:"ds-btn",id:parseInt(t.substring(6),10)};if(t==="portrchng")return{type:"portrait-change"};if(t.startsWith("onln "))return{type:"check-online",name:t.substring(5)}}}}}return{type:"unknown",raw:t}}function G(t){switch(t.type){case"set-user-info":return`]B${t.uid} ${t.name}`;case"chat":return`(${t.text}`;case"chat-buffer":return`${t.subType}${t.content}`;case"whisper":return t.isSelf?`(<font color='whisper'>[ You whisper "${t.message}" to <name shortname='${t.toShort}' forced src='whisper-to'>${t.to}</name>. ]</font>`:`(<font color='whisper'>[ <name shortname='${t.fromShort}' src='whisper-from'>${t.from}</name> whispers, "${t.message}" to you. ]</font>`;case"speech":return t.isSelf?`(<font color='myspeech'>You say, "${t.message}"</font>`:`(<name shortname='${t.fromShort}'>${t.from}</name>: ${t.message}`;case"emote":return`(<font color='emote'><name shortname='${t.fromShort}'>${t.from}</name> ${t.message}</font>`;case"roll":return`(<font color='roll'><img src='fsh://system.fsh:101' alt='@roll' /><channel name='@roll' /> <name shortname='${t.fromShort}'>${t.from}</name> rolls ${t.message}</font>`;case"description":return`(<desc shortname='${t.shortname}' />&gt; ${t.description}`;case"set-character-info":return`]f${d(t.colorCode,t.colorCodeParsed)}${t.name.replace(/ /g,"|")}`;case"load-portrait":return`]&${t.uid}`;case"camera-sync":return`@${$(t.x,2)}${$(t.y,2)}`;case"add-avatar":{const e=d(t.colorCode,t.colorCodeParsed);return`<${a(t.uid,4)}${a(t.x,2)}${a(t.y,2)}${a(t.direction,1)}${a(t.pose,1)}${a(t.name.length,1)}${t.name}${e}${a(0,1)}${a(t.afkTime,4)}${a(t.scale,1)}`}case"move-avatar":return`${t.moveType==="walk"?"/":"A"}${a(t.uid,4)}${a(t.x,2)}${a(t.y,2)}${a(t.direction,1)}${a(t.pose,1)}`;case"update-avatar-appearance":{const e=d(t.colorCode,t.colorCodeParsed);return`B${a(t.uid,4)}${a(t.direction,1)}${a(t.pose,1)}${e}`}case"remove-object":return`C${a(t.uid,4)}`;case"delete-object":return`)${a(t.uid,4)}`;case"dragonroar":return`D${t.message}`;case"play-sound":return`!${a(t.soundId,1)}`;case"world-metadata":return`]W${a(t.wallDef,2)}${a(t.roofDef,2)}${a(t.floorDef,2)}${a(t.objDef,2)}${a(t.wallAlt,2)}${a(t.roofAlt,2)}${a(t.floorAlt,2)}${a(t.objAlt,2)}${a(t.regionThreshold,2)}`;case"load-dream":return`]q${t.map} ${t.patch}${t.modern?" modern":""}`;case"avatar-manifest":{let e="]M% ";for(const r of t.records){const s=Math.floor(r.id/220)<<1|0,n=r.id%220;e+=a(r.version,1),e+=a(0,1),e+=a(n,1),e+=a(s,1),e+=a(r.checksum,4)}return e}case"chat-badge":return`]-${t.subType}${t.content}`;case"name-visibility":return`]G${t.visible?"0":"1"}`;case"play-music":return`]j${a(t.trackId,2)}`;case"set-tag":return`]s${a(t.tagType,2)}${a(t.tag.length,2)}${t.tag}`;case"dialog-box":return`]#${t.content}`;case"pounce-update":return`]?${t.data}`;case"set-offsets":return`]H${a(t.uid,4)}${a(t.yl,2)}${a(t.al,2)}`;case"set-scale":return`]_${a(t.uid,4)}${a(t.scale,1)}`;case"set-gloam":return`]O${a(t.uid,4)}${a(t.gloam,2)}`;case"batch-particle":return`]I${t.data}`;case"legacy-visual-effect":return`]v${String.fromCharCode(t.effectId)}${$(t.x,2)}${$(t.y,2)}`;case"update-map":return`${{floor:"1",wall:"2",item:">",region:"4",effect:"5",lighting:"E",ambience:"F"}[t.layer]}${t.data}`;case"login-ready":return"&";case"load-map-legacy":return`;${t.mapName}`;case"ds-variable":return`0${t.data}`;case"ds-string":return`3${t.data}`;case"ds-trigger-server":return`6${t.data}`;case"ds-trigger-client":return`7${t.data}`;case"ds-init":return`8${t.data}`;case"online-status":return`]%${t.online?"1":"0"}${t.name}`;case"unknown":return t.raw}}function O(t){switch(t.type){case"move":return`m ${t.direction}`;case"rotate":return t.direction==="left"?"<":">";case"look":return`l${a(t.x,2)}${a(t.y,2)}`;case"glook":return`glook ${t.name}`;case"speech":return`"${t.message}`;case"emote":return`:${t.message}`;case"whisper":return`wh ${t.exact?"%":""}${t.target} ${t.message}`;case"get":return"get";case"use":return"use";case"sit":return"sit";case"stand":return"stand";case"liedown":return"liedown";case"login":return`loginNG ${t.auth}`;case"ready":return"vascodagama";case"quit":return"quit";case"keep-alive":return"iamhere";case"set-desc":return`desc ${t.description}`;case"set-color":return`color ${d(t.data,t.dataParsed)}`;case"costume":return`costume ${t.args}`;case"chcol":return`chcol ${d(t.colorCode,t.colorCodeParsed)}`;case"afk":return t.message?`afk ${t.message}`:"afk";case"unafk":return"unafk";case"ds-btn":return`dsbtn ${t.id}`;case"portrait-change":return"portrchng";case"check-online":return`onln ${t.name}`;case"unknown":return t.raw}}const H={parseServerCommand:j,parseClientCommand:D,createServerCommand:G,createClientCommand:O,unescape:t=>t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#(\d+);/g,(e,r)=>String.fromCharCode(parseInt(r,10))),escape:t=>t.replace(/[&<>"']|[\u0080-\uFFFF]/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";default:return"&#"+e.charCodeAt(0)+";"}}),base95Encode:$,base95Decode:b,base220Encode:a,base220Decode:o,getShortname:t=>{let e=t;return e=e.replace(/&(?:[Aa]grave|acute|circ|tilde|uml|ring)|AElig|aelig;/g,"a"),e=e.replace(/&[Cc]edil;/g,"c"),e=e.replace(/&[Ee]grave|acute|circ|uml;/g,"e"),e=e.replace(/&[Ii]grave|acute|circ|uml;/g,"i"),e=e.replace(/&ETH;/g,"d"),e=e.replace(/&[Nn]tilde;/g,"n"),e=e.replace(/&(?:[Oo]grave|acute|tilde|uml)|oslash|Ocirc|oric;/g,"o"),e=e.replace(/&[Uu]grave|acute|circ|uml;/g,"u"),e=e.replace(/&(?:[Yy]acute)|yuml;/g,"y"),e=e.replace(/&euro;/g,"e"),e=e.replace(/[^A-Za-z0-9]/g,""),e.toLowerCase()}};export{R as a,O as c,j as p,L as t,H as u};
