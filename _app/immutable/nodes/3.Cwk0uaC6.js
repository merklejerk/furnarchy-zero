import{f as S,e as A,a as L,s as O}from"../chunks/C1tqszlw.js";import{i as ke}from"../chunks/C9yta_6L.js";import{o as qe}from"../chunks/CknSxeTE.js";import{p as Ue,$ as Xe,a0 as je,n as Fe,o as p,an as Ne,h as e,W as j,Z as E,v as f,s as b,m as Le,u as P,t as X,e as Qe,a2 as Ye,a1 as Ze}from"../chunks/DLIAHk6_.js";import{i as T,s as Ge,a as Ve}from"../chunks/Bystva0I.js";import{h as Je}from"../chunks/67UxSOWT.js";import{p as ye,F as ze,g as Ke,h as z,l as et,r as tt,e as nt,s as we,d as se,f as oe,k as at,i as st,b as ot,m as rt,v as it,c as re,a as lt}from"../chunks/CuwTnWCS.js";import"../chunks/8UtF8RsF.js";function ct(u,y){let r=y;r.endsWith("/")||(r+="/");const v=u.startsWith("/")?u.substring(1):u;return new URL(v,r).toString()}function dt(u,y){const r=new URL(u),v=new URL(y),$=r.pathname.startsWith("/")?r.pathname.substring(1):r.pathname;let C=v.pathname;return C.endsWith("/")||(C+="/"),v.pathname=C+$,v.search=r.search,v.hash=r.hash,v.toString()}function ut(u){return!u.match(/^https?:\/\//)&&!u.startsWith("data:")&&!u.startsWith("blob:")}function ft(u){return u.startsWith("http://local-server.furcadia.com:8080/")||u.startsWith("https://terra.furcadia.com/")}function vt(u,y){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(v,$,...C){let a=$.toString();return ut(a)?(a=ct(a,u),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${a}`)):ft(a)&&(a=dt(a,y),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${a}`)),super.open(v,a,...C)}}}class Pe{buffer="";append(y){this.buffer+=y;const r=[];let v;for(;(v=this.buffer.indexOf(`
`))!==-1;){const $=this.buffer.substring(0,v);r.push($),this.buffer=this.buffer.substring(v+1)}return r}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function ht(){const u={encode:a=>{const t=a.length,c=new Uint8Array(t);for(let i=0;i<t;i++)c[i]=a.charCodeAt(i)&255;return c}},y={decode:a=>{if(typeof a=="string")return a;let t;a instanceof Uint8Array?t=a:a instanceof ArrayBuffer?t=new Uint8Array(a):t=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);let c="";const i=t.length,d=32768;for(let h=0;h<i;h+=d){const k=t.subarray(h,Math.min(h+d,i));c+=String.fromCharCode.apply(null,k)}return c}};let r=null,v;window.waitForFurc=new Promise(a=>{v=a});function $(a,t,c){if(!t.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const i=u.encode(t),d=new MessageEvent("message",{data:i,origin:"wss://lightbringer.furcadia.com"});d.tag=c,a.dispatchEvent(d)}function C(a,t,c){if(a.readyState===WebSocket.OPEN){if(!t.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const i=u.encode(t);a.sendTagged?a.sendTagged(i,c):a.send(i)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new Pe;_outgoingBuffer=new Pe;_motdComplete=!1;constructor(t,c){if(super(t,c),t.toString().includes("furcadia")||t.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),r=this;const i=window.Furnarchy;i&&(i.send=(d,h)=>C(this,d,h),i.inject=(d,h)=>$(this,d,h),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>v(this))}}send(t){this.sendTagged(t,void 0)}sendTagged(t,c){if(r!==this){super.send(t);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let i=typeof t=="string"?t:y.decode(t);const d=this._outgoingBuffer.append(i);if(d.length===0)return;const h=[];for(let M of d){const _=window.Furnarchy;if(_){const m=await _.processOutgoing(M,c);if(m==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}M=m}h.push(M)}if(h.length===0)return;const k=h.join(`
`)+`
`,B=u.encode(k);super.send(B)}).catch(i=>{console.error("Error in outgoing message queue:",i)})}_hookMessageEvent(t,c){const i=t.tag;this._incomingQueue=this._incomingQueue.then(async()=>{let d=typeof t.data=="string"?t.data:y.decode(t.data);const h=this._incomingBuffer.append(d);if(h.length===0)return;const k=[];for(let m of h){if(!this._motdComplete){m==="Dragonroar"&&(this._motdComplete=!0),k.push(m);continue}const W=window.Furnarchy;if(W&&m==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),W.notifyLoggedIn()),W){const I=await W.processIncoming(m,i);if(I==null)continue;m=I}k.push(m)}if(k.length===0)return;const B=k.join(`
`)+`
`;let M=B;this.binaryType==="arraybuffer"?M=u.encode(B).buffer:this.binaryType==="blob"&&(M=new Blob([u.encode(B)]));const _=new MessageEvent("message",{data:M,origin:t.origin,source:t.source});c(_)}).catch(d=>{console.error("Error in incoming message queue:",d)})}set onmessage(t){r===this&&t?super.onmessage=c=>{this._hookMessageEvent(c,i=>{t.call(this,i)})}:super.onmessage=t}get onmessage(){return super.onmessage}addEventListener(t,c,i){if(t==="message"&&r===this&&typeof c=="function"){const d=h=>{this._hookMessageEvent(h,k=>{c.call(this,k)})};super.addEventListener(t,d,i);return}super.addEventListener(t,c,i)}}}async function gt(u){const y=await fetch(u);if(!y.ok)throw new Error(`Failed to fetch client script: ${y.statusText}`);let r=await y.text();r=r.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),r=r.replaceAll("WebSocket","FurcWebSocket");const v=document.createElement("script");v.textContent=r,v.async=!0,document.body.appendChild(v)}var mt=S('<div class="config-btn svelte-a1qo0m" title="Configure Plugin">‚öôÔ∏è</div>'),pt=S('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">ID:</span> </div>'),bt=S('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),_t=S('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),yt=S('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Description:</span> </div>'),wt=S('<div class="plugin-details svelte-a1qo0m"><!> <!> <!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <div class="button-group svelte-a1qo0m"><button class="action-btn reload-btn svelte-a1qo0m">Reload Plugin</button> <button class="action-btn remove-btn svelte-a1qo0m">Remove Plugin</button></div></div>'),Pt=S('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div> <!> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),kt=S('<li class="empty svelte-a1qo0m">No plugins installed</li>'),qt=S('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),Ut=S('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function Ft(u,y){Ue(y,!1);const r=()=>Ve(ye,"$pluginStore",v),[v,$]=Ge(),C=j();let a=j(!1),t=j(""),c=j(null),i=j(!1),d=j({});qe(()=>{window.Furnarchy||(window.Furnarchy=new ze),ye.set(Ke()),window.Furnarchy.plugins&&window.Furnarchy.plugins.forEach(l=>{l.metadata.sourceUrl&&Ne(d,e(d)[l.metadata.sourceUrl]=l._handlers.configure.length>0)}),window.Furnarchy.onRegister(l=>{const s=l.metadata||l,g=s.sourceUrl||l.sourceUrl;if(g){E(d,{...e(d),[g]:l._handlers.configure.length>0});const x=r().findIndex(H=>H.url===g);if(x!==-1){const H=window.Furnarchy.loadingPluginUrl===g,q=r()[x];let F=!1;const R={...q};if(H){const Z=s.toggle?!1:q.enabled!==!1;l._setEnabled(Z),s.toggle&&q.enabled!==!1&&(R.enabled=!1,F=!0)}else l.enabled!==(q.enabled!==!1)&&(R.enabled=l.enabled,F=!0);if(q.name!==s.name&&(R.name=s.name,F=!0),q.id!==s.id&&(R.id=s.id,F=!0),q.description!==s.description&&(R.description=s.description,F=!0),q.version!==s.version&&(R.version=s.version,F=!0),q.author!==s.author&&(R.author=s.author,F=!0),F){const Z=[...r()];Z[x]=R,z(Z)}}}});const n=window.Furnarchy?.version||"0.0.0";et(n).then(()=>{W()})});function h(){E(a,!e(a))}async function k(){if(e(t)&&!r().some(n=>n.url===e(t))){E(i,!0);try{const n=await it(e(t)),l=[...r(),{id:n.id,url:e(t),name:n.name,description:n.description,version:n.version,author:n.author,enabled:n.toggle!==void 0?!n.toggle:!0}];z(l),I(e(t)),E(t,"")}catch(n){alert(`Failed to verify plugin: ${n.message||n}`)}finally{E(i,!1)}}}function B(n){const l=r().find(g=>g.url===n);l&&l.id&&rt(l.id);const s=r().filter(g=>g.url!==n);z(s),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function M(n){const l=r().map(s=>{if(s.url===n){const g=s.enabled===void 0?!1:!s.enabled,x=window.Furnarchy;if(x&&x.plugins){const H=x.plugins.find(q=>q.metadata.sourceUrl===n);H&&H._setEnabled(g)}return{...s,enabled:g}}return s});z(l)}function _(n){E(a,!1);const l=window.Furnarchy;if(l&&l.plugins){const s=l.plugins.find(g=>g.metadata.sourceUrl===n);s&&s._notifyConfigure()}}async function m(n){const l=document.querySelector(`script[data-plugin-url="${n}"]`);l&&l.remove();const s=window.Furnarchy;if(s&&s.plugins){const g=s.plugins.findIndex(x=>x.metadata.sourceUrl===n);g!==-1&&(s.plugins[g]._setEnabled(!1),s.plugins.splice(g,1))}await I(n)}function W(){r().forEach(n=>I(n.url))}async function I(n){if(!document.querySelector(`script[data-plugin-url="${n}"]`))try{const l=await fetch(n);if(!l.ok)throw new Error(`HTTP ${l.status}`);const s=await l.text();window.Furnarchy.loadingPluginUrl=n;const g=document.createElement("script");g.textContent=s,g.dataset.pluginUrl=n,document.body.appendChild(g),console.log(`[PluginManager] Loaded via fetch: ${n}`)}catch(l){console.warn(`[PluginManager] Fetch failed for ${n}, falling back to script tag.`,l);const s=document.createElement("script");s.src=n,s.async=!0,s.dataset.pluginUrl=n,s.onload=()=>console.log(`[PluginManager] Loaded via tag: ${n}`),s.onerror=()=>console.error(`[PluginManager] Failed to load: ${n}`),document.body.appendChild(s)}finally{window.Furnarchy.loadingPluginUrl=null}}Xe(()=>r(),()=>{E(C,r())}),je(),ke();var G=Ut(),ie=p(G),Se=f(ie,2);{var Ce=n=>{var l=qt(),s=Le(l),g=f(s,2),x=p(g),H=f(p(x),2);b(x);var q=f(x,2),F=p(q);tt(F);var R=f(F,2),Z=p(R,!0);b(R),b(q);var K=f(q,2),le=p(K);nt(le,1,r,st,(D,o)=>{var V=Pt();let de;var ee=p(V),ue=p(ee),J=p(ue);let fe;var ve=f(J,2);{var Ae=N=>{var Q=mt();A("click",Q,oe(()=>_(e(o).url))),L(N,Q)};T(ve,N=>{e(d),e(o),P(()=>e(d)[e(o).url])&&N(Ae)})}var te=f(ve,2),$e=p(te,!0);b(te),b(ue),b(ee);var Me=f(ee,2);{var We=N=>{var Q=wt(),he=p(Q);{var Te=w=>{var U=pt(),Y=f(p(U));b(U),X(()=>O(Y,` ${e(o),P(()=>e(o).id)??""}`)),L(w,U)};T(he,w=>{e(o),P(()=>e(o).id)&&w(Te)})}var ge=f(he,2);{var Be=w=>{var U=bt(),Y=f(p(U));b(U),X(()=>O(Y,` ${e(o),P(()=>e(o).version)??""}`)),L(w,U)};T(ge,w=>{e(o),P(()=>e(o).version)&&w(Be)})}var me=f(ge,2);{var Ie=w=>{var U=_t(),Y=f(p(U));b(U),X(()=>O(Y,` ${e(o),P(()=>e(o).author)??""}`)),L(w,U)};T(me,w=>{e(o),P(()=>e(o).author)&&w(Ie)})}var pe=f(me,2);{var De=w=>{var U=yt(),Y=f(p(U));b(U),X(()=>O(Y,` ${e(o),P(()=>e(o).description)??""}`)),L(w,U)};T(pe,w=>{e(o),P(()=>e(o).description)&&w(De)})}var ne=f(pe,2),ae=f(p(ne),2),He=p(ae,!0);b(ae),b(ne);var be=f(ne,2),_e=p(be),Oe=f(_e,2);b(be),b(Q),X(()=>{se(ae,"href",(e(o),P(()=>e(o).url))),O(He,(e(o),P(()=>e(o).url)))}),A("click",_e,()=>m(e(o).url)),A("click",Oe,()=>B(e(o).url)),A("click",Q,oe(function(w){at.call(this,y,w)})),L(N,Q)};T(Me,N=>{e(c),e(o),P(()=>e(c)===e(o).url)&&N(We)})}b(V),X(()=>{de=we(V,1,"plugin-item svelte-a1qo0m",null,de,{expanded:e(c)===e(o).url,disabled:e(o).enabled===!1}),fe=we(J,1,"toggle-switch svelte-a1qo0m",null,fe,{checked:e(o).enabled!==!1}),se(J,"title",(e(o),P(()=>e(o).enabled!==!1?"Disable Plugin":"Enable Plugin"))),se(te,"title",(e(o),P(()=>e(o).url))),O($e,(e(o),P(()=>e(o).name||e(o).url)))}),A("click",J,oe(()=>M(e(o).url))),A("click",V,()=>E(c,e(c)===e(o).url?null:e(o).url)),L(D,V)});var xe=f(le,2);{var Re=D=>{var o=kt();L(D,o)};T(xe,D=>{r(),P(()=>r().length===0)&&D(Re)})}b(K);var ce=f(K,2),Ee=f(p(ce),4);Ee.textContent=`Furnarchy Zero v${P(()=>window.Furnarchy?.version||"...")??""}`,b(ce),b(g),X(()=>{F.disabled=e(i),R.disabled=e(i),O(Z,e(i)?"...":"Add")}),A("click",s,h),A("click",H,h),ot(F,()=>e(t),D=>E(t,D)),A("keydown",F,D=>D.key==="Enter"&&!e(i)&&k()),A("click",R,k),L(n,l)};T(Se,n=>{e(a)&&n(Ce)})}b(G),A("click",ie,h),L(u,G),Fe(),$()}var Lt=S('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),St=S('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),Ct=S('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),xt=S('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function Ht(u,y){Ue(y,!1);const r=re.PUBLIC_FURCADIA_CLIENT_JS_URL,v=re.PUBLIC_AUTH_PROXY_URL,$=re.PUBLIC_PLAY_FURCADIA_URL;let C=j(!1),a=j(""),t=!1;qe(()=>{const m=lt()||v;console.log(`[Furnarchy] Using backend URL: ${m}`),vt($,m),ht(),c()});async function c(){if(!t){E(C,!0),E(a,"");try{await gt(r),t=!0}catch(_){console.error(_),E(a,_.message||"An unknown error occurred")}finally{E(C,!1)}}}ke();var i=xt();Je("hy9bcf",_=>{var m=Lt();Ye(6),Qe(()=>{Ze.title="Furnarchy Zero"}),L(_,m)});var d=Le(i);Ft(d,{});var h=f(d,2);{var k=_=>{var m=St();L(_,m)};T(h,_=>{e(C)&&_(k)})}var B=f(h,12);{var M=_=>{var m=Ct(),W=p(m),I=p(W);b(W);var G=f(W,2);b(m),X(()=>O(I,`Error: ${e(a)??""}`)),A("click",G,()=>window.location.reload()),L(_,m)};T(B,_=>{e(a)&&_(M)})}L(u,i),Fe()}export{Ht as component};
