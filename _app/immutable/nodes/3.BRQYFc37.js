import{f as q,a as F}from"../chunks/BYm5rcE5.js";import{i as re}from"../chunks/DAyFc-qY.js";import{o as se}from"../chunks/C7meNTEH.js";import{I as ie,L as le,M as b,B as t,R as A,ap as Z,Q as P,O as p,N as y,J as ce,K as W,aq as Le,P as Pe,ar as ke}from"../chunks/DvRTsLh6.js";import{e as R,s as T}from"../chunks/B5fjua1M.js";import{i as E}from"../chunks/5LUz10Tw.js";import{h as Ue}from"../chunks/DkgUPuPd.js";import{F as Fe,g as qe,h as Se,r as xe,e as Re,s as Ce,d as ae,f as Ae,k as Ee,i as Me,b as We,v as Te,c as K,a as $e}from"../chunks/TYfAksGv.js";function Be(l,m){let i=m;i.endsWith("/")||(i+="/");const s=l.startsWith("/")?l.substring(1):l;return new URL(s,i).toString()}function Ie(l,m){const i=new URL(l),s=new URL(m),o=i.pathname.startsWith("/")?i.pathname.substring(1):i.pathname;let _=s.pathname;return _.endsWith("/")||(_+="/"),s.pathname=_+o,s.search=i.search,s.hash=i.hash,s.toString()}function He(l){return!l.match(/^https?:\/\//)&&!l.startsWith("data:")&&!l.startsWith("blob:")}function Oe(l){return l.startsWith("http://local-server.furcadia.com:8080/")||l.startsWith("https://terra.furcadia.com/")}function Ne(l,m){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(s,o,..._){let a=o.toString();return He(a)?(a=Be(a,l),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${a}`)):Oe(a)&&(a=Ie(a,m),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${a}`)),super.open(s,a,..._)}}}class oe{buffer="";append(m){this.buffer+=m;const i=[];let s;for(;(s=this.buffer.indexOf(`
`))!==-1;){const o=this.buffer.substring(0,s);i.push(o),this.buffer=this.buffer.substring(s+1)}return i}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function Xe(){const l={encode:a=>{const e=a.length,c=new Uint8Array(e);for(let r=0;r<e;r++)c[r]=a.charCodeAt(r)&255;return c}},m={decode:a=>{if(typeof a=="string")return a;let e;a instanceof Uint8Array?e=a:a instanceof ArrayBuffer?e=new Uint8Array(a):e=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);let c="";const r=e.length,d=32768;for(let f=0;f<r;f+=d){const L=e.subarray(f,Math.min(f+d,r));c+=String.fromCharCode.apply(null,L)}return c}};let i=null,s;window.waitForFurc=new Promise(a=>{s=a});function o(a,e,c){if(!e.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const r=l.encode(e),d=new MessageEvent("message",{data:r,origin:"wss://lightbringer.furcadia.com"});d.tag=c,a.dispatchEvent(d)}function _(a,e,c){if(a.readyState===WebSocket.OPEN){if(!e.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const r=l.encode(e);a.sendTagged?a.sendTagged(r,c):a.send(r)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new oe;_outgoingBuffer=new oe;constructor(e,c){if(super(e,c),e.toString().includes("furcadia")||e.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),i=this;const r=window.Furnarchy;r&&(r.send=(d,f="PLUGIN")=>_(this,d,f),r.inject=(d,f="PLUGIN")=>o(this,d,f),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>s(this))}}send(e){this.sendTagged(e,void 0)}sendTagged(e,c){if(i!==this){super.send(e);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let r=typeof e=="string"?e:m.decode(e);const d=this._outgoingBuffer.append(r);if(d.length===0)return;const f=[];for(let k of d){const h=window.Furnarchy;if(h){const v=await h.processOutgoing(k,c);if(v==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}k=v}f.push(k)}if(f.length===0)return;const L=f.join(`
`)+`
`,U=l.encode(L);super.send(U)}).catch(r=>{console.error("Error in outgoing message queue:",r)})}_hookMessageEvent(e,c){const r=e.tag;this._incomingQueue=this._incomingQueue.then(async()=>{let d=typeof e.data=="string"?e.data:m.decode(e.data);const f=this._incomingBuffer.append(d);if(f.length===0)return;const L=[];for(let v of f){const n=window.Furnarchy;if(n&&v==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),n.notifyLoggedIn()),n){const u=await n.processIncoming(v,r);if(u==null)continue;v=u}L.push(v)}if(L.length===0)return;const U=L.join(`
`)+`
`;let k=U;this.binaryType==="arraybuffer"?k=l.encode(U).buffer:this.binaryType==="blob"&&(k=new Blob([l.encode(U)]));const h=new MessageEvent("message",{data:k,origin:e.origin,source:e.source});c(h)}).catch(d=>{console.error("Error in incoming message queue:",d)})}set onmessage(e){i===this&&e?super.onmessage=c=>{this._hookMessageEvent(c,r=>{e.call(this,r)})}:super.onmessage=e}get onmessage(){return super.onmessage}addEventListener(e,c,r){if(e==="message"&&i===this&&typeof c=="function"){const d=f=>{this._hookMessageEvent(f,L=>{c.call(this,L)})};super.addEventListener(e,d,r);return}super.addEventListener(e,c,r)}}}async function je(l){const m=await fetch(l);if(!m.ok)throw new Error(`Failed to fetch client script: ${m.statusText}`);let i=await m.text();i=i.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),i=i.replaceAll("WebSocket","FurcWebSocket");const s=document.createElement("script");s.textContent=i,s.async=!0,document.body.appendChild(s)}var De=q('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),Qe=q('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),Ge=q('<div class="plugin-details svelte-a1qo0m"><!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <button class="remove-btn svelte-a1qo0m">Remove Plugin</button></div>'),Ye=q('<li><div class="plugin-header svelte-a1qo0m"><span class="plugin-name svelte-a1qo0m"> </span></div> <!></li>'),Je=q('<li class="empty svelte-a1qo0m">No plugins installed</li>'),Ze=q('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),Ke=q('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function Ve(l,m){ie(m,!1);let i=A(!1),s=A(""),o=A([]),_=A(null),a=A(!1);se(()=>{window.Furnarchy||(window.Furnarchy=new Fe),window.Furnarchy.onRegister(n=>{if(n.sourceUrl){const u=t(o).findIndex(g=>g.url===n.sourceUrl);if(u!==-1){let g=!1;t(o)[u].name||(Z(o,t(o)[u].name=n.name),g=!0),n.version&&t(o)[u].version!==n.version&&(Z(o,t(o)[u].version=n.version),g=!0),n.author&&t(o)[u].author!==n.author&&(Z(o,t(o)[u].author=n.author),g=!0),g&&(P(o,[...t(o)]),d())}}}),P(o,qe()),f()});function e(){P(i,!t(i))}async function c(){if(t(s)&&!t(o).some(n=>n.url===t(s))){P(a,!0);try{const n=await Te(t(s));P(o,[...t(o),{url:t(s),name:n.name,version:n.version,author:n.author}]),d(),L(t(s)),P(s,"")}catch(n){alert(`Failed to verify plugin: ${n.message||n}`)}finally{P(a,!1)}}}function r(n){P(o,t(o).filter(u=>u.url!==n)),d(),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function d(){Se(t(o))}function f(){t(o).forEach(n=>L(n.url))}async function L(n){if(!document.querySelector(`script[data-plugin-url="${n}"]`))try{window.Furnarchy.loadingPluginUrl=n;const u=await fetch(n);if(!u.ok)throw new Error(`HTTP ${u.status}`);const g=await u.text(),M=document.createElement("script");M.textContent=g,M.dataset.pluginUrl=n,document.body.appendChild(M),console.log(`[PluginManager] Loaded via fetch: ${n}`)}catch(u){console.warn(`[PluginManager] Fetch failed for ${n}, falling back to script tag.`,u);const g=document.createElement("script");g.src=n,g.async=!0,g.dataset.pluginUrl=n,g.onload=()=>console.log(`[PluginManager] Loaded via tag: ${n}`),g.onerror=()=>console.error(`[PluginManager] Failed to load: ${n}`),document.body.appendChild(g)}finally{window.Furnarchy.loadingPluginUrl=null}}re();var U=Ke(),k=b(U),h=p(k,2);{var v=n=>{var u=Ze(),g=ce(u),M=p(g,2),O=b(M),de=p(b(O),2);y(O);var N=p(O,2),$=b(N);xe($);var I=p($,2),ue=b(I,!0);y(I),y(N);var X=p(N,2),V=b(X);Re(V,1,()=>t(o),Me,(S,w)=>{var B=Ye();let ee;var j=b(B),D=b(j),ge=b(D,!0);y(D),y(j);var me=p(j,2);{var pe=Q=>{var H=Ge(),te=b(H);{var be=x=>{var C=De(),J=p(b(C));y(C),W(()=>T(J,` ${t(w).version??""}`)),F(x,C)};E(te,x=>{t(w).version&&x(be)})}var ne=p(te,2);{var ye=x=>{var C=Qe(),J=p(b(C));y(C),W(()=>T(J,` ${t(w).author??""}`)),F(x,C)};E(ne,x=>{t(w).author&&x(ye)})}var G=p(ne,2),Y=p(b(G),2),_e=b(Y,!0);y(Y),y(G);var we=p(G,2);y(H),W(()=>{ae(Y,"href",t(w).url),T(_e,t(w).url)}),R("click",we,()=>r(t(w).url)),R("click",H,Ae(function(x){Ee.call(this,m,x)})),F(Q,H)};E(me,Q=>{t(_)===t(w).url&&Q(pe)})}y(B),W(()=>{ee=Ce(B,1,"plugin-item svelte-a1qo0m",null,ee,{expanded:t(_)===t(w).url}),ae(D,"title",t(w).url),T(ge,t(w).name||t(w).url)}),R("click",B,()=>P(_,t(_)===t(w).url?null:t(w).url)),F(S,B)});var fe=p(V,2);{var ve=S=>{var w=Je();F(S,w)};E(fe,S=>{t(o).length===0&&S(ve)})}y(X);var z=p(X,2),he=p(b(z),4);he.textContent=`Furnarchy Zero v${(window.Furnarchy?.version||"...")??""}`,y(z),y(M),W(()=>{$.disabled=t(a),I.disabled=t(a),T(ue,t(a)?"...":"Add")}),R("click",g,e),R("click",de,e),We($,()=>t(s),S=>P(s,S)),R("keydown",$,S=>S.key==="Enter"&&!t(a)&&c()),R("click",I,c),F(n,u)};E(h,n=>{t(i)&&n(v)})}y(U),R("click",k,e),F(l,U),le()}var ze=q('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),et=q('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),tt=q('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),nt=q('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function vt(l,m){ie(m,!1);const i=K.PUBLIC_FURCADIA_CLIENT_JS_URL,s=K.PUBLIC_AUTH_PROXY_URL,o=K.PUBLIC_PLAY_FURCADIA_URL;let _=A(!1),a=A(""),e=!1;se(()=>{const v=$e()||s;console.log(`[Furnarchy] Using backend URL: ${v}`),Ne(o,v),Xe(),c()});async function c(){if(!e){P(_,!0),P(a,"");try{await je(i),e=!0}catch(h){console.error(h),P(a,h.message||"An unknown error occurred")}finally{P(_,!1)}}}re();var r=nt();Ue("hy9bcf",h=>{var v=ze();Pe(6),Le(()=>{ke.title="Furnarchy Zero"}),F(h,v)});var d=ce(r);Ve(d,{});var f=p(d,2);{var L=h=>{var v=et();F(h,v)};E(f,h=>{t(_)&&h(L)})}var U=p(f,12);{var k=h=>{var v=tt(),n=b(v),u=b(n);y(n);var g=p(n,2);y(v),W(()=>T(u,`Error: ${t(a)??""}`)),R("click",g,()=>window.location.reload()),F(h,v)};E(U,h=>{t(a)&&h(k)})}F(l,r),le()}export{vt as component};
