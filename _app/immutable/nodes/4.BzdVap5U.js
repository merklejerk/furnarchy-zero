import{d as Ht,f as x,s as Q,b as m,g as B,e as De,t as Oe}from"../chunks/B3FnF0oJ.js";import{i as bt}from"../chunks/DumpmRuy.js";import{o as Ot,a as jt}from"../chunks/iqYowYmk.js";import{y as qt,u as E,z as Jt,ad as Ae,b5 as Vt,f as Yt,an as Kt,af as tt,aG as je,l as Ut,m as y,a8 as Bt,i as e,ai as g,ak as w,aj as p,t as J,ag as I,aH as Ee,b6 as Qt,ah as nt,av as kt,as as pt,at as Gt,R as qe,k as Zt,b4 as $t}from"../chunks/B34q5ZhI.js";import{e as et,i as Et}from"../chunks/T5S5BKvr.js";import{i as D}from"../chunks/B-8yQNBF.js";import{h as en}from"../chunks/wBzAbtsP.js";import{s as ze,a as de,b as tn,p as nn}from"../chunks/B8CywloG.js";import{h as ue}from"../chunks/6L543JdX.js";import{s as xt}from"../chunks/DPoAyR-t.js";import{b as Mt}from"../chunks/CsEh3Pnl.js";import{u as Dt,c as Tt}from"../chunks/DU95RE0J.js";import{p as me}from"../chunks/C-xiGS0O.js";const an=!0;function rn(a,o,n){qt(()=>{var i=E(()=>o(a,n?.())||{});if(n&&i?.update){var s=!1,l={};Jt(()=>{var d=n();Ae(d),s&&Vt(l,d)&&(l=d,i.update(d))}),s=!0}if(i?.destroy)return()=>i.destroy()})}function on(a,o,n){var i=Yt(a,o);i&&i.set&&(a[o]=n,Kt(()=>{a[o]=null}))}const Ct=an,sn=!1,qa=Object.freeze(Object.defineProperty({__proto__:null,ssr:sn},Symbol.toStringTag,{value:"Module"})),zt={"#SA":"üòä","#SB":"üòõ","#SC":"‚òπÔ∏è","#SD":"üòâ","#SE":"üòÅ","#SF":"üòØ","#SG":"ü§™","#SH":"üòë","#SI":"üò§","#SJ":"üòü","#SK":"üòè","#SL":"üò¢","#SM":"üéµ","#SN":"[OOC]","#SO":"‚ù§Ô∏è","#SP":"[AFK]","#SQ":"ü´£","#SR":"üòä","#SS":"üòú","#ST":"üòã","#SU":"üòÆ‚Äçüí®","#SV":"üòñ","#SW":"üòå","#SX":"[BRB]","#SY":"üíß","#SZ":"üêüÔ∏è","#Sa":"‚≠êÔ∏è","#Sb":"‚õàÔ∏è","#Sc":"üåª","#Sd":"üç∫","#Se":"üî™","#Sf":"üíÄ","#Sg":"üí≠","#Sh":"ü§¨","#Si":"üè†Ô∏è","#Sj":"‚òéÔ∏è","#Sk":"üçï","#Sl":"üåúÔ∏è","#Sm":"üöΩ","#Sn":"üìÅ","#So":"ü¶ã","#Sp":"ü¶ã","#Sq":"ü•á","#Sr":"ü•à","#Ss":"üíé","#St":"üíé","#Su":"üíé","#Sv":"üíé","#Sw":"ü™®","#Sx":"üìú","#Sy":"‚úÇÔ∏è","#S1":"ü™ô","#S2":"ü™ô","#S3":"ü™ô","#C6":"üç™"},cn=Object.entries(zt).reduce((a,[o,n])=>(a[n]=o,a),{});function ln(a){let o=a.replace(/[\r\n]+/g," ");for(const[n,i]of Object.entries(cn))o=o.replaceAll(n,i);return o}function fe(a){if(typeof document>"u")return a;const o=document.createElement("template");o.innerHTML=a;const n=o.content,i=["b","i","u","a","name"],s=(d,u=!1)=>{if(d.nodeType===Node.TEXT_NODE){let h=d.textContent||"";h=h.replace(/\|/g," "),h=h.replace(/#S[A-Za-z1-3]/g,_=>zt[_]||_);const f=document.createElement("div");f.textContent=h;const S=f.innerHTML;return u?S:S.replace(/(https?:\/\/[^\s<"']*[^\s<"'. ,!?\[\]])/g,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>')}if(d.nodeType===Node.ELEMENT_NODE){const h=d,f=h.tagName.toLowerCase();let S="";for(const _ of Array.from(h.childNodes))S+=s(_,u||f==="a"||f==="name");if(i.includes(f)){if(f==="a"){const _=h.getAttribute("href");if(_&&(_.startsWith("http://")||_.startsWith("https://")))return`<a href="${_.replace(/"/g,"&quot;")}" target="_blank" rel="noopener noreferrer">${S}</a>`}if(f==="name"){const _=h.getAttribute("shortname");if(_)return`<button class="name-link" data-shortname="${_.replace(/"/g,"&quot;")}">${S}</button>`}return`<${f}>${S}</${f}>`}return S}return""};let l="";for(const d of Array.from(n.childNodes))l+=s(d);return l}function G(a){return a.replace(/\|/g," ")}async function Ge(a,o,n){const i=crypto.getRandomValues(new Uint8Array(12)),s=new TextEncoder().encode(JSON.stringify(a)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,s),d=new Uint8Array(4+i.length+l.byteLength);return new DataView(d.buffer).setInt32(0,n),d.set(i,4),d.set(new Uint8Array(l),4+i.length),d.buffer}async function dn(a,o,n){try{if(a.byteLength<32)return null;const i=new Uint8Array(a);if(new DataView(a).getInt32(0)!==n)return null;const d=i.slice(4,16),u=i.slice(16),h=await crypto.subtle.decrypt({name:"AES-GCM",iv:d},o,u);return JSON.parse(new TextDecoder().decode(h))}catch{return null}}const Ze=43200,Pt=1440,It=Symbol.for("constructDateFrom");function At(a,o){return typeof a=="function"?a(o):a&&typeof a=="object"&&It in a?a[It](o):a instanceof Date?new a.constructor(o):new Date(o)}function we(a,o){return At(a,a)}let un={};function fn(){return un}function Wt(a){const o=we(a),n=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()));return n.setUTCFullYear(o.getFullYear()),+a-+n}function _t(a,...o){const n=At.bind(null,a||o.find(i=>typeof i=="object"));return o.map(n)}function $e(a,o){const n=+we(a)-+we(o);return n<0?-1:n>0?1:n}function mn(a,o,n){const[i,s]=_t(n?.in,a,o),l=i.getFullYear()-s.getFullYear(),d=i.getMonth()-s.getMonth();return l*12+d}function hn(a){return o=>{const i=(a?Math[a]:Math.trunc)(o);return i===0?0:i}}function vn(a,o){return+we(a)-+we(o)}function gn(a,o){const n=we(a);return n.setHours(23,59,59,999),n}function pn(a,o){const n=we(a),i=n.getMonth();return n.setFullYear(n.getFullYear(),i+1,0),n.setHours(23,59,59,999),n}function yn(a,o){const n=we(a);return+gn(n)==+pn(n)}function bn(a,o,n){const[i,s,l]=_t(n?.in,a,a,o),d=$e(s,l),u=Math.abs(mn(s,l));if(u<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-d*u);let h=$e(s,l)===-d;yn(i)&&u===1&&$e(i,l)===1&&(h=!1);const f=d*(u-+h);return f===0?0:f}function _n(a,o,n){const i=vn(a,o)/1e3;return hn(n?.roundingMethod)(i)}const Sn={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},wn=(a,o,n)=>{let i;const s=Sn[a];return typeof s=="string"?i=s:o===1?i=s.one:i=s.other.replace("{{count}}",o.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i};function yt(a){return(o={})=>{const n=o.width?String(o.width):a.defaultWidth;return a.formats[n]||a.formats[a.defaultWidth]}}const kn={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xn={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Mn={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Dn={date:yt({formats:kn,defaultWidth:"full"}),time:yt({formats:xn,defaultWidth:"full"}),dateTime:yt({formats:Mn,defaultWidth:"full"})},Tn={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Cn=(a,o,n,i)=>Tn[a];function Je(a){return(o,n)=>{const i=n?.context?String(n.context):"standalone";let s;if(i==="formatting"&&a.formattingValues){const d=a.defaultFormattingWidth||a.defaultWidth,u=n?.width?String(n.width):d;s=a.formattingValues[u]||a.formattingValues[d]}else{const d=a.defaultWidth,u=n?.width?String(n.width):a.defaultWidth;s=a.values[u]||a.values[d]}const l=a.argumentCallback?a.argumentCallback(o):o;return s[l]}}const Pn={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},In={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Wn={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},On={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},jn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},En={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},zn=(a,o)=>{const n=Number(a),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},An={ordinalNumber:zn,era:Je({values:Pn,defaultWidth:"wide"}),quarter:Je({values:In,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Je({values:Wn,defaultWidth:"wide"}),day:Je({values:On,defaultWidth:"wide"}),dayPeriod:Je({values:jn,defaultWidth:"wide",formattingValues:En,defaultFormattingWidth:"wide"})};function Ve(a){return(o,n={})=>{const i=n.width,s=i&&a.matchPatterns[i]||a.matchPatterns[a.defaultMatchWidth],l=o.match(s);if(!l)return null;const d=l[0],u=i&&a.parsePatterns[i]||a.parsePatterns[a.defaultParseWidth],h=Array.isArray(u)?Rn(u,_=>_.test(d)):Nn(u,_=>_.test(d));let f;f=a.valueCallback?a.valueCallback(h):h,f=n.valueCallback?n.valueCallback(f):f;const S=o.slice(d.length);return{value:f,rest:S}}}function Nn(a,o){for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n)&&o(a[n]))return n}function Rn(a,o){for(let n=0;n<a.length;n++)if(o(a[n]))return n}function Ln(a){return(o,n={})=>{const i=o.match(a.matchPattern);if(!i)return null;const s=i[0],l=o.match(a.parsePattern);if(!l)return null;let d=a.valueCallback?a.valueCallback(l[0]):l[0];d=n.valueCallback?n.valueCallback(d):d;const u=o.slice(s.length);return{value:d,rest:u}}}const Fn=/^(\d+)(th|st|nd|rd)?/i,Xn=/\d+/i,Hn={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qn={any:[/^b/i,/^(a|c)/i]},Jn={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Vn={any:[/1/i,/2/i,/3/i,/4/i]},Yn={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Kn={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Un={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Bn={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Qn={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Gn={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Zn={ordinalNumber:Ln({matchPattern:Fn,parsePattern:Xn,valueCallback:a=>parseInt(a,10)}),era:Ve({matchPatterns:Hn,defaultMatchWidth:"wide",parsePatterns:qn,defaultParseWidth:"any"}),quarter:Ve({matchPatterns:Jn,defaultMatchWidth:"wide",parsePatterns:Vn,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Ve({matchPatterns:Yn,defaultMatchWidth:"wide",parsePatterns:Kn,defaultParseWidth:"any"}),day:Ve({matchPatterns:Un,defaultMatchWidth:"wide",parsePatterns:Bn,defaultParseWidth:"any"}),dayPeriod:Ve({matchPatterns:Qn,defaultMatchWidth:"any",parsePatterns:Gn,defaultParseWidth:"any"})},$n={code:"en-US",formatDistance:wn,formatLong:Dn,formatRelative:Cn,localize:An,match:Zn,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ea(a,o,n){const i=fn(),s=n?.locale??i.locale??$n,l=2520,d=$e(a,o);if(isNaN(d))throw new RangeError("Invalid time value");const u=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:d}),[h,f]=_t(n?.in,...d>0?[o,a]:[a,o]),S=_n(f,h),_=(Wt(f)-Wt(h))/1e3,k=Math.round((S-_)/60);let P;if(k<2)return n?.includeSeconds?S<5?s.formatDistance("lessThanXSeconds",5,u):S<10?s.formatDistance("lessThanXSeconds",10,u):S<20?s.formatDistance("lessThanXSeconds",20,u):S<40?s.formatDistance("halfAMinute",0,u):S<60?s.formatDistance("lessThanXMinutes",1,u):s.formatDistance("xMinutes",1,u):k===0?s.formatDistance("lessThanXMinutes",1,u):s.formatDistance("xMinutes",k,u);if(k<45)return s.formatDistance("xMinutes",k,u);if(k<90)return s.formatDistance("aboutXHours",1,u);if(k<Pt){const C=Math.round(k/60);return s.formatDistance("aboutXHours",C,u)}else{if(k<l)return s.formatDistance("xDays",1,u);if(k<Ze){const C=Math.round(k/Pt);return s.formatDistance("xDays",C,u)}else if(k<Ze*2)return P=Math.round(k/Ze),s.formatDistance("aboutXMonths",P,u)}if(P=bn(f,h),P<12){const C=Math.round(k/Ze);return s.formatDistance("xMonths",C,u)}else{const C=P%12,M=Math.trunc(P/12);return C<3?s.formatDistance("aboutXYears",M,u):C<9?s.formatDistance("overXYears",M,u):s.formatDistance("almostXYears",M+1,u)}}var ta=x('<div><div class="menu-actions svelte-17jz8d4"><button class="svelte-17jz8d4">Look</button> <button class="svelte-17jz8d4">Whisper</button></div> <div class="menu-arrow svelte-17jz8d4"></div></div>'),na=x('<button class="sender-btn name-link svelte-17jz8d4"> </button>'),aa=x('<button class="sender-btn name-link svelte-17jz8d4"> </button>'),ra=x('<!> <span class="text"><!></span>',1),oa=x('<button class="sender-btn name-link svelte-17jz8d4"> </button> <span class="text"><!></span>',1),sa=x('[ You whisper "<!>" to <button class="sender-btn name-link svelte-17jz8d4"> </button>. ]',1),ia=x('[ <button class="sender-btn name-link svelte-17jz8d4"> </button> whispers, "<!>" to you. ]',1),ca=x('<span class="text"><!></span>'),la=x('üé≤ <button class="sender-btn name-link svelte-17jz8d4"> </button> <span class="text">rolls <!></span>',1),da=x('<span class="text"><!> <!></span>'),ua=x('<span class="text">&nbsp;&nbsp;&gt; <!></span>'),fa=x('<span class="sender svelte-17jz8d4">üí¨</span> <span class="text"><!></span>',1),ma=x('<button class="name-link"> </button><!>',1),ha=x('<span class="text"><b>Nearby:</b> <!></span>'),va=x('<span class="text">üß© <!></span>'),ga=x('<span class="text"> </span>'),pa=x('<div><!> <span class="timestamp svelte-17jz8d4"> </span></div>'),ya=x('<div class="empty-state svelte-17jz8d4">Waiting for chat...</div>'),ba=x('<div class="chat-view svelte-17jz8d4"><div class="chat-log svelte-17jz8d4" role="log" aria-live="polite" tabindex="-1"><button class="nearby-btn-float svelte-17jz8d4" title="List nearby players"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-17jz8d4"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button> <!> <!> <!></div> <footer><div><textarea rows="1" class="svelte-17jz8d4"></textarea> <button class="send-btn svelte-17jz8d4" aria-label="Send"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-17jz8d4"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div></footer></div>');function _a(a,o){tt(o,!0);let n=je(void 0),i=je(void 0),s=je(""),l=Ee(()=>e(s).startsWith("/")?"whisper":e(s).startsWith(":")?"emote":e(s).startsWith("`")?"raw":"default"),d=je(Ut(Date.now())),u,h=je(null),f=je(!0),S=[],_="";function k(t,r){const c=v=>{t&&!t.contains(v.target)&&!v.defaultPrevented&&r()};return document.addEventListener("click",c,!0),{destroy(){document.removeEventListener("click",c,!0)}}}Ot(()=>{u=setInterval(()=>{y(d,Date.now(),!0)},3e4)}),jt(()=>{u&&clearInterval(u)});function P(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),C()):t.key==="Escape"&&(y(s,""),e(i)&&M())}function C(){if(!e(s).trim())return;const t=e(l)==="raw"?e(s):ln(e(s));o.onSendMessage(t),y(s,""),e(i)&&(e(i).style.height="auto"),e(n)&&(e(n).scrollTop=e(n).scrollHeight,y(f,!0),o.onUnreadChange(!1))}function M(){e(i)&&(e(i).style.height="auto",e(i).style.height=e(i).scrollHeight+"px")}function ke(){if(!e(n))return;Math.abs(e(n).scrollHeight-e(n).scrollTop-e(n).clientHeight)<15?e(f)||(y(f,!0),o.onUnreadChange(!1)):e(f)&&y(f,!1)}function Te(){o.status==="Connected"&&o.onSendMessage({type:"nearby_req"})}Bt(()=>{const t=o.id,r=o.messages;if(!e(n))return;const c=e(n);E(()=>{const v=t!==_,b=r!==S;_=t,S=r,v?(c.scrollTop=c.scrollHeight,y(f,!0),o.onUnreadChange(!1)):b&&(e(f)?c.scrollTop=c.scrollHeight:o.onUnreadChange(!0))})});function te(){y(h,null)}function Ye(t){const c=t.target.closest(".name-link");if(c&&e(n)){const v=c.getAttribute("data-shortname");if(v){const b=c.getBoundingClientRect(),T=e(n).getBoundingClientRect(),U=b.top-T.top<60?"bottom":"top",ae=b.left-T.left+e(n).scrollLeft+b.width/2,z=110,j=10,he=e(n).scrollLeft+z/2+j,ve=e(n).scrollLeft+T.width-z/2-j,re=Math.max(he,Math.min(ve,ae)),V=ae-re;y(h,{sn:v,side:U,x:re,y:(U==="top"?b.top:b.bottom)-T.top+e(n).scrollTop,arrowOffset:V},!0)}}else te()}function Ke(t){if((t.key==="Enter"||t.key===" ")&&e(n)){const c=t.target.closest(".name-link");if(c){t.preventDefault();const v=c.getAttribute("data-shortname");if(v){const b=c.getBoundingClientRect(),T=e(n).getBoundingClientRect(),U=b.top-T.top<60?"bottom":"top",ae=b.left-T.left+e(n).scrollLeft+b.width/2,z=110,j=10,he=e(n).scrollLeft+z/2+j,ve=e(n).scrollLeft+T.width-z/2-j,re=Math.max(he,Math.min(ve,ae)),V=ae-re;y(h,{sn:v,side:U,x:re,y:(U==="top"?b.top:b.bottom)-T.top+e(n).scrollTop,arrowOffset:V},!0)}}}}function at(t){o.onSendMessage({type:"glook",name:t}),te()}function Ne(t){const r=`/%${t} `;if(e(s).startsWith("/")){const c=e(s).indexOf(" ");c!==-1?y(s,r+e(s).substring(c+1)):y(s,r)}else y(s,r+e(s).trimStart());e(i)&&(e(i).focus(),M()),te()}var Re=ba(),ne=g(Re);ne.__click=Ye,ne.__keydown=Ke;var xe=g(ne);xe.__click=Te;var Ce=w(xe,2);{var Ue=t=>{var r=ta();let c;var v=g(r),b=g(v);b.__click=()=>at(e(h).sn);var T=w(b,2);T.__click=()=>Ne(e(h).sn),p(v);var Me=w(v,2);p(r),rn(r,(U,ae)=>k?.(U,ae),()=>te),J(()=>{c=ze(r,1,"name-menu svelte-17jz8d4",null,c,{"is-bottom":e(h).side==="bottom"}),xt(r,`left: ${e(h).x??""}px; top: ${e(h).y??""}px;`),xt(Me,`left: calc(50% + ${e(h).arrowOffset??""}px)`)}),m(t,r)};D(Ce,t=>{e(h)&&t(Ue)})}var Le=w(Ce,2);et(Le,17,()=>o.messages,t=>t.id,(t,r)=>{var c=pa();let v;var b=g(c);{var T=z=>{const j=Ee(()=>e(r).cmd);var he=ra(),ve=I(he);{var re=N=>{var R=na(),L=g(R);p(R),J((W,se)=>{de(R,"data-shortname",W),Q(L,`${se??""}:`)},[()=>Dt.getShortname(o.myCharacterName),()=>G(o.myCharacterName)]),m(N,R)},V=N=>{var R=aa(),L=g(R);p(R),J(W=>{de(R,"data-shortname",e(j).fromShort),Q(L,`${W??""}:`)},[()=>G(e(j).from)]),m(N,R)};D(ve,N=>{e(j).isSelf?N(re):N(V,!1)})}var oe=w(ve,2),Ie=g(oe);ue(Ie,()=>fe(e(j).message)),p(oe),m(z,he)},Me=z=>{var j=B(),he=I(j);{var ve=V=>{const oe=Ee(()=>e(r).cmd);var Ie=oa(),N=I(Ie),R=g(N,!0);p(N);var L=w(N,2),W=g(L);ue(W,()=>fe(e(oe).message)),p(L),J(se=>{de(N,"data-shortname",e(oe).fromShort),Q(R,se)},[()=>G(e(oe).from)]),m(V,Ie)},re=V=>{var oe=B(),Ie=I(oe);{var N=L=>{const W=Ee(()=>e(r).cmd);var se=ca(),st=g(se);{var it=F=>{var $=sa(),A=w(I($));ue(A,()=>fe(e(W).message));var ie=w(A,2),X=g(ie,!0);p(ie),kt(),J(Y=>{de(ie,"data-shortname",e(W).toShort),Q(X,Y)},[()=>G(e(W).to)]),m(F,$)},ge=F=>{var $=ia(),A=w(I($)),ie=g(A,!0);p(A);var X=w(A,2);ue(X,()=>fe(e(W).message)),kt(),J(Y=>{de(A,"data-shortname",e(W).fromShort),Q(ie,Y)},[()=>G(e(W).from)]),m(F,$)};D(st,F=>{e(W).isSelf?F(it):F(ge,!1)})}p(se),m(L,se)},R=L=>{var W=B(),se=I(W);{var st=ge=>{const F=Ee(()=>e(r).cmd);var $=la(),A=w(I($)),ie=g(A,!0);p(A);var X=w(A,2),Y=w(g(X));ue(Y,()=>fe(e(F).message)),p(X),J(We=>{de(A,"data-shortname",e(F).fromShort),Q(ie,We)},[()=>G(e(F).from)]),m(ge,$)},it=ge=>{var F=B(),$=I(F);{var A=X=>{var Y=da(),We=g(Y);{var ct=H=>{var ye=Oe("üîî");m(H,ye)},lt=H=>{var ye=B(),dt=I(ye);{var ut=K=>{var ce=Oe("ü§ñ");m(K,ce)},be=K=>{var ce=B(),Xe=I(ce);{var ft=q=>{var le=Oe("üëÄ");m(q,le)},_e=q=>{var le=Oe("‚ÑπÔ∏è");m(q,le)};D(Xe,q=>{/^\(You see\s+/i.test(e(r).cmd.text)?q(ft):q(_e,!1)},!0)}m(K,ce)};D(dt,K=>{/^<font\s+[^>]*color=['"]dragonspeak['"]/i.test(e(r).cmd.text)?K(ut):K(be,!1)},!0)}m(H,ye)};D(We,H=>{/^<font\s+[^>]*color=['"](emit|bcast)['"]/i.test(e(r).cmd.text)?H(ct):H(lt,!1)})}var pe=w(We,2);ue(pe,()=>fe(e(r).cmd.text)),p(Y),m(X,Y)},ie=X=>{var Y=B(),We=I(Y);{var ct=pe=>{var H=ua(),ye=w(g(H));ue(ye,()=>fe(e(r).cmd.description)),p(H),m(pe,H)},lt=pe=>{var H=B(),ye=I(H);{var dt=be=>{var K=fa(),ce=w(I(K),2),Xe=g(ce);ue(Xe,()=>fe(e(r).cmd.content)),p(ce),m(be,K)},ut=be=>{var K=B(),ce=I(K);{var Xe=_e=>{const q=Ee(()=>[...e(r).cmd.players].sort((O,ee)=>O.localeCompare(ee)));var le=ha(),mt=w(g(le),2);{var ht=O=>{var ee=Oe("(None)");m(O,ee)},Se=O=>{var ee=B(),vt=I(ee);et(vt,17,()=>e(q),Et,(Nt,St,Rt)=>{var wt=ma(),Qe=I(wt),Lt=g(Qe,!0);p(Qe);var Ft=w(Qe);{var Xt=He=>{var gt=Oe(",¬†");m(He,gt)};D(Ft,He=>{Rt<e(q).length-1&&He(Xt)})}J((He,gt)=>{de(Qe,"data-shortname",He),Q(Lt,gt)},[()=>Dt.getShortname(e(St)),()=>G(e(St))]),m(Nt,wt)}),m(O,ee)};D(mt,O=>{e(q).length===0?O(ht):O(Se,!1)})}p(le),m(_e,le)},ft=_e=>{var q=B(),le=I(q);{var mt=Se=>{var O=va(),ee=w(g(O));ue(ee,()=>fe(e(r).cmd.text)),p(O),m(Se,O)},ht=Se=>{var O=ga(),ee=g(O,!0);p(O),J(vt=>Q(ee,vt),[()=>"raw"in e(r).cmd?e(r).cmd.raw:JSON.stringify(e(r).cmd)]),m(Se,O)};D(le,Se=>{e(r).cmd.type==="notify"?Se(mt):Se(ht,!1)},!0)}m(_e,q)};D(ce,_e=>{e(r).cmd.type==="nearby-players"?_e(Xe):_e(ft,!1)},!0)}m(be,K)};D(ye,be=>{e(r).cmd.type==="dialog-box"?be(dt):be(ut,!1)},!0)}m(pe,H)};D(We,pe=>{e(r).cmd.type==="description"?pe(ct):pe(lt,!1)},!0)}m(X,Y)};D($,X=>{e(r).cmd.type==="chat"?X(A):X(ie,!1)},!0)}m(ge,F)};D(se,ge=>{e(r).cmd.type==="roll"?ge(st):ge(it,!1)},!0)}m(L,W)};D(Ie,L=>{e(r).cmd.type==="whisper"?L(N):L(R,!1)},!0)}m(V,oe)};D(he,V=>{e(r).cmd.type==="emote"?V(ve):V(re,!1)},!0)}m(z,j)};D(b,z=>{e(r).cmd.type==="speech"?z(T):z(Me,!1)})}var U=w(b,2),ae=g(U,!0);p(U),p(c),J((z,j)=>{v=ze(c,1,`message type-${e(r).cmd.type??""}`,"svelte-17jz8d4",v,{"is-self":"isSelf"in e(r).cmd&&e(r).cmd.isSelf}),de(U,"title",z),Q(ae,j)},[()=>new Date(e(r).timestamp).toLocaleString(),()=>ea(new Date(e(r).timestamp),new Date(e(d)),{addSuffix:!0})]),m(t,c)});var rt=w(Le,2);{var ot=t=>{var r=ya();m(t,r)};D(rt,t=>{o.messages.length===0&&t(ot)})}p(ne),Mt(ne,t=>y(n,t),()=>e(n));var Pe=w(ne,2),Fe=g(Pe),Z=g(Fe);Qt(Z),Z.__keydown=P,Z.__input=M,Mt(Z,t=>y(i,t),()=>e(i));var Be=w(Z,2);Be.__click=C,p(Fe),p(Pe),p(Re),J(()=>{xe.disabled=o.status!=="Connected",ze(Pe,1,`input-container ${o.status!=="Connected"?"disabled":""}`,"svelte-17jz8d4"),ze(Fe,1,`textarea-wrapper mode-${e(l)??""}`,"svelte-17jz8d4"),de(Z,"placeholder",o.status==="Connected"?"Type a command or chat...":o.status),Z.disabled=o.status!=="Connected",Be.disabled=o.status!=="Connected"}),De("scroll",ne,ke),tn(Z,()=>e(s),t=>y(s,t)),m(a,Re),nt()}Ht(["click","keydown","input"]);var Sa=x('<div role="button" tabindex="0"><div class="tab-content svelte-1ttge3k"><span>‚óè</span> <span class="name svelte-1ttge3k"> </span> <button class="close-btn svelte-1ttge3k">√ó</button></div></div>');function wa(a,o){tt(o,!1);let n=me(o,"name",8),i=me(o,"status",8),s=me(o,"active",8),l=me(o,"unread",8),d=me(o,"onSelect",8),u=me(o,"onClose",8);function h(M){M.stopPropagation(),u()()}bt();var f=Sa(),S=g(f),_=g(S),k=w(_,2),P=g(k,!0);p(k);var C=w(k,2);p(S),p(f),J((M,ke)=>{ze(f,1,`session-tab ${s()?"active":""} ${l()?"unread":""}`,"svelte-1ttge3k"),ze(_,1,`status-dot ${M??""}`,"svelte-1ttge3k"),Q(P,ke)},[()=>(Ae(i()),E(()=>i().toLowerCase().includes("connected")?"online":"offline")),()=>(Ae(G),Ae(n()),E(()=>G(n())))]),De("click",C,h),De("click",f,function(...M){d()?.apply(this,M)}),De("keydown",f,M=>(M.key==="Enter"||M.key===" ")&&d()()),m(a,f),nt()}var ka=x('<div class="session-card svelte-ooxe09"><button class="main-action svelte-ooxe09"><div class="info svelte-ooxe09"><div class="name svelte-ooxe09"> </div></div></button> <button class="delete-btn svelte-ooxe09" title="Delete Profile">‚úï</button></div>'),xa=x('<div class="empty-state svelte-ooxe09"><p>No paired characters found.</p> <p class="hint svelte-ooxe09">Scan a QR code from the Remote Furc plugin in <a href="https://furnarchy.xyz" target="_blank" rel="noopener noreferrer">Furnarchy</a> to get started!</p></div>'),Ma=x('<div class="session-picker svelte-ooxe09"><h2 class="title svelte-ooxe09">Sessions</h2> <div class="picker-viewport svelte-ooxe09"><!> <!></div></div>');function Da(a,o){tt(o,!1);let n=me(o,"sessions",8),i=me(o,"onSelect",8),s=me(o,"onRemove",8);bt();var l=Ma(),d=w(g(l),2),u=g(d);et(u,1,n,Et,(S,_)=>{var k=ka(),P=g(k),C=g(P),M=g(C),ke=g(M,!0);p(M),p(C),p(P);var Te=w(P,2);p(k),J(te=>Q(ke,te),[()=>(Ae(G),e(_),E(()=>G(e(_).name)))]),De("click",P,()=>i()(e(_))),De("click",Te,()=>s()(e(_).id)),m(S,k)});var h=w(u,2);{var f=S=>{var _=xa();m(S,_)};D(h,S=>{Ae(n()),E(()=>n().length===0)&&S(f)})}p(d),p(l),m(a,l),nt()}var Ta=x('<meta name="viewport" content="width=device-width, initial-scale=1, interactive-widget=resizes-content"/>'),Ca=x('<button class="add-tab-btn svelte-ol5tb" title="Open Session Picker">+</button>'),Pa=x('<div class="remote-app classic-theme svelte-ol5tb"><header class="workspace-header svelte-ol5tb"><div class="tab-scroller svelte-ol5tb"><!> <!></div></header> <main class="workspace-main svelte-ol5tb"><!></main></div>');function Ja(a,o){tt(o,!1);const n=qe();let i=qe([]),s=qe([]),l=qe(null),d=qe(!1);const u=7200*1e3;Ot(()=>{h(),S(),window.addEventListener("keydown",Ke)}),jt(()=>{e(s).forEach(t=>C(t)),window.removeEventListener("keydown",Ke)});function h(){try{y(i,JSON.parse(localStorage.getItem("rf_pairings")||"[]"))}catch{y(i,[])}}function f(){const t=e(s).map(c=>c.config.id),r=e(s).filter(c=>c.unread).map(c=>c.config.id);localStorage.setItem("rf_active_tabs",JSON.stringify(t)),localStorage.setItem("rf_unread_tabs",JSON.stringify(r)),localStorage.setItem("rf_current_tab",e(l)||""),localStorage.setItem("rf_last_workspace_time",Date.now().toString())}function S(){const t=parseInt(localStorage.getItem("rf_last_workspace_time")||"0");if(Date.now()-t>u){localStorage.removeItem("rf_active_tabs"),y(d,!0);return}try{const r=JSON.parse(localStorage.getItem("rf_active_tabs")||"[]"),c=JSON.parse(localStorage.getItem("rf_unread_tabs")||"[]"),v=localStorage.getItem("rf_current_tab");r.forEach(b=>{const T=e(i).find(Me=>Me.id===b);T&&_(T,c.includes(b))}),v&&r.includes(v)?y(l,v):r.length>0&&y(l,r[0])}catch{}finally{y(d,!0)}}async function _(t,r=!1){let c=e(s).find(v=>v.config.id===t.id);if(c){y(l,t.id),c.unread=!1;return}c={config:t,ws:null,messages:[],status:"Connecting...",sharedKey:null,maxReceivedId:0,unread:r},y(s,[...e(s),c]),y(l,t.id);try{const v=Uint8Array.from(atob(t.secretB64),b=>b.charCodeAt(0));c.sharedKey=await crypto.subtle.importKey("raw",v,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),P(c)}catch{c.status="Error",y(s,e(s))}}async function k(t){if(t.ws&&t.ws.readyState===WebSocket.OPEN&&t.sharedKey){const r=await Ge({type:"sync_req",lastId:t.maxReceivedId},t.sharedKey,t.config.keyHint);t.ws.send(r)}}function P(t){t.ws&&t.ws.close(),t.reconnectTimer&&clearTimeout(t.reconnectTimer);const r=new WebSocket(`${t.config.relayAddr}?room=${t.config.roomId}&role=remote`);t.ws=r,r.binaryType="arraybuffer",r.onopen=async()=>{t.status="Verifying...",await k(t),t.heartbeatTimer&&clearInterval(t.heartbeatTimer),t.heartbeatTimer=window.setInterval(async()=>{r.readyState===WebSocket.OPEN&&await k(t)},15e3)},r.onmessage=async c=>{const v=c.data;if(typeof v=="string")return;const b=await dn(v,t.sharedKey,t.config.keyHint);b&&(ke(t),b.type==="ping"?(t.status!=="Connected"&&(t.status="Connected"),Ge({type:"pong"},t.sharedKey,t.config.keyHint).then(T=>r.send(T))):b.type==="sync_res"?(t.status!=="Connected"&&(t.status="Connected"),b.lines.forEach(T=>M(t,T,!0))):b.type==="msg"&&(t.status!=="Connected"&&(t.status="Connected"),M(t,b)),y(s,e(s)))},r.onclose=()=>{t.heartbeatTimer&&clearInterval(t.heartbeatTimer),t.status="Reconnect...",y(s,e(s)),e(s).find(c=>c.config.id===t.config.id)&&(t.reconnectTimer=window.setTimeout(()=>P(t),5e3))}}function C(t){t.heartbeatTimer&&clearInterval(t.heartbeatTimer),t.presenceTimeout&&clearTimeout(t.presenceTimeout),t.reconnectTimer&&clearTimeout(t.reconnectTimer),t.ws&&(t.ws.onclose=null,t.ws.close())}function M(t,r,c=!1){t.messages.some(v=>v.seqId===r.id)||(r.id>t.maxReceivedId&&(t.maxReceivedId=r.id),t.messages=[...t.messages,{id:crypto.randomUUID(),seqId:r.id,cmd:r.cmd,timestamp:r.timestamp}].sort((v,b)=>v.seqId-b.seqId).slice(-300),!c&&e(l)!==t.config.id&&(t.unread=!0))}function ke(t){clearTimeout(t.presenceTimeout),t.presenceTimeout=window.setTimeout(()=>{t.status="Host Offline",y(s,e(s))},4e4)}function Te(t){const r=e(s).findIndex(c=>c.config.id===t);if(r!==-1){const c=e(s)[r];C(c),y(s,e(s).filter(v=>v.config.id!==t)),e(l)===t&&y(l,e(s).length>0?e(s)[e(s).length-1].config.id:null),f()}}function te(t){y(l,t);const r=e(s).find(c=>c.config.id===t);r&&(r.unread=!1),y(s,e(s))}function Ye(t){if(e(s).length<=1)return;const r=e(s).findIndex(v=>v.config.id===e(l));let c;r===-1?c=t===1?0:e(s).length-1:c=(r+t+e(s).length)%e(s).length,te(e(s)[c].config.id)}function Ke(t){t.ctrlKey&&(t.key==="["?(t.preventDefault(),Ye(-1)):t.key==="]"&&(t.preventDefault(),Ye(1)))}function at(t){confirm("Delete this character profile permanently?")&&(Te(t),y(i,e(i).filter(r=>r.id!==t)),localStorage.setItem("rf_pairings",JSON.stringify(e(i))))}function Ne(t){if(t.startsWith("`"))return{type:"unknown",raw:t.substring(1)};if(t.startsWith(":"))return{type:"emote",message:t.substring(1)};if(t.startsWith("/")){const r=t.indexOf(" ");if(r!==-1){let c=t.substring(1,r);const v=t.substring(r+1);let b=!1;return c.startsWith("%")&&c.length>1&&(b=!0,c=c.substring(1)),{type:"whisper",target:c,message:v,exact:b}}}return{type:"speech",message:t}}async function Re(t){if(!e(n)||!e(n).ws||e(n).ws.readyState!==WebSocket.OPEN)return;let r;if(typeof t=="object"&&"type"in t&&t.type==="nearby_req")r=await Ge({type:"nearby_req"},e(n).sharedKey,e(n).config.keyHint);else{const c=typeof t=="string"?Ne(t):t;console.log(Tt(c)),r=await Ge({type:"cmd",cmd:Tt(c)},e(n).sharedKey,e(n).config.keyHint)}e(n).ws.send(r),localStorage.setItem("rf_last_workspace_time",Date.now().toString())}pt(()=>(e(l),Ct),()=>{e(l)===null&&Ct&&h()}),pt(()=>(e(s),e(l)),()=>{y(n,e(s).find(t=>t.config.id===e(l))||null)}),pt(()=>(e(d),e(s),e(l)),()=>{e(d)&&(e(s)||e(l))&&f()}),Gt();var ne={parseChatInput:Ne};bt();var xe=Pa();en("ol5tb",t=>{var r=Ta();m(t,r)});var Ce=g(xe),Ue=g(Ce),Le=g(Ue);et(Le,1,()=>e(s),t=>t.config.id,(t,r)=>{{let c=Zt(()=>(e(l),e(r),E(()=>e(l)===e(r).config.id)));wa(t,{get name(){return e(r),E(()=>e(r).config.name)},get status(){return e(r),E(()=>e(r).status)},get active(){return e(c)},get unread(){return e(r),E(()=>e(r).unread)},onSelect:()=>te(e(r).config.id),onClose:()=>Te(e(r).config.id)})}});var rt=w(Le,2);{var ot=t=>{var r=Ca();De("click",r,nn(()=>y(l,null))),m(t,r)};D(rt,t=>{e(s),e(l),E(()=>e(s).length>0&&e(l)!==null)&&t(ot)})}p(Ue),p(Ce);var Pe=w(Ce,2),Fe=g(Pe);{var Z=t=>{_a(t,{get id(){return e(n),E(()=>e(n).config.id)},get messages(){return e(n),E(()=>e(n).messages)},get status(){return e(n),E(()=>e(n).status)},get myCharacterName(){return e(n),E(()=>e(n).config.name)},onSendMessage:Re,onUnreadChange:r=>{e(n)&&($t(n,e(n).unread=r),y(s,e(s)))}})},Be=t=>{Da(t,{get sessions(){return e(i)},onSelect:r=>_(r),onRemove:at})};D(Fe,t=>{e(n)?t(Z):t(Be,!1)})}return p(Pe),p(xe),m(a,xe),on(o,"parseChatInput",Ne),nt(ne)}export{Ja as component,qa as universal};
