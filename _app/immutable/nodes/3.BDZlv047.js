import{f as x,e as A,a as S,s as H}from"../chunks/IX6aYug8.js";import{i as Se}from"../chunks/DeWH6QAX.js";import{o as xe}from"../chunks/Cvwj0Kbc.js";import{p as Fe,W as Ge,X as Ve,n as $e,o as y,an as Ze,h as e,Q as X,T as R,v as p,s as w,m as Ee,u as L,t as D,e as Je,Y as Ke,$ as ze}from"../chunks/B2BHS6mp.js";import{i as I,s as et,a as tt}from"../chunks/CBIv6OHw.js";import{f as Z,h as nt}from"../chunks/vEgz6lHp.js";import{p as ke,g as st,h as z,l as ot,r as at,e as rt,s as Ce,d as re,f as ie,k as it,i as ct,b as lt,m as dt,v as ut,c as ce,a as ft}from"../chunks/D5Qbvdj6.js";import"../chunks/8UtF8RsF.js";function vt(l,m){let n=m;n.endsWith("/")||(n+="/");const v=l.startsWith("/")?l.substring(1):l;return new URL(v,n).toString()}function gt(l,m){const n=new URL(l),v=new URL(m),_=n.pathname.startsWith("/")?n.pathname.substring(1):n.pathname;let P=v.pathname;return P.endsWith("/")||(P+="/"),v.pathname=P+_,v.search=n.search,v.hash=n.hash,v.toString()}function ht(l){return!l.match(/^https?:\/\//)&&!l.startsWith("data:")&&!l.startsWith("blob:")}function mt(l){return l.startsWith("http://local-server.furcadia.com:8080/")||l.startsWith("https://terra.furcadia.com/")}function pt(l,m){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(v,_,...P){let o=_.toString();return ht(o)?(o=vt(o,l),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${o}`)):mt(o)&&(o=gt(o,m),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${o}`)),super.open(v,o,...P)}}}class Le{buffer="";append(m){this.buffer+=m;const n=[];let v;for(;(v=this.buffer.indexOf(`
`))!==-1;){const _=this.buffer.substring(0,v);n.push(_),this.buffer=this.buffer.substring(v+1)}return n}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function bt(){const l={encode:o=>{const t=o.length,u=new Uint8Array(t);for(let c=0;c<t;c++)u[c]=o.charCodeAt(c)&255;return u}},m={decode:o=>{if(typeof o=="string")return o;let t;o instanceof Uint8Array?t=o:o instanceof ArrayBuffer?t=new Uint8Array(o):t=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);let u="";const c=t.length,r=32768;for(let s=0;s<c;s+=r){const g=t.subarray(s,Math.min(s+r,c));u+=String.fromCharCode.apply(null,g)}return u}};let n=null,v;window.waitForFurc=new Promise(o=>{v=o});function _(o,t,u,c){if(!t.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const r=l.encode(t),s=new MessageEvent("message",{data:r,origin:"wss://lightbringer.furcadia.com"});s.tag=c,s.sourceId=u,o.dispatchEvent(s)}function P(o,t,u,c){if(o.readyState===WebSocket.OPEN){if(!t.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const r=l.encode(t);o.sendTagged?o.sendTagged(r,u,c):o.send(r)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new Le;_outgoingBuffer=new Le;constructor(t,u){if(super(t,u),t.toString().includes("furcadia")||t.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),n=this;const c=Z;c&&(c.send=(r,s,g)=>P(this,r,s,g),c.inject=(r,s,g)=>_(this,r,s,g),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>{v(this);const r=Z;r&&r.notifyConnected()}),this.addEventListener("close",()=>{const r=Z;r&&r.notifyDisconnected()})}}send(t){this.sendTagged(t,void 0,void 0)}sendTagged(t,u,c){if(n!==this){super.send(t);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let r=typeof t=="string"?t:m.decode(t);const s=this._outgoingBuffer.append(r);if(s.length===0)return;const g=[];for(let b of s){const k=Z;if(k){const F=await k.processOutgoing(b,u,c);if(F==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}b=F}g.push(b)}if(g.length===0)return;const M=g.join(`
`)+`
`,W=l.encode(M);super.send(W)}).catch(r=>{console.error("Error in outgoing message queue:",r)})}_hookMessageEvent(t,u){const c=t.tag,r=t.sourceId;this._incomingQueue=this._incomingQueue.then(async()=>{let s=typeof t.data=="string"?t.data:m.decode(t.data);const g=this._incomingBuffer.append(s);if(g.length===0)return;const M=[];for(let F of g){const G=Z;if(G){const T=await G.processIncoming(F,r,c);if(T==null)continue;F=T}M.push(F)}if(M.length===0)return;const W=M.join(`
`)+`
`;let b=W;this.binaryType==="arraybuffer"?b=l.encode(W).buffer:this.binaryType==="blob"&&(b=new Blob([l.encode(W)]));const k=new MessageEvent("message",{data:b,origin:t.origin,source:t.source});u(k)}).catch(s=>{console.error("Error in incoming message queue:",s)})}set onmessage(t){n===this&&t?super.onmessage=u=>{this._hookMessageEvent(u,c=>{t.call(this,c)})}:super.onmessage=t}get onmessage(){return super.onmessage}addEventListener(t,u,c){if(t==="message"&&n===this&&typeof u=="function"){const r=s=>{this._hookMessageEvent(s,g=>{u.call(this,g)})};super.addEventListener(t,r,c);return}super.addEventListener(t,u,c)}}}async function _t(l){const m=await fetch(l);if(!m.ok)throw new Error(`Failed to fetch client script: ${m.statusText}`);let n=await m.text();n=n.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),n=n.replaceAll("WebSocket","FurcWebSocket");const v=n.length;n=(()=>{let P=n.indexOf("Missing login data");if(P===-1)return n;const o=n.substring(0,P),t="__instantiate",u=`
            let ${t} = (cls, ...args) => {
                // Instantate the class.
                const r = $2(cls, ...args);
                // Wait a tick then find the instance in the result object.
                setTimeout(() => {
                    for (const key in r) {
                        if (r[key] instanceof cls) {
                            console.log('[Furc Loader] Captured game instance.');
                            window.processGameClientInstance(r[key]);
                            return;
                        }
                    }
                    console.log('[Furc Loader] Warning: Could not find game instance in instantiated object.');
                }, 0);
                return r;
            }
        `,c=n.substring(P).replace(/;\s*(\w+)\s*=\s*(\w+)\s*\(\s*(\w+)\s*,/,`;${u}; $1 = ${t}($3,`);return o+c})(),v===n.length?console.warn("[Furc Loader] Warning: Could not find game instance assignment point to hook into."):window.processGameClientInstance=P=>{console.log("[Furc Loader] Processing game client instance...");const o=le(P),t=(()=>{for(const[c,r]of o)if(Ue(r).search(/this(\.\w+){3}\("Reconnecting..."\)/)!==-1)return r.bind(P)})(),u=(()=>{const c=(()=>{for(const[s,g]of o)if(qe(g).includes('"Se√±or Furreton"'))return g})();if(!c)return;const r=(()=>{for(const[s,g]of le(c))if(qe(g).includes('"chatBuffer"'))return g})();if(r){for(const[s,g]of le(r))if(Ue(g).includes('"specitag"'))return g.bind(r)}})();t&&u&&(window.__CLIENT_HOOKS={reconnect:t,appendChat:u})};const _=document.createElement("script");_.textContent=n,_.async=!0,document.body.appendChild(_)}function le(l){const m=new Set,n=v=>{!v||!(v instanceof Object)||(Object.getOwnPropertyNames(v).filter(_=>_!=="constructor"&&v[_]).forEach(_=>m.add([_,v[_]])),n(Object.getPrototypeOf(v)))};return n(l),[...m].sort()}function yt(l){return l&&l instanceof Object?Object.getPrototypeOf(l).constructor:null}function qe(l,m=""){const n=yt(l);return n?n.toString():m}function Ue(l,m=""){return typeof l=="function"?l.toString():m}var wt=x('<div class="config-btn svelte-a1qo0m" title="Configure Plugin">‚öôÔ∏è</div>'),Pt=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">ID:</span> </div>'),kt=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),Ct=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),Lt=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Description:</span> </div>'),qt=x('<div class="plugin-details svelte-a1qo0m"><!> <!> <!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <div class="button-group svelte-a1qo0m"><button class="action-btn reload-btn svelte-a1qo0m">Reload Plugin</button> <button class="action-btn remove-btn svelte-a1qo0m">Remove Plugin</button></div></div>'),Ut=x('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div> <!> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),St=x('<li class="empty svelte-a1qo0m">No plugins installed</li>'),xt=x('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),Ft=x('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function $t(l,m){Fe(m,!1);const n=()=>tt(ke,"$pluginStore",v),[v,_]=et(),P=X();let o=X(!1),t=X(""),u=X(null),c=X(!1),r=X({}),s=Z;xe(()=>{window.Furnarchy=s.getExposedAPI(),ke.set(st()),s.plugins&&s.plugins.forEach(f=>{f.metadata.sourceUrl&&Ze(r,e(r)[f.metadata.sourceUrl]=f._handlers.configure.length>0)}),s.onRegister(f=>{const d=f.metadata||f,h=d.sourceUrl||f.sourceUrl;if(h){R(r,{...e(r),[h]:f._handlers.configure.length>0});const O=n().findIndex(j=>j.url===h);if(O!==-1){const j=s.loadingPluginUrl===h,$=n()[O];let U=!1;const E={...$};if(j){const V=d.toggle?!1:$.enabled!==!1;f._setEnabled(V),d.toggle&&$.enabled!==!1&&(E.enabled=!1,U=!0)}else f.enabled!==($.enabled!==!1)&&(E.enabled=f.enabled,U=!0);if($.name!==d.name&&(E.name=d.name,U=!0),$.id!==d.id&&(E.id=d.id,U=!0),$.description!==d.description&&(E.description=d.description,U=!0),$.version!==d.version&&(E.version=d.version,U=!0),$.author!==d.author&&(E.author=d.author,U=!0),U){const V=[...n()];V[O]=E,z(V)}}}});const a=s.version||"0.0.0";ot(a).then(()=>{G()})});function g(){R(o,!e(o))}async function M(){if(e(t)&&!n().some(a=>a.url===e(t))){R(c,!0);try{const a=await ut(e(t)),f=[...n(),{id:a.id,url:e(t),name:a.name,description:a.description,version:a.version,author:a.author,enabled:a.toggle!==void 0?!a.toggle:!0}];z(f),T(e(t)),R(t,"")}catch(a){alert(`Failed to verify plugin: ${a.message||a}`)}finally{R(c,!1)}}}function W(a){const f=n().find(h=>h.url===a);f&&f.id&&dt(f.id);const d=n().filter(h=>h.url!==a);z(d),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function b(a){const f=n().map(d=>{if(d.url===a){const h=d.enabled===void 0?!1:!d.enabled;if(s&&s.plugins){const O=s.plugins.find(j=>j.metadata.sourceUrl===a);O&&O._setEnabled(h)}return{...d,enabled:h}}return d});z(f)}function k(a){if(R(o,!1),s&&s.plugins){const f=s.plugins.find(d=>d.metadata.sourceUrl===a);f&&f._notifyConfigure()}}async function F(a){const f=document.querySelector(`script[data-plugin-url="${a}"]`);if(f&&f.remove(),s&&s.plugins){const d=s.plugins.findIndex(h=>h.metadata.sourceUrl===a);d!==-1&&(s.plugins[d]._setEnabled(!1),s.plugins.splice(d,1))}await T(a)}async function G(){await Promise.all(n().map(a=>T(a.url))),s.start()}async function T(a){if(!document.querySelector(`script[data-plugin-url="${a}"]`))try{const f=await fetch(a);if(!f.ok)throw new Error(`HTTP ${f.status}`);const d=await f.text();s.loadingPluginUrl=a;const h=document.createElement("script");h.textContent=d,h.dataset.pluginUrl=a,document.body.appendChild(h),console.log(`[PluginManager] Loaded via fetch: ${a}`)}catch(f){return console.warn(`[PluginManager] Fetch failed for ${a}, falling back to script tag.`,f),new Promise(d=>{const h=document.createElement("script");h.src=a,h.async=!0,h.dataset.pluginUrl=a,h.onload=()=>{console.log(`[PluginManager] Loaded via tag: ${a}`),d()},h.onerror=()=>{console.error(`[PluginManager] Failed to load: ${a}`),d()},document.body.appendChild(h)})}finally{s.loadingPluginUrl=null}}Ge(()=>n(),()=>{R(P,n())}),Ve(),Se();var ee=Ft(),de=y(ee),Re=p(de,2);{var Ae=a=>{var f=xt(),d=Ee(f),h=p(d,2),O=y(h),j=p(y(O),2);w(O);var $=p(O,2),U=y($);at(U);var E=p(U,2),V=y(E,!0);w(E),w($);var te=p($,2),ue=y(te);rt(ue,1,n,ct,(B,i)=>{var J=Ut();let ve;var ne=y(J),ge=y(ne),K=y(ge);let he;var me=p(K,2);{var We=N=>{var Q=wt();A("click",Q,ie(()=>k(e(i).url))),S(N,Q)};I(me,N=>{e(r),e(i),L(()=>e(r)[e(i).url])&&N(We)})}var se=p(me,2),Te=y(se,!0);w(se),w(ge),w(ne);var Be=p(ne,2);{var He=N=>{var Q=qt(),pe=y(Q);{var De=C=>{var q=Pt(),Y=p(y(q));w(q),D(()=>H(Y,` ${e(i),L(()=>e(i).id)??""}`)),S(C,q)};I(pe,C=>{e(i),L(()=>e(i).id)&&C(De)})}var be=p(pe,2);{var Xe=C=>{var q=kt(),Y=p(y(q));w(q),D(()=>H(Y,` ${e(i),L(()=>e(i).version)??""}`)),S(C,q)};I(be,C=>{e(i),L(()=>e(i).version)&&C(Xe)})}var _e=p(be,2);{var je=C=>{var q=Ct(),Y=p(y(q));w(q),D(()=>H(Y,` ${e(i),L(()=>e(i).author)??""}`)),S(C,q)};I(_e,C=>{e(i),L(()=>e(i).author)&&C(je)})}var ye=p(_e,2);{var Ne=C=>{var q=Lt(),Y=p(y(q));w(q),D(()=>H(Y,` ${e(i),L(()=>e(i).description)??""}`)),S(C,q)};I(ye,C=>{e(i),L(()=>e(i).description)&&C(Ne)})}var oe=p(ye,2),ae=p(y(oe),2),Qe=y(ae,!0);w(ae),w(oe);var we=p(oe,2),Pe=y(we),Ye=p(Pe,2);w(we),w(Q),D(()=>{re(ae,"href",(e(i),L(()=>e(i).url))),H(Qe,(e(i),L(()=>e(i).url)))}),A("click",Pe,()=>F(e(i).url)),A("click",Ye,()=>W(e(i).url)),A("click",Q,ie(function(C){it.call(this,m,C)})),S(N,Q)};I(Be,N=>{e(u),e(i),L(()=>e(u)===e(i).url)&&N(He)})}w(J),D(()=>{ve=Ce(J,1,"plugin-item svelte-a1qo0m",null,ve,{expanded:e(u)===e(i).url,disabled:e(i).enabled===!1}),he=Ce(K,1,"toggle-switch svelte-a1qo0m",null,he,{checked:e(i).enabled!==!1}),re(K,"title",(e(i),L(()=>e(i).enabled!==!1?"Disable Plugin":"Enable Plugin"))),re(se,"title",(e(i),L(()=>e(i).url))),H(Te,(e(i),L(()=>e(i).name||e(i).url)))}),A("click",K,ie(()=>b(e(i).url))),A("click",J,()=>R(u,e(u)===e(i).url?null:e(i).url)),S(B,J)});var Me=p(ue,2);{var Oe=B=>{var i=St();S(B,i)};I(Me,B=>{n(),L(()=>n().length===0)&&B(Oe)})}w(te);var fe=p(te,2),Ie=p(y(fe),4);Ie.textContent=`Furnarchy Zero v${L(()=>window.Furnarchy?.version||"...")??""}`,w(fe),w(h),D(()=>{U.disabled=e(c),E.disabled=e(c),H(V,e(c)?"...":"Add")}),A("click",d,g),A("click",j,g),lt(U,()=>e(t),B=>R(t,B)),A("keydown",U,B=>B.key==="Enter"&&!e(c)&&M()),A("click",E,M),S(a,f)};I(Re,a=>{e(o)&&a(Ae)})}w(ee),A("click",de,g),S(l,ee),$e(),_()}var Et=x('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),Rt=x('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),At=x('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),Mt=x('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function Qt(l,m){Fe(m,!1);const n=ce.PUBLIC_FURCADIA_CLIENT_JS_URL,v=ce.PUBLIC_AUTH_PROXY_URL,_=ce.PUBLIC_PLAY_FURCADIA_URL;let P=X(!1),o=X(""),t=!1;xe(()=>{const k=ft()||v;console.log(`[Furnarchy] Using backend URL: ${k}`),pt(_,k),bt(),u()});async function u(){if(!t){R(P,!0),R(o,"");try{await _t(n),t=!0}catch(b){console.error(b),R(o,b.message||"An unknown error occurred")}finally{R(P,!1)}}}Se();var c=Mt();nt("hy9bcf",b=>{var k=Et();Ke(6),Je(()=>{ze.title="Furnarchy Zero"}),S(b,k)});var r=Ee(c);$t(r,{});var s=p(r,2);{var g=b=>{var k=Rt();S(b,k)};I(s,b=>{e(P)&&b(g)})}var M=p(s,12);{var W=b=>{var k=At(),F=y(k),G=y(F);w(F);var T=p(F,2);w(k),D(()=>H(G,`Error: ${e(o)??""}`)),A("click",T,()=>window.location.reload()),S(b,k)};I(M,b=>{e(o)&&b(W)})}S(l,c),$e()}export{Qt as component};
