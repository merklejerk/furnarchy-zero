import{d as Xt,f as M,s as Z,b as h,g as G,e as De,t as Pe}from"../chunks/B3FnF0oJ.js";import{i as bt}from"../chunks/DumpmRuy.js";import{o as Ot,a as jt}from"../chunks/iqYowYmk.js";import{y as qt,u as E,z as Jt,ad as ze,b5 as Vt,f as Yt,an as Kt,af as tt,aG as We,l as Ut,m as y,a8 as Bt,i as e,ai as g,ak as w,aj as p,t as V,ag as P,aH as Oe,b6 as Qt,ah as nt,av as kt,as as pt,at as Gt,R as qe,k as Zt,b4 as $t}from"../chunks/B34q5ZhI.js";import{e as et,i as zt}from"../chunks/T5S5BKvr.js";import{i as T}from"../chunks/B-8yQNBF.js";import{h as en}from"../chunks/wBzAbtsP.js";import{s as je,a as ue,b as tn,p as nn}from"../chunks/B8CywloG.js";import{h as fe}from"../chunks/6L543JdX.js";import{s as xt}from"../chunks/DPoAyR-t.js";import{b as Mt}from"../chunks/CsEh3Pnl.js";import{u as Dt,c as Tt}from"../chunks/DU95RE0J.js";import{p as he}from"../chunks/C-xiGS0O.js";const an=!0;function rn(a,r,t){qt(()=>{var c=E(()=>r(a,t?.())||{});if(t&&c?.update){var o=!1,l={};Jt(()=>{var d=t();ze(d),o&&Vt(l,d)&&(l=d,c.update(d))}),o=!0}if(c?.destroy)return()=>c.destroy()})}function on(a,r,t){var c=Yt(a,r);c&&c.set&&(a[r]=t,Kt(()=>{a[r]=null}))}const Ct=an,sn=!1,qa=Object.freeze(Object.defineProperty({__proto__:null,ssr:sn},Symbol.toStringTag,{value:"Module"})),Et={"#SA":"üòä","#SB":"üòõ","#SC":"‚òπÔ∏è","#SD":"üòâ","#SE":"üòÅ","#SF":"üòØ","#SG":"ü§™","#SH":"üòë","#SI":"üò§","#SJ":"üòü","#SK":"üòè","#SL":"üò¢","#SM":"üéµ","#SN":"[OOC]","#SO":"‚ù§Ô∏è","#SP":"[AFK]","#SQ":"ü´£","#SR":"üòä","#SS":"üòú","#ST":"üòã","#SU":"üòÆ‚Äçüí®","#SV":"üòñ","#SW":"üòå","#SX":"[BRB]","#SY":"üíß","#SZ":"üêüÔ∏è","#Sa":"‚≠êÔ∏è","#Sb":"‚õàÔ∏è","#Sc":"üåª","#Sd":"üç∫","#Se":"üî™","#Sf":"üíÄ","#Sg":"üí≠","#Sh":"ü§¨","#Si":"üè†Ô∏è","#Sj":"‚òéÔ∏è","#Sk":"üçï","#Sl":"üåúÔ∏è","#Sm":"üöΩ","#Sn":"üìÅ","#So":"ü¶ã","#Sp":"ü¶ã","#Sq":"ü•á","#Sr":"ü•à","#Ss":"üíé","#St":"üíé","#Su":"üíé","#Sv":"üíé","#Sw":"ü™®","#Sx":"üìú","#Sy":"‚úÇÔ∏è","#S1":"ü™ô","#S2":"ü™ô","#S3":"ü™ô","#C6":"üç™"},cn=Object.entries(Et).reduce((a,[r,t])=>(a[t]=r,a),{});function ln(a){let r=a.replace(/[\r\n]+/g," ");for(const[t,c]of Object.entries(cn))r=r.replaceAll(t,c);return r}function me(a){if(typeof document>"u")return a;const r=document.createElement("template");r.innerHTML=a;const t=r.content,c=["b","i","u","a","name"],o=(d,u=!1)=>{if(d.nodeType===Node.TEXT_NODE){let v=d.textContent||"";v=v.replace(/\|/g," "),v=v.replace(/#S[A-Za-z1-3]/g,b=>Et[b]||b);const m=document.createElement("div");m.textContent=v;const S=m.innerHTML;return u?S:S.replace(/(https?:\/\/[^\s<"']*[^\s<"'. ,!?\[\]])/g,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>')}if(d.nodeType===Node.ELEMENT_NODE){const v=d,m=v.tagName.toLowerCase();let S="";for(const b of Array.from(v.childNodes))S+=o(b,u||m==="a"||m==="name");if(c.includes(m)){if(m==="a"){const b=v.getAttribute("href");if(b&&(b.startsWith("http://")||b.startsWith("https://")))return`<a href="${b.replace(/"/g,"&quot;")}" target="_blank" rel="noopener noreferrer">${S}</a>`}if(m==="name"){const b=v.getAttribute("shortname");if(b)return`<button class="name-link" data-shortname="${b.replace(/"/g,"&quot;")}">${S}</button>`}return`<${m}>${S}</${m}>`}return S}return""};let l="";for(const d of Array.from(t.childNodes))l+=o(d);return l}function $(a){return a.replace(/\|/g," ")}async function Je(a,r,t){const c=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(a)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:c},r,o),d=new Uint8Array(4+c.length+l.byteLength);return new DataView(d.buffer).setInt32(0,t),d.set(c,4),d.set(new Uint8Array(l),4+c.length),d.buffer}async function dn(a,r,t){try{if(a.byteLength<32)return null;const c=new Uint8Array(a);if(new DataView(a).getInt32(0)!==t)return null;const d=c.slice(4,16),u=c.slice(16),v=await crypto.subtle.decrypt({name:"AES-GCM",iv:d},r,u);return JSON.parse(new TextDecoder().decode(v))}catch{return null}}const Ze=43200,It=1440,Pt=Symbol.for("constructDateFrom");function At(a,r){return typeof a=="function"?a(r):a&&typeof a=="object"&&Pt in a?a[Pt](r):a instanceof Date?new a.constructor(r):new Date(r)}function xe(a,r){return At(a,a)}let un={};function fn(){return un}function Wt(a){const r=xe(a),t=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return t.setUTCFullYear(r.getFullYear()),+a-+t}function _t(a,...r){const t=At.bind(null,a||r.find(c=>typeof c=="object"));return r.map(t)}function $e(a,r){const t=+xe(a)-+xe(r);return t<0?-1:t>0?1:t}function mn(a,r,t){const[c,o]=_t(t?.in,a,r),l=c.getFullYear()-o.getFullYear(),d=c.getMonth()-o.getMonth();return l*12+d}function hn(a){return r=>{const c=(a?Math[a]:Math.trunc)(r);return c===0?0:c}}function vn(a,r){return+xe(a)-+xe(r)}function gn(a,r){const t=xe(a);return t.setHours(23,59,59,999),t}function pn(a,r){const t=xe(a),c=t.getMonth();return t.setFullYear(t.getFullYear(),c+1,0),t.setHours(23,59,59,999),t}function yn(a,r){const t=xe(a);return+gn(t)==+pn(t)}function bn(a,r,t){const[c,o,l]=_t(t?.in,a,a,r),d=$e(o,l),u=Math.abs(mn(o,l));if(u<1)return 0;o.getMonth()===1&&o.getDate()>27&&o.setDate(30),o.setMonth(o.getMonth()-d*u);let v=$e(o,l)===-d;yn(c)&&u===1&&$e(c,l)===1&&(v=!1);const m=d*(u-+v);return m===0?0:m}function _n(a,r,t){const c=vn(a,r)/1e3;return hn(t?.roundingMethod)(c)}const Sn={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},wn=(a,r,t)=>{let c;const o=Sn[a];return typeof o=="string"?c=o:r===1?c=o.one:c=o.other.replace("{{count}}",r.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+c:c+" ago":c};function yt(a){return(r={})=>{const t=r.width?String(r.width):a.defaultWidth;return a.formats[t]||a.formats[a.defaultWidth]}}const kn={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xn={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Mn={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Dn={date:yt({formats:kn,defaultWidth:"full"}),time:yt({formats:xn,defaultWidth:"full"}),dateTime:yt({formats:Mn,defaultWidth:"full"})},Tn={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Cn=(a,r,t,c)=>Tn[a];function Ve(a){return(r,t)=>{const c=t?.context?String(t.context):"standalone";let o;if(c==="formatting"&&a.formattingValues){const d=a.defaultFormattingWidth||a.defaultWidth,u=t?.width?String(t.width):d;o=a.formattingValues[u]||a.formattingValues[d]}else{const d=a.defaultWidth,u=t?.width?String(t.width):a.defaultWidth;o=a.values[u]||a.values[d]}const l=a.argumentCallback?a.argumentCallback(r):r;return o[l]}}const In={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Pn={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Wn={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},On={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},jn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},zn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},En=(a,r)=>{const t=Number(a),c=t%100;if(c>20||c<10)switch(c%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},An={ordinalNumber:En,era:Ve({values:In,defaultWidth:"wide"}),quarter:Ve({values:Pn,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Ve({values:Wn,defaultWidth:"wide"}),day:Ve({values:On,defaultWidth:"wide"}),dayPeriod:Ve({values:jn,defaultWidth:"wide",formattingValues:zn,defaultFormattingWidth:"wide"})};function Ye(a){return(r,t={})=>{const c=t.width,o=c&&a.matchPatterns[c]||a.matchPatterns[a.defaultMatchWidth],l=r.match(o);if(!l)return null;const d=l[0],u=c&&a.parsePatterns[c]||a.parsePatterns[a.defaultParseWidth],v=Array.isArray(u)?Rn(u,b=>b.test(d)):Nn(u,b=>b.test(d));let m;m=a.valueCallback?a.valueCallback(v):v,m=t.valueCallback?t.valueCallback(m):m;const S=r.slice(d.length);return{value:m,rest:S}}}function Nn(a,r){for(const t in a)if(Object.prototype.hasOwnProperty.call(a,t)&&r(a[t]))return t}function Rn(a,r){for(let t=0;t<a.length;t++)if(r(a[t]))return t}function Ln(a){return(r,t={})=>{const c=r.match(a.matchPattern);if(!c)return null;const o=c[0],l=r.match(a.parsePattern);if(!l)return null;let d=a.valueCallback?a.valueCallback(l[0]):l[0];d=t.valueCallback?t.valueCallback(d):d;const u=r.slice(o.length);return{value:d,rest:u}}}const Fn=/^(\d+)(th|st|nd|rd)?/i,Hn=/\d+/i,Xn={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qn={any:[/^b/i,/^(a|c)/i]},Jn={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Vn={any:[/1/i,/2/i,/3/i,/4/i]},Yn={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Kn={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Un={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Bn={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Qn={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Gn={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Zn={ordinalNumber:Ln({matchPattern:Fn,parsePattern:Hn,valueCallback:a=>parseInt(a,10)}),era:Ye({matchPatterns:Xn,defaultMatchWidth:"wide",parsePatterns:qn,defaultParseWidth:"any"}),quarter:Ye({matchPatterns:Jn,defaultMatchWidth:"wide",parsePatterns:Vn,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Ye({matchPatterns:Yn,defaultMatchWidth:"wide",parsePatterns:Kn,defaultParseWidth:"any"}),day:Ye({matchPatterns:Un,defaultMatchWidth:"wide",parsePatterns:Bn,defaultParseWidth:"any"}),dayPeriod:Ye({matchPatterns:Qn,defaultMatchWidth:"any",parsePatterns:Gn,defaultParseWidth:"any"})},$n={code:"en-US",formatDistance:wn,formatLong:Dn,formatRelative:Cn,localize:An,match:Zn,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ea(a,r,t){const c=fn(),o=t?.locale??c.locale??$n,l=2520,d=$e(a,r);if(isNaN(d))throw new RangeError("Invalid time value");const u=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:d}),[v,m]=_t(t?.in,...d>0?[r,a]:[a,r]),S=_n(m,v),b=(Wt(m)-Wt(v))/1e3,k=Math.round((S-b)/60);let I;if(k<2)return t?.includeSeconds?S<5?o.formatDistance("lessThanXSeconds",5,u):S<10?o.formatDistance("lessThanXSeconds",10,u):S<20?o.formatDistance("lessThanXSeconds",20,u):S<40?o.formatDistance("halfAMinute",0,u):S<60?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",1,u):k===0?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",k,u);if(k<45)return o.formatDistance("xMinutes",k,u);if(k<90)return o.formatDistance("aboutXHours",1,u);if(k<It){const C=Math.round(k/60);return o.formatDistance("aboutXHours",C,u)}else{if(k<l)return o.formatDistance("xDays",1,u);if(k<Ze){const C=Math.round(k/It);return o.formatDistance("xDays",C,u)}else if(k<Ze*2)return I=Math.round(k/Ze),o.formatDistance("aboutXMonths",I,u)}if(I=bn(m,v),I<12){const C=Math.round(k/Ze);return o.formatDistance("xMonths",C,u)}else{const C=I%12,D=Math.trunc(I/12);return C<3?o.formatDistance("aboutXYears",D,u):C<9?o.formatDistance("overXYears",D,u):o.formatDistance("almostXYears",D+1,u)}}var ta=M('<div><div class="menu-actions svelte-17jz8d4"><button class="svelte-17jz8d4">Look</button> <button class="svelte-17jz8d4">Whisper</button></div> <div class="menu-arrow svelte-17jz8d4"></div></div>'),na=M('<button class="sender-btn name-link svelte-17jz8d4"> </button>'),aa=M('<button class="sender-btn name-link svelte-17jz8d4"> </button>'),ra=M('<!> <span class="text"><!></span>',1),oa=M('<button class="sender-btn name-link svelte-17jz8d4"> </button> <span class="text"><!></span>',1),sa=M('[ You whisper "<!>" to <button class="sender-btn name-link svelte-17jz8d4"> </button>. ]',1),ia=M('[ <button class="sender-btn name-link svelte-17jz8d4"> </button> whispers, "<!>" to you. ]',1),ca=M('<span class="text"><!></span>'),la=M('üé≤ <button class="sender-btn name-link svelte-17jz8d4"> </button> <span class="text">rolls <!></span>',1),da=M('<span class="text"><!> <!></span>'),ua=M('<span class="text">&nbsp;&nbsp;&gt; <!></span>'),fa=M('<span class="sender svelte-17jz8d4">üí¨</span> <span class="text"><!></span>',1),ma=M('<button class="name-link"> </button><!>',1),ha=M('<span class="text"><b>Nearby:</b> <!></span>'),va=M('<span class="text">üß© <!></span>'),ga=M('<span class="text"> </span>'),pa=M('<div><!> <span class="timestamp svelte-17jz8d4"> </span></div>'),ya=M('<div class="empty-state svelte-17jz8d4">Waiting for chat...</div>'),ba=M('<div class="chat-view svelte-17jz8d4"><div class="chat-log svelte-17jz8d4" role="log" aria-live="polite" tabindex="-1"><button class="nearby-btn-float svelte-17jz8d4" title="List nearby players"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-17jz8d4"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button> <!> <!> <!></div> <footer><div><textarea rows="1" class="svelte-17jz8d4"></textarea> <button class="send-btn svelte-17jz8d4" aria-label="Send"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-17jz8d4"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div></footer></div>');function _a(a,r){tt(r,!0);let t=We(void 0),c=We(void 0),o=We(""),l=Oe(()=>e(o).startsWith("/")?"whisper":e(o).startsWith(":")?"emote":e(o).startsWith("`")?"raw":"default"),d=We(Ut(Date.now())),u,v=We(null),m=We(!0),S=[],b="";function k(s,i){const f=_=>{s&&!s.contains(_.target)&&!_.defaultPrevented&&i()};return document.addEventListener("click",f,!0),{destroy(){document.removeEventListener("click",f,!0)}}}Ot(()=>{u=setInterval(()=>{y(d,Date.now(),!0)},3e4)}),jt(()=>{u&&clearInterval(u)});function I(s){s.key==="Enter"&&!s.shiftKey?(s.preventDefault(),C()):s.key==="Escape"&&(y(o,""),e(c)&&D())}function C(){if(!e(o).trim())return;const s=e(l)==="raw"?e(o):ln(e(o));r.onSendMessage(s),y(o,""),e(c)&&(e(c).style.height="auto"),e(t)&&(e(t).scrollTop=e(t).scrollHeight,y(m,!0),r.onUnreadChange(!1))}function D(){e(c)&&(e(c).style.height="auto",e(c).style.height=e(c).scrollHeight+"px")}function ve(){if(!e(t))return;Math.abs(e(t).scrollHeight-e(t).scrollTop-e(t).clientHeight)<15?e(m)||(y(m,!0),r.onUnreadChange(!1)):e(m)&&y(m,!1)}function Te(){r.status==="Connected"&&r.onSendMessage({type:"nearby_req"})}Bt(()=>{const s=r.id,i=r.messages;if(!e(t))return;const f=e(t);E(()=>{const _=s!==b,x=i!==S;b=s,S=i,_?(f.scrollTop=f.scrollHeight,y(m,!0),r.onUnreadChange(!1)):x&&(e(m)?f.scrollTop=f.scrollHeight:r.onUnreadChange(!0))})});function ae(){y(v,null)}function Ke(s){const f=s.target.closest(".name-link");if(f&&e(t)){const _=f.getAttribute("data-shortname");if(_){const x=f.getBoundingClientRect(),j=e(t).getBoundingClientRect(),Q=x.top-j.top<60?"bottom":"top",re=x.left-j.left+e(t).scrollLeft+x.width/2,A=110,z=10,ge=e(t).scrollLeft+A/2+z,pe=e(t).scrollLeft+j.width-A/2-z,oe=Math.max(ge,Math.min(pe,re)),Y=re-oe;y(v,{sn:_,side:Q,x:oe,y:(Q==="top"?x.top:x.bottom)-j.top+e(t).scrollTop,arrowOffset:Y},!0)}}else ae()}function at(s){if((s.key==="Enter"||s.key===" ")&&e(t)){const f=s.target.closest(".name-link");if(f){s.preventDefault();const _=f.getAttribute("data-shortname");if(_){const x=f.getBoundingClientRect(),j=e(t).getBoundingClientRect(),Q=x.top-j.top<60?"bottom":"top",re=x.left-j.left+e(t).scrollLeft+x.width/2,A=110,z=10,ge=e(t).scrollLeft+A/2+z,pe=e(t).scrollLeft+j.width-A/2-z,oe=Math.max(ge,Math.min(pe,re)),Y=re-oe;y(v,{sn:_,side:Q,x:oe,y:(Q==="top"?x.top:x.bottom)-j.top+e(t).scrollTop,arrowOffset:Y},!0)}}}}function Ee(s){r.onSendMessage({type:"glook",name:s}),ae()}function rt(s){const i=`/%${s} `;if(e(o).startsWith("/")){const f=e(o).indexOf(" ");f!==-1?y(o,i+e(o).substring(f+1)):y(o,i)}else y(o,i+e(o).trimStart());e(c)&&(e(c).focus(),D()),ae()}var Ae=ba(),B=g(Ae);B.__click=Ke,B.__keydown=at;var Me=g(B);Me.__click=Te;var Ne=w(Me,2);{var Ue=s=>{var i=ta();let f;var _=g(i),x=g(_);x.__click=()=>Ee(e(v).sn);var j=w(x,2);j.__click=()=>rt(e(v).sn),p(_);var Fe=w(_,2);p(i),rn(i,(Q,re)=>k?.(Q,re),()=>ae),V(()=>{f=je(i,1,"name-menu svelte-17jz8d4",null,f,{"is-bottom":e(v).side==="bottom"}),xt(i,`left: ${e(v).x??""}px; top: ${e(v).y??""}px;`),xt(Fe,`left: calc(50% + ${e(v).arrowOffset??""}px)`)}),h(s,i)};T(Ne,s=>{e(v)&&s(Ue)})}var Be=w(Ne,2);et(Be,17,()=>r.messages,s=>s.id,(s,i)=>{var f=pa();let _;var x=g(f);{var j=A=>{const z=Oe(()=>e(i).cmd);var ge=ra(),pe=P(ge);{var oe=R=>{var L=na(),F=g(L);p(L),V((W,ie)=>{ue(L,"data-shortname",W),Z(F,`${ie??""}:`)},[()=>Dt.getShortname(r.myCharacterName),()=>$(r.myCharacterName)]),h(R,L)},Y=R=>{var L=aa(),F=g(L);p(L),V(W=>{ue(L,"data-shortname",e(z).fromShort),Z(F,`${W??""}:`)},[()=>$(e(z).from)]),h(R,L)};T(pe,R=>{e(z).isSelf?R(oe):R(Y,!1)})}var se=w(pe,2),Ce=g(se);fe(Ce,()=>me(e(z).message)),p(se),h(A,ge)},Fe=A=>{var z=G(),ge=P(z);{var pe=Y=>{const se=Oe(()=>e(i).cmd);var Ce=oa(),R=P(Ce),L=g(R,!0);p(R);var F=w(R,2),W=g(F);fe(W,()=>me(e(se).message)),p(F),V(ie=>{ue(R,"data-shortname",e(se).fromShort),Z(L,ie)},[()=>$(e(se).from)]),h(Y,Ce)},oe=Y=>{var se=G(),Ce=P(se);{var R=F=>{const W=Oe(()=>e(i).cmd);var ie=ca(),st=g(ie);{var it=H=>{var te=sa(),N=w(P(te));fe(N,()=>me(e(W).message));var ce=w(N,2),X=g(ce,!0);p(ce),kt(),V(K=>{ue(ce,"data-shortname",e(W).toShort),Z(X,K)},[()=>$(e(W).to)]),h(H,te)},ye=H=>{var te=ia(),N=w(P(te)),ce=g(N,!0);p(N);var X=w(N,2);fe(X,()=>me(e(W).message)),kt(),V(K=>{ue(N,"data-shortname",e(W).fromShort),Z(ce,K)},[()=>$(e(W).from)]),h(H,te)};T(st,H=>{e(W).isSelf?H(it):H(ye,!1)})}p(ie),h(F,ie)},L=F=>{var W=G(),ie=P(W);{var st=ye=>{const H=Oe(()=>e(i).cmd);var te=la(),N=w(P(te)),ce=g(N,!0);p(N);var X=w(N,2),K=w(g(X));fe(K,()=>me(e(H).message)),p(X),V(Ie=>{ue(N,"data-shortname",e(H).fromShort),Z(ce,Ie)},[()=>$(e(H).from)]),h(ye,te)},it=ye=>{var H=G(),te=P(H);{var N=X=>{var K=da(),Ie=g(K);{var ct=q=>{var _e=Pe("üîî");h(q,_e)},lt=q=>{var _e=G(),dt=P(_e);{var ut=U=>{var le=Pe("ü§ñ");h(U,le)},Se=U=>{var le=G(),He=P(le);{var ft=J=>{var de=Pe("üëÄ");h(J,de)},we=J=>{var de=Pe("‚ÑπÔ∏è");h(J,de)};T(He,J=>{/^\(You see\s+/i.test(e(i).cmd.text)?J(ft):J(we,!1)},!0)}h(U,le)};T(dt,U=>{/^<font\s+[^>]*color=['"]dragonspeak['"]/i.test(e(i).cmd.text)?U(ut):U(Se,!1)},!0)}h(q,_e)};T(Ie,q=>{/^<font\s+[^>]*color=['"](emit|bcast)['"]/i.test(e(i).cmd.text)?q(ct):q(lt,!1)})}var be=w(Ie,2);fe(be,()=>me(e(i).cmd.text)),p(K),h(X,K)},ce=X=>{var K=G(),Ie=P(K);{var ct=be=>{var q=ua(),_e=w(g(q));fe(_e,()=>me(e(i).cmd.description)),p(q),h(be,q)},lt=be=>{var q=G(),_e=P(q);{var dt=Se=>{var U=fa(),le=w(P(U),2),He=g(le);fe(He,()=>me(e(i).cmd.content)),p(le),h(Se,U)},ut=Se=>{var U=G(),le=P(U);{var He=we=>{const J=Oe(()=>[...e(i).cmd.players].sort((O,ne)=>O.localeCompare(ne)));var de=ha(),mt=w(g(de),2);{var ht=O=>{var ne=Pe("(None)");h(O,ne)},ke=O=>{var ne=G(),vt=P(ne);et(vt,17,()=>e(J),zt,(Nt,St,Rt)=>{var wt=ma(),Ge=P(wt),Lt=g(Ge,!0);p(Ge);var Ft=w(Ge);{var Ht=Xe=>{var gt=Pe(",¬†");h(Xe,gt)};T(Ft,Xe=>{Rt<e(J).length-1&&Xe(Ht)})}V((Xe,gt)=>{ue(Ge,"data-shortname",Xe),Z(Lt,gt)},[()=>Dt.getShortname(e(St)),()=>$(e(St))]),h(Nt,wt)}),h(O,ne)};T(mt,O=>{e(J).length===0?O(ht):O(ke,!1)})}p(de),h(we,de)},ft=we=>{var J=G(),de=P(J);{var mt=ke=>{var O=va(),ne=w(g(O));fe(ne,()=>me(e(i).cmd.text)),p(O),h(ke,O)},ht=ke=>{var O=ga(),ne=g(O,!0);p(O),V(vt=>Z(ne,vt),[()=>"raw"in e(i).cmd?e(i).cmd.raw:JSON.stringify(e(i).cmd)]),h(ke,O)};T(de,ke=>{e(i).cmd.type==="notify"?ke(mt):ke(ht,!1)},!0)}h(we,J)};T(le,we=>{e(i).cmd.type==="nearby-players"?we(He):we(ft,!1)},!0)}h(Se,U)};T(_e,Se=>{e(i).cmd.type==="dialog-box"?Se(dt):Se(ut,!1)},!0)}h(be,q)};T(Ie,be=>{e(i).cmd.type==="description"?be(ct):be(lt,!1)},!0)}h(X,K)};T(te,X=>{e(i).cmd.type==="chat"?X(N):X(ce,!1)},!0)}h(ye,H)};T(ie,ye=>{e(i).cmd.type==="roll"?ye(st):ye(it,!1)},!0)}h(F,W)};T(Ce,F=>{e(i).cmd.type==="whisper"?F(R):F(L,!1)},!0)}h(Y,se)};T(ge,Y=>{e(i).cmd.type==="emote"?Y(pe):Y(oe,!1)},!0)}h(A,z)};T(x,A=>{e(i).cmd.type==="speech"?A(j):A(Fe,!1)})}var Q=w(x,2),re=g(Q,!0);p(Q),p(f),V((A,z)=>{_=je(f,1,`message type-${e(i).cmd.type??""}`,"svelte-17jz8d4",_,{"is-self":"isSelf"in e(i).cmd&&e(i).cmd.isSelf}),ue(Q,"title",A),Z(re,z)},[()=>new Date(e(i).timestamp).toLocaleString(),()=>ea(new Date(e(i).timestamp),new Date(e(d)),{addSuffix:!0})]),h(s,f)});var ot=w(Be,2);{var Qe=s=>{var i=ya();h(s,i)};T(ot,s=>{r.messages.length===0&&s(Qe)})}p(B),Mt(B,s=>y(t,s),()=>e(t));var Re=w(B,2),Le=g(Re),ee=g(Le);Qt(ee),ee.__keydown=I,ee.__input=D,Mt(ee,s=>y(c,s),()=>e(c));var n=w(ee,2);n.__click=C,p(Le),p(Re),p(Ae),V(()=>{Me.disabled=r.status!=="Connected",je(Re,1,`input-container ${r.status!=="Connected"?"disabled":""}`,"svelte-17jz8d4"),je(Le,1,`textarea-wrapper mode-${e(l)??""}`,"svelte-17jz8d4"),ue(ee,"placeholder",r.status==="Connected"?"Type a command or chat...":r.status),ee.disabled=r.status!=="Connected",n.disabled=r.status!=="Connected"}),De("scroll",B,ve),tn(ee,()=>e(o),s=>y(o,s)),h(a,Ae),nt()}Xt(["click","keydown","input"]);var Sa=M('<div role="button" tabindex="0"><div class="tab-content svelte-1ttge3k"><span>‚óè</span> <span class="name svelte-1ttge3k"> </span> <button class="close-btn svelte-1ttge3k">√ó</button></div></div>');function wa(a,r){tt(r,!1);let t=he(r,"name",8),c=he(r,"status",8),o=he(r,"active",8),l=he(r,"unread",8),d=he(r,"onSelect",8),u=he(r,"onClose",8);function v(D){D.stopPropagation(),u()()}bt();var m=Sa(),S=g(m),b=g(S),k=w(b,2),I=g(k,!0);p(k);var C=w(k,2);p(S),p(m),V((D,ve)=>{je(m,1,`session-tab ${o()?"active":""} ${l()?"unread":""}`,"svelte-1ttge3k"),je(b,1,`status-dot ${D??""}`,"svelte-1ttge3k"),Z(I,ve)},[()=>(ze(c()),E(()=>c().toLowerCase().includes("connected")?"online":"offline")),()=>(ze($),ze(t()),E(()=>$(t())))]),De("click",C,v),De("click",m,function(...D){d()?.apply(this,D)}),De("keydown",m,D=>(D.key==="Enter"||D.key===" ")&&d()()),h(a,m),nt()}var ka=M('<div class="session-card svelte-ooxe09"><button class="main-action svelte-ooxe09"><div class="info svelte-ooxe09"><div class="name svelte-ooxe09"> </div></div></button> <button class="delete-btn svelte-ooxe09" title="Delete Profile">‚úï</button></div>'),xa=M('<div class="empty-state svelte-ooxe09"><p>No paired characters found.</p> <p class="hint svelte-ooxe09">Scan a QR code from the Remote Furc plugin in <a href="https://furnarchy.xyz" target="_blank" rel="noopener noreferrer">Furnarchy</a> to get started!</p></div>'),Ma=M('<div class="session-picker svelte-ooxe09"><h2 class="title svelte-ooxe09">Sessions</h2> <div class="picker-viewport svelte-ooxe09"><!> <!></div></div>');function Da(a,r){tt(r,!1);let t=he(r,"sessions",8),c=he(r,"onSelect",8),o=he(r,"onRemove",8);bt();var l=Ma(),d=w(g(l),2),u=g(d);et(u,1,t,zt,(S,b)=>{var k=ka(),I=g(k),C=g(I),D=g(C),ve=g(D,!0);p(D),p(C),p(I);var Te=w(I,2);p(k),V(ae=>Z(ve,ae),[()=>(ze($),e(b),E(()=>$(e(b).name)))]),De("click",I,()=>c()(e(b))),De("click",Te,()=>o()(e(b).id)),h(S,k)});var v=w(u,2);{var m=S=>{var b=xa();h(S,b)};T(v,S=>{ze(t()),E(()=>t().length===0)&&S(m)})}p(d),p(l),h(a,l),nt()}var Ta=M('<meta name="viewport" content="width=device-width, initial-scale=1, interactive-widget=resizes-content"/>'),Ca=M('<button class="add-tab-btn svelte-ol5tb" title="Open Session Picker">+</button>'),Ia=M('<div class="remote-app classic-theme svelte-ol5tb"><header class="workspace-header svelte-ol5tb"><div class="tab-scroller svelte-ol5tb"><!> <!></div></header> <main class="workspace-main svelte-ol5tb"><!></main></div>');function Ja(a,r){tt(r,!1);const t=qe();let c=qe([]),o=qe([]),l=qe(null),d=qe(!1);const u=7200*1e3;Ot(()=>{v(),S(),window.addEventListener("keydown",Ke)}),jt(()=>{e(o).forEach(n=>I(n)),window.removeEventListener("keydown",Ke)});function v(){try{y(c,JSON.parse(localStorage.getItem("rf_pairings")||"[]"))}catch{y(c,[])}}function m(){const n=e(o).map(i=>i.config.id),s=e(o).filter(i=>i.unread).map(i=>i.config.id);localStorage.setItem("rf_active_tabs",JSON.stringify(n)),localStorage.setItem("rf_unread_tabs",JSON.stringify(s)),localStorage.setItem("rf_current_tab",e(l)||""),localStorage.setItem("rf_last_workspace_time",Date.now().toString())}function S(){const n=parseInt(localStorage.getItem("rf_last_workspace_time")||"0");if(Date.now()-n>u){localStorage.removeItem("rf_active_tabs"),y(d,!0);return}try{const s=JSON.parse(localStorage.getItem("rf_active_tabs")||"[]"),i=JSON.parse(localStorage.getItem("rf_unread_tabs")||"[]"),f=localStorage.getItem("rf_current_tab");s.forEach(_=>{const x=e(c).find(j=>j.id===_);x&&b(x,i.includes(_))}),f&&s.includes(f)?y(l,f):s.length>0&&y(l,s[0])}catch{}finally{y(d,!0)}}async function b(n,s=!1){let i=e(o).find(f=>f.config.id===n.id);if(i){y(l,n.id),i.unread=!1;return}i={config:n,ws:null,messages:[],status:"Connecting...",sharedKey:null,maxReceivedId:0,unread:s},y(o,[...e(o),i]),y(l,n.id);try{const f=Uint8Array.from(atob(n.secretB64),_=>_.charCodeAt(0));i.sharedKey=await crypto.subtle.importKey("raw",f,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),k(i)}catch{i.status="Error",y(o,e(o))}}function k(n){n.ws&&n.ws.close(),n.reconnectTimer&&clearTimeout(n.reconnectTimer);const s=new WebSocket(`${n.config.relayAddr}?room=${n.config.roomId}&role=remote`);n.ws=s,s.binaryType="arraybuffer",s.onopen=async()=>{n.status="Verifying...";const i=await Je({type:"sync_req",lastId:n.maxReceivedId},n.sharedKey,n.config.keyHint);s.send(i),n.heartbeatTimer&&clearInterval(n.heartbeatTimer),n.heartbeatTimer=window.setInterval(async()=>{if(s.readyState===WebSocket.OPEN){const f=await Je({type:"sync_req",lastId:n.maxReceivedId},n.sharedKey,n.config.keyHint);s.send(f)}},15e3)},s.onmessage=async i=>{const f=i.data;if(typeof f=="string")return;const _=await dn(f,n.sharedKey,n.config.keyHint);_&&(D(n),_.type==="ping"?(n.status!=="Connected"&&(n.status="Connected"),Je({type:"pong"},n.sharedKey,n.config.keyHint).then(x=>s.send(x))):_.type==="sync_res"?(n.status!=="Connected"&&(n.status="Connected"),_.lines.forEach(x=>C(n,x,!0))):_.type==="msg"&&(n.status!=="Connected"&&(n.status="Connected"),C(n,_)),y(o,e(o)))},s.onclose=()=>{n.heartbeatTimer&&clearInterval(n.heartbeatTimer),n.status="Reconnect...",y(o,e(o)),e(o).find(i=>i.config.id===n.config.id)&&(n.reconnectTimer=window.setTimeout(()=>k(n),5e3))}}function I(n){n.heartbeatTimer&&clearInterval(n.heartbeatTimer),n.presenceTimeout&&clearTimeout(n.presenceTimeout),n.reconnectTimer&&clearTimeout(n.reconnectTimer),n.ws&&(n.ws.onclose=null,n.ws.close())}function C(n,s,i=!1){n.messages.some(f=>f.seqId===s.id)||(s.id>n.maxReceivedId&&(n.maxReceivedId=s.id),n.messages=[...n.messages,{id:crypto.randomUUID(),seqId:s.id,cmd:s.cmd,timestamp:s.timestamp}].sort((f,_)=>f.seqId-_.seqId).slice(-300),!i&&e(l)!==n.config.id&&(n.unread=!0))}function D(n){clearTimeout(n.presenceTimeout),n.presenceTimeout=window.setTimeout(()=>{n.status="Host Offline",y(o,e(o))},4e4)}function ve(n){const s=e(o).findIndex(i=>i.config.id===n);if(s!==-1){const i=e(o)[s];I(i),y(o,e(o).filter(f=>f.config.id!==n)),e(l)===n&&y(l,e(o).length>0?e(o)[e(o).length-1].config.id:null),m()}}function Te(n){y(l,n);const s=e(o).find(i=>i.config.id===n);s&&(s.unread=!1),y(o,e(o))}function ae(n){if(e(o).length<=1)return;const s=e(o).findIndex(f=>f.config.id===e(l));let i;s===-1?i=n===1?0:e(o).length-1:i=(s+n+e(o).length)%e(o).length,Te(e(o)[i].config.id)}function Ke(n){n.ctrlKey&&(n.key==="["?(n.preventDefault(),ae(-1)):n.key==="]"&&(n.preventDefault(),ae(1)))}function at(n){confirm("Delete this character profile permanently?")&&(ve(n),y(c,e(c).filter(s=>s.id!==n)),localStorage.setItem("rf_pairings",JSON.stringify(e(c))))}function Ee(n){if(n.startsWith("`"))return{type:"unknown",raw:n.substring(1)};if(n.startsWith(":"))return{type:"emote",message:n.substring(1)};if(n.startsWith("/")){const s=n.indexOf(" ");if(s!==-1){let i=n.substring(1,s);const f=n.substring(s+1);let _=!1;return i.startsWith("%")&&i.length>1&&(_=!0,i=i.substring(1)),{type:"whisper",target:i,message:f,exact:_}}}return{type:"speech",message:n}}async function rt(n){if(!e(t)||!e(t).ws||e(t).ws.readyState!==WebSocket.OPEN)return;let s;if(typeof n=="object"&&"type"in n&&n.type==="nearby_req")s=await Je({type:"nearby_req"},e(t).sharedKey,e(t).config.keyHint);else{const i=typeof n=="string"?Ee(n):n;console.log(Tt(i)),s=await Je({type:"cmd",cmd:Tt(i)},e(t).sharedKey,e(t).config.keyHint)}e(t).ws.send(s),localStorage.setItem("rf_last_workspace_time",Date.now().toString())}pt(()=>(e(l),Ct),()=>{e(l)===null&&Ct&&v()}),pt(()=>(e(o),e(l)),()=>{y(t,e(o).find(n=>n.config.id===e(l))||null)}),pt(()=>(e(d),e(o),e(l)),()=>{e(d)&&(e(o)||e(l))&&m()}),Gt();var Ae={parseChatInput:Ee};bt();var B=Ia();en("ol5tb",n=>{var s=Ta();h(n,s)});var Me=g(B),Ne=g(Me),Ue=g(Ne);et(Ue,1,()=>e(o),n=>n.config.id,(n,s)=>{{let i=Zt(()=>(e(l),e(s),E(()=>e(l)===e(s).config.id)));wa(n,{get name(){return e(s),E(()=>e(s).config.name)},get status(){return e(s),E(()=>e(s).status)},get active(){return e(i)},get unread(){return e(s),E(()=>e(s).unread)},onSelect:()=>Te(e(s).config.id),onClose:()=>ve(e(s).config.id)})}});var Be=w(Ue,2);{var ot=n=>{var s=Ca();De("click",s,nn(()=>y(l,null))),h(n,s)};T(Be,n=>{e(o),e(l),E(()=>e(o).length>0&&e(l)!==null)&&n(ot)})}p(Ne),p(Me);var Qe=w(Me,2),Re=g(Qe);{var Le=n=>{_a(n,{get id(){return e(t),E(()=>e(t).config.id)},get messages(){return e(t),E(()=>e(t).messages)},get status(){return e(t),E(()=>e(t).status)},get myCharacterName(){return e(t),E(()=>e(t).config.name)},onSendMessage:rt,onUnreadChange:s=>{e(t)&&($t(t,e(t).unread=s),y(o,e(o)))}})},ee=n=>{Da(n,{get sessions(){return e(c)},onSelect:s=>b(s),onRemove:at})};T(Re,n=>{e(t)?n(Le):n(ee,!1)})}return p(Qe),p(B),h(a,B),on(r,"parseChatInput",Ee),nt(Ae)}export{Ja as component,qa as universal};
