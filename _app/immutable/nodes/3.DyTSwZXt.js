import{f as C,e as $,a as S,s as X}from"../chunks/C1tqszlw.js";import{i as ke}from"../chunks/C9yta_6L.js";import{o as qe}from"../chunks/CknSxeTE.js";import{p as Ue,$ as Xe,a0 as je,n as Fe,o as p,an as Ne,h as e,W as N,Z as A,v,s as b,m as Le,u as k,t as j,e as Qe,a2 as Ye,a1 as Ze}from"../chunks/DLIAHk6_.js";import{i as T,s as Ge,a as Ve}from"../chunks/Bystva0I.js";import{h as Je}from"../chunks/67UxSOWT.js";import{p as ye,F as ze,g as Ke,h as z,l as et,r as tt,e as nt,s as we,d as oe,f as se,k as at,i as ot,b as st,m as rt,v as it,c as re,a as lt}from"../chunks/C0FF_y16.js";import"../chunks/8UtF8RsF.js";function ct(f,_){let r=_;r.endsWith("/")||(r+="/");const h=f.startsWith("/")?f.substring(1):f;return new URL(h,r).toString()}function dt(f,_){const r=new URL(f),h=new URL(_),M=r.pathname.startsWith("/")?r.pathname.substring(1):r.pathname;let x=h.pathname;return x.endsWith("/")||(x+="/"),h.pathname=x+M,h.search=r.search,h.hash=r.hash,h.toString()}function ut(f){return!f.match(/^https?:\/\//)&&!f.startsWith("data:")&&!f.startsWith("blob:")}function ft(f){return f.startsWith("http://local-server.furcadia.com:8080/")||f.startsWith("https://terra.furcadia.com/")}function vt(f,_){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(h,M,...x){let a=M.toString();return ut(a)?(a=ct(a,f),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${a}`)):ft(a)&&(a=dt(a,_),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${a}`)),super.open(h,a,...x)}}}class Pe{buffer="";append(_){this.buffer+=_;const r=[];let h;for(;(h=this.buffer.indexOf(`
`))!==-1;){const M=this.buffer.substring(0,h);r.push(M),this.buffer=this.buffer.substring(h+1)}return r}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function ht(){const f={encode:a=>{const t=a.length,c=new Uint8Array(t);for(let l=0;l<t;l++)c[l]=a.charCodeAt(l)&255;return c}},_={decode:a=>{if(typeof a=="string")return a;let t;a instanceof Uint8Array?t=a:a instanceof ArrayBuffer?t=new Uint8Array(a):t=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);let c="";const l=t.length,d=32768;for(let u=0;u<l;u+=d){const y=t.subarray(u,Math.min(u+d,l));c+=String.fromCharCode.apply(null,y)}return c}};let r=null,h;window.waitForFurc=new Promise(a=>{h=a});function M(a,t,c,l){if(!t.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const d=f.encode(t),u=new MessageEvent("message",{data:d,origin:"wss://lightbringer.furcadia.com"});u.tag=l,u.sourceId=c,a.dispatchEvent(u)}function x(a,t,c,l){if(a.readyState===WebSocket.OPEN){if(!t.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const d=f.encode(t);a.sendTagged?a.sendTagged(d,c,l):a.send(d)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new Pe;_outgoingBuffer=new Pe;_motdComplete=!1;constructor(t,c){if(super(t,c),t.toString().includes("furcadia")||t.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),r=this;const l=window.Furnarchy;l&&(l.send=(d,u,y)=>x(this,d,u,y),l.inject=(d,u,y)=>M(this,d,u,y),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>h(this))}}send(t){this.sendTagged(t,void 0,void 0)}sendTagged(t,c,l){if(r!==this){super.send(t);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let d=typeof t=="string"?t:_.decode(t);const u=this._outgoingBuffer.append(d);if(u.length===0)return;const y=[];for(let m of u){const w=window.Furnarchy;if(w){const q=await w.processOutgoing(m,c,l);if(q==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}m=q}y.push(m)}if(y.length===0)return;const W=y.join(`
`)+`
`,B=f.encode(W);super.send(B)}).catch(d=>{console.error("Error in outgoing message queue:",d)})}_hookMessageEvent(t,c){const l=t.tag,d=t.sourceId;this._incomingQueue=this._incomingQueue.then(async()=>{let u=typeof t.data=="string"?t.data:_.decode(t.data);const y=this._incomingBuffer.append(u);if(y.length===0)return;const W=[];for(let q of y){if(!this._motdComplete){q==="Dragonroar"&&(this._motdComplete=!0),W.push(q);continue}const I=window.Furnarchy;if(I&&q==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),I.notifyLoggedIn()),I){const D=await I.processIncoming(q,d,l);if(D==null)continue;q=D}W.push(q)}if(W.length===0)return;const B=W.join(`
`)+`
`;let m=B;this.binaryType==="arraybuffer"?m=f.encode(B).buffer:this.binaryType==="blob"&&(m=new Blob([f.encode(B)]));const w=new MessageEvent("message",{data:m,origin:t.origin,source:t.source});c(w)}).catch(u=>{console.error("Error in incoming message queue:",u)})}set onmessage(t){r===this&&t?super.onmessage=c=>{this._hookMessageEvent(c,l=>{t.call(this,l)})}:super.onmessage=t}get onmessage(){return super.onmessage}addEventListener(t,c,l){if(t==="message"&&r===this&&typeof c=="function"){const d=u=>{this._hookMessageEvent(u,y=>{c.call(this,y)})};super.addEventListener(t,d,l);return}super.addEventListener(t,c,l)}}}async function gt(f){const _=await fetch(f);if(!_.ok)throw new Error(`Failed to fetch client script: ${_.statusText}`);let r=await _.text();r=r.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),r=r.replaceAll("WebSocket","FurcWebSocket");const h=document.createElement("script");h.textContent=r,h.async=!0,document.body.appendChild(h)}var mt=C('<div class="config-btn svelte-a1qo0m" title="Configure Plugin">‚öôÔ∏è</div>'),pt=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">ID:</span> </div>'),bt=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),_t=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),yt=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Description:</span> </div>'),wt=C('<div class="plugin-details svelte-a1qo0m"><!> <!> <!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <div class="button-group svelte-a1qo0m"><button class="action-btn reload-btn svelte-a1qo0m">Reload Plugin</button> <button class="action-btn remove-btn svelte-a1qo0m">Remove Plugin</button></div></div>'),Pt=C('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div> <!> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),kt=C('<li class="empty svelte-a1qo0m">No plugins installed</li>'),qt=C('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),Ut=C('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function Ft(f,_){Ue(_,!1);const r=()=>Ve(ye,"$pluginStore",h),[h,M]=Ge(),x=N();let a=N(!1),t=N(""),c=N(null),l=N(!1),d=N({});qe(()=>{window.Furnarchy||(window.Furnarchy=new ze),ye.set(Ke()),window.Furnarchy.plugins&&window.Furnarchy.plugins.forEach(i=>{i.metadata.sourceUrl&&Ne(d,e(d)[i.metadata.sourceUrl]=i._handlers.configure.length>0)}),window.Furnarchy.onRegister(i=>{const o=i.metadata||i,g=o.sourceUrl||i.sourceUrl;if(g){A(d,{...e(d),[g]:i._handlers.configure.length>0});const R=r().findIndex(O=>O.url===g);if(R!==-1){const O=window.Furnarchy.loadingPluginUrl===g,U=r()[R];let L=!1;const E={...U};if(O){const G=o.toggle?!1:U.enabled!==!1;i._setEnabled(G),o.toggle&&U.enabled!==!1&&(E.enabled=!1,L=!0)}else i.enabled!==(U.enabled!==!1)&&(E.enabled=i.enabled,L=!0);if(U.name!==o.name&&(E.name=o.name,L=!0),U.id!==o.id&&(E.id=o.id,L=!0),U.description!==o.description&&(E.description=o.description,L=!0),U.version!==o.version&&(E.version=o.version,L=!0),U.author!==o.author&&(E.author=o.author,L=!0),L){const G=[...r()];G[R]=E,z(G)}}}});const n=window.Furnarchy?.version||"0.0.0";et(n).then(()=>{q()})});function u(){A(a,!e(a))}async function y(){if(e(t)&&!r().some(n=>n.url===e(t))){A(l,!0);try{const n=await it(e(t)),i=[...r(),{id:n.id,url:e(t),name:n.name,description:n.description,version:n.version,author:n.author,enabled:n.toggle!==void 0?!n.toggle:!0}];z(i),I(e(t)),A(t,"")}catch(n){alert(`Failed to verify plugin: ${n.message||n}`)}finally{A(l,!1)}}}function W(n){const i=r().find(g=>g.url===n);i&&i.id&&rt(i.id);const o=r().filter(g=>g.url!==n);z(o),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function B(n){const i=r().map(o=>{if(o.url===n){const g=o.enabled===void 0?!1:!o.enabled,R=window.Furnarchy;if(R&&R.plugins){const O=R.plugins.find(U=>U.metadata.sourceUrl===n);O&&O._setEnabled(g)}return{...o,enabled:g}}return o});z(i)}function m(n){A(a,!1);const i=window.Furnarchy;if(i&&i.plugins){const o=i.plugins.find(g=>g.metadata.sourceUrl===n);o&&o._notifyConfigure()}}async function w(n){const i=document.querySelector(`script[data-plugin-url="${n}"]`);i&&i.remove();const o=window.Furnarchy;if(o&&o.plugins){const g=o.plugins.findIndex(R=>R.metadata.sourceUrl===n);g!==-1&&(o.plugins[g]._setEnabled(!1),o.plugins.splice(g,1))}await I(n)}function q(){r().forEach(n=>I(n.url))}async function I(n){if(!document.querySelector(`script[data-plugin-url="${n}"]`))try{const i=await fetch(n);if(!i.ok)throw new Error(`HTTP ${i.status}`);const o=await i.text();window.Furnarchy.loadingPluginUrl=n;const g=document.createElement("script");g.textContent=o,g.dataset.pluginUrl=n,document.body.appendChild(g),console.log(`[PluginManager] Loaded via fetch: ${n}`)}catch(i){console.warn(`[PluginManager] Fetch failed for ${n}, falling back to script tag.`,i);const o=document.createElement("script");o.src=n,o.async=!0,o.dataset.pluginUrl=n,o.onload=()=>console.log(`[PluginManager] Loaded via tag: ${n}`),o.onerror=()=>console.error(`[PluginManager] Failed to load: ${n}`),document.body.appendChild(o)}finally{window.Furnarchy.loadingPluginUrl=null}}Xe(()=>r(),()=>{A(x,r())}),je(),ke();var D=Ut(),ie=p(D),Se=v(ie,2);{var Ce=n=>{var i=qt(),o=Le(i),g=v(o,2),R=p(g),O=v(p(R),2);b(R);var U=v(R,2),L=p(U);tt(L);var E=v(L,2),G=p(E,!0);b(E),b(U);var K=v(U,2),le=p(K);nt(le,1,r,ot,(H,s)=>{var V=Pt();let de;var ee=p(V),ue=p(ee),J=p(ue);let fe;var ve=v(J,2);{var Ae=Q=>{var Y=mt();$("click",Y,se(()=>m(e(s).url))),S(Q,Y)};T(ve,Q=>{e(d),e(s),k(()=>e(d)[e(s).url])&&Q(Ae)})}var te=v(ve,2),$e=p(te,!0);b(te),b(ue),b(ee);var Me=v(ee,2);{var We=Q=>{var Y=wt(),he=p(Y);{var Ie=P=>{var F=pt(),Z=v(p(F));b(F),j(()=>X(Z,` ${e(s),k(()=>e(s).id)??""}`)),S(P,F)};T(he,P=>{e(s),k(()=>e(s).id)&&P(Ie)})}var ge=v(he,2);{var Te=P=>{var F=bt(),Z=v(p(F));b(F),j(()=>X(Z,` ${e(s),k(()=>e(s).version)??""}`)),S(P,F)};T(ge,P=>{e(s),k(()=>e(s).version)&&P(Te)})}var me=v(ge,2);{var Be=P=>{var F=_t(),Z=v(p(F));b(F),j(()=>X(Z,` ${e(s),k(()=>e(s).author)??""}`)),S(P,F)};T(me,P=>{e(s),k(()=>e(s).author)&&P(Be)})}var pe=v(me,2);{var De=P=>{var F=yt(),Z=v(p(F));b(F),j(()=>X(Z,` ${e(s),k(()=>e(s).description)??""}`)),S(P,F)};T(pe,P=>{e(s),k(()=>e(s).description)&&P(De)})}var ne=v(pe,2),ae=v(p(ne),2),He=p(ae,!0);b(ae),b(ne);var be=v(ne,2),_e=p(be),Oe=v(_e,2);b(be),b(Y),j(()=>{oe(ae,"href",(e(s),k(()=>e(s).url))),X(He,(e(s),k(()=>e(s).url)))}),$("click",_e,()=>w(e(s).url)),$("click",Oe,()=>W(e(s).url)),$("click",Y,se(function(P){at.call(this,_,P)})),S(Q,Y)};T(Me,Q=>{e(c),e(s),k(()=>e(c)===e(s).url)&&Q(We)})}b(V),j(()=>{de=we(V,1,"plugin-item svelte-a1qo0m",null,de,{expanded:e(c)===e(s).url,disabled:e(s).enabled===!1}),fe=we(J,1,"toggle-switch svelte-a1qo0m",null,fe,{checked:e(s).enabled!==!1}),oe(J,"title",(e(s),k(()=>e(s).enabled!==!1?"Disable Plugin":"Enable Plugin"))),oe(te,"title",(e(s),k(()=>e(s).url))),X($e,(e(s),k(()=>e(s).name||e(s).url)))}),$("click",J,se(()=>B(e(s).url))),$("click",V,()=>A(c,e(c)===e(s).url?null:e(s).url)),S(H,V)});var xe=v(le,2);{var Re=H=>{var s=kt();S(H,s)};T(xe,H=>{r(),k(()=>r().length===0)&&H(Re)})}b(K);var ce=v(K,2),Ee=v(p(ce),4);Ee.textContent=`Furnarchy Zero v${k(()=>window.Furnarchy?.version||"...")??""}`,b(ce),b(g),j(()=>{L.disabled=e(l),E.disabled=e(l),X(G,e(l)?"...":"Add")}),$("click",o,u),$("click",O,u),st(L,()=>e(t),H=>A(t,H)),$("keydown",L,H=>H.key==="Enter"&&!e(l)&&y()),$("click",E,y),S(n,i)};T(Se,n=>{e(a)&&n(Ce)})}b(D),$("click",ie,u),S(f,D),Fe(),M()}var Lt=C('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),St=C('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),Ct=C('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),xt=C('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function Ht(f,_){Ue(_,!1);const r=re.PUBLIC_FURCADIA_CLIENT_JS_URL,h=re.PUBLIC_AUTH_PROXY_URL,M=re.PUBLIC_PLAY_FURCADIA_URL;let x=N(!1),a=N(""),t=!1;qe(()=>{const w=lt()||h;console.log(`[Furnarchy] Using backend URL: ${w}`),vt(M,w),ht(),c()});async function c(){if(!t){A(x,!0),A(a,"");try{await gt(r),t=!0}catch(m){console.error(m),A(a,m.message||"An unknown error occurred")}finally{A(x,!1)}}}ke();var l=xt();Je("hy9bcf",m=>{var w=Lt();Ye(6),Qe(()=>{Ze.title="Furnarchy Zero"}),S(m,w)});var d=Le(l);Ft(d,{});var u=v(d,2);{var y=m=>{var w=St();S(m,w)};T(u,m=>{e(x)&&m(y)})}var W=v(u,12);{var B=m=>{var w=Ct(),q=p(w),I=p(q);b(q);var D=v(q,2);b(w),j(()=>X(I,`Error: ${e(a)??""}`)),$("click",D,()=>window.location.reload()),S(m,w)};T(W,m=>{e(a)&&m(B)})}S(f,l),Fe()}export{Ht as component};
