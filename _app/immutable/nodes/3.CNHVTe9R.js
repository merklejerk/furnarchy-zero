import{f as x,e as E,a as S,s as X}from"../chunks/IX6aYug8.js";import{i as Ue}from"../chunks/DeWH6QAX.js";import{o as Le}from"../chunks/Cvwj0Kbc.js";import{p as Se,W as Ne,X as Qe,n as xe,o as p,an as Ye,h as e,Q as j,T as A,v as g,s as b,m as Ce,u as k,t as O,e as Ge,Y as Ve,$ as Ze}from"../chunks/B2BHS6mp.js";import{i as W,s as Je,a as ze}from"../chunks/CBIv6OHw.js";import{f as K,h as Ke}from"../chunks/C5Ogm6AN.js";import{p as Pe,g as et,h as z,l as tt,r as nt,e as at,s as ke,d as re,f as ie,k as st,i as ot,b as rt,m as it,v as lt,c as le,a as ct}from"../chunks/Bla51ghN.js";import"../chunks/8UtF8RsF.js";function dt(f,y){let r=y;r.endsWith("/")||(r+="/");const m=f.startsWith("/")?f.substring(1):f;return new URL(m,r).toString()}function ut(f,y){const r=new URL(f),m=new URL(y),$=r.pathname.startsWith("/")?r.pathname.substring(1):r.pathname;let C=m.pathname;return C.endsWith("/")||(C+="/"),m.pathname=C+$,m.search=r.search,m.hash=r.hash,m.toString()}function ft(f){return!f.match(/^https?:\/\//)&&!f.startsWith("data:")&&!f.startsWith("blob:")}function vt(f){return f.startsWith("http://local-server.furcadia.com:8080/")||f.startsWith("https://terra.furcadia.com/")}function gt(f,y){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(m,$,...C){let s=$.toString();return ft(s)?(s=dt(s,f),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${s}`)):vt(s)&&(s=ut(s,y),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${s}`)),super.open(m,s,...C)}}}class qe{buffer="";append(y){this.buffer+=y;const r=[];let m;for(;(m=this.buffer.indexOf(`
`))!==-1;){const $=this.buffer.substring(0,m);r.push($),this.buffer=this.buffer.substring(m+1)}return r}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function mt(){const f={encode:s=>{const t=s.length,d=new Uint8Array(t);for(let l=0;l<t;l++)d[l]=s.charCodeAt(l)&255;return d}},y={decode:s=>{if(typeof s=="string")return s;let t;s instanceof Uint8Array?t=s:s instanceof ArrayBuffer?t=new Uint8Array(s):t=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);let d="";const l=t.length,u=32768;for(let n=0;n<l;n+=u){const _=t.subarray(n,Math.min(n+u,l));d+=String.fromCharCode.apply(null,_)}return d}};let r=null,m;window.waitForFurc=new Promise(s=>{m=s});function $(s,t,d,l){if(!t.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const u=f.encode(t),n=new MessageEvent("message",{data:u,origin:"wss://lightbringer.furcadia.com"});n.tag=l,n.sourceId=d,s.dispatchEvent(n)}function C(s,t,d,l){if(s.readyState===WebSocket.OPEN){if(!t.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const u=f.encode(t);s.sendTagged?s.sendTagged(u,d,l):s.send(u)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new qe;_outgoingBuffer=new qe;_motdComplete=!1;constructor(t,d){if(super(t,d),t.toString().includes("furcadia")||t.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),r=this;const l=K;l&&(l.send=(u,n,_)=>C(this,u,n,_),l.inject=(u,n,_)=>$(this,u,n,_),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>m(this))}}send(t){this.sendTagged(t,void 0,void 0)}sendTagged(t,d,l){if(r!==this){super.send(t);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let u=typeof t=="string"?t:y.decode(t);const n=this._outgoingBuffer.append(u);if(n.length===0)return;const _=[];for(let h of n){const w=K;if(w){const q=await w.processOutgoing(h,d,l);if(q==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}h=q}_.push(h)}if(_.length===0)return;const M=_.join(`
`)+`
`,T=f.encode(M);super.send(T)}).catch(u=>{console.error("Error in outgoing message queue:",u)})}_hookMessageEvent(t,d){const l=t.tag,u=t.sourceId;this._incomingQueue=this._incomingQueue.then(async()=>{let n=typeof t.data=="string"?t.data:y.decode(t.data);const _=this._incomingBuffer.append(n);if(_.length===0)return;const M=[];for(let q of _){if(!this._motdComplete){q==="Dragonroar"&&(this._motdComplete=!0),M.push(q);continue}const H=K;if(H&&q==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),H.notifyLoggedIn()),H){const B=await H.processIncoming(q,u,l);if(B==null)continue;q=B}M.push(q)}if(M.length===0)return;const T=M.join(`
`)+`
`;let h=T;this.binaryType==="arraybuffer"?h=f.encode(T).buffer:this.binaryType==="blob"&&(h=new Blob([f.encode(T)]));const w=new MessageEvent("message",{data:h,origin:t.origin,source:t.source});d(w)}).catch(n=>{console.error("Error in incoming message queue:",n)})}set onmessage(t){r===this&&t?super.onmessage=d=>{this._hookMessageEvent(d,l=>{t.call(this,l)})}:super.onmessage=t}get onmessage(){return super.onmessage}addEventListener(t,d,l){if(t==="message"&&r===this&&typeof d=="function"){const u=n=>{this._hookMessageEvent(n,_=>{d.call(this,_)})};super.addEventListener(t,u,l);return}super.addEventListener(t,d,l)}}}async function ht(f){const y=await fetch(f);if(!y.ok)throw new Error(`Failed to fetch client script: ${y.statusText}`);let r=await y.text();r=r.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),r=r.replaceAll("WebSocket","FurcWebSocket");const m=document.createElement("script");m.textContent=r,m.async=!0,document.body.appendChild(m)}var pt=x('<div class="config-btn svelte-a1qo0m" title="Configure Plugin">‚öôÔ∏è</div>'),bt=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">ID:</span> </div>'),_t=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),yt=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),wt=x('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Description:</span> </div>'),Pt=x('<div class="plugin-details svelte-a1qo0m"><!> <!> <!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <div class="button-group svelte-a1qo0m"><button class="action-btn reload-btn svelte-a1qo0m">Reload Plugin</button> <button class="action-btn remove-btn svelte-a1qo0m">Remove Plugin</button></div></div>'),kt=x('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div> <!> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),qt=x('<li class="empty svelte-a1qo0m">No plugins installed</li>'),Ut=x('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),Lt=x('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function St(f,y){Se(y,!1);const r=()=>ze(Pe,"$pluginStore",m),[m,$]=Je(),C=j();let s=j(!1),t=j(""),d=j(null),l=j(!1),u=j({}),n=K;Le(()=>{window.Furnarchy=n.getExposedAPI(),Pe.set(et()),n.plugins&&n.plugins.forEach(c=>{c.metadata.sourceUrl&&Ye(u,e(u)[c.metadata.sourceUrl]=c._handlers.configure.length>0)}),n.onRegister(c=>{const i=c.metadata||c,v=i.sourceUrl||c.sourceUrl;if(v){A(u,{...e(u),[v]:c._handlers.configure.length>0});const I=r().findIndex(N=>N.url===v);if(I!==-1){const N=n.loadingPluginUrl===v,R=r()[I];let L=!1;const F={...R};if(N){const V=i.toggle?!1:R.enabled!==!1;c._setEnabled(V),i.toggle&&R.enabled!==!1&&(F.enabled=!1,L=!0)}else c.enabled!==(R.enabled!==!1)&&(F.enabled=c.enabled,L=!0);if(R.name!==i.name&&(F.name=i.name,L=!0),R.id!==i.id&&(F.id=i.id,L=!0),R.description!==i.description&&(F.description=i.description,L=!0),R.version!==i.version&&(F.version=i.version,L=!0),R.author!==i.author&&(F.author=i.author,L=!0),L){const V=[...r()];V[I]=F,z(V)}}}});const a=n.version||"0.0.0";tt(a).then(()=>{H()})});function _(){A(s,!e(s))}async function M(){if(e(t)&&!r().some(a=>a.url===e(t))){A(l,!0);try{const a=await lt(e(t)),c=[...r(),{id:a.id,url:e(t),name:a.name,description:a.description,version:a.version,author:a.author,enabled:a.toggle!==void 0?!a.toggle:!0}];z(c),B(e(t)),A(t,"")}catch(a){alert(`Failed to verify plugin: ${a.message||a}`)}finally{A(l,!1)}}}function T(a){const c=r().find(v=>v.url===a);c&&c.id&&it(c.id);const i=r().filter(v=>v.url!==a);z(i),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function h(a){const c=r().map(i=>{if(i.url===a){const v=i.enabled===void 0?!1:!i.enabled;if(n&&n.plugins){const I=n.plugins.find(N=>N.metadata.sourceUrl===a);I&&I._setEnabled(v)}return{...i,enabled:v}}return i});z(c)}function w(a){if(A(s,!1),n&&n.plugins){const c=n.plugins.find(i=>i.metadata.sourceUrl===a);c&&c._notifyConfigure()}}async function q(a){const c=document.querySelector(`script[data-plugin-url="${a}"]`);if(c&&c.remove(),n&&n.plugins){const i=n.plugins.findIndex(v=>v.metadata.sourceUrl===a);i!==-1&&(n.plugins[i]._setEnabled(!1),n.plugins.splice(i,1))}await B(a)}async function H(){await Promise.all(r().map(a=>B(a.url))),n.start()}async function B(a){if(!document.querySelector(`script[data-plugin-url="${a}"]`))try{const c=await fetch(a);if(!c.ok)throw new Error(`HTTP ${c.status}`);const i=await c.text();n.loadingPluginUrl=a;const v=document.createElement("script");v.textContent=i,v.dataset.pluginUrl=a,document.body.appendChild(v),console.log(`[PluginManager] Loaded via fetch: ${a}`)}catch(c){return console.warn(`[PluginManager] Fetch failed for ${a}, falling back to script tag.`,c),new Promise(i=>{const v=document.createElement("script");v.src=a,v.async=!0,v.dataset.pluginUrl=a,v.onload=()=>{console.log(`[PluginManager] Loaded via tag: ${a}`),i()},v.onerror=()=>{console.error(`[PluginManager] Failed to load: ${a}`),i()},document.body.appendChild(v)})}finally{n.loadingPluginUrl=null}}Ne(()=>r(),()=>{A(C,r())}),Qe(),Ue();var ee=Lt(),ce=p(ee),Re=g(ce,2);{var Fe=a=>{var c=Ut(),i=Ce(c),v=g(i,2),I=p(v),N=g(p(I),2);b(I);var R=g(I,2),L=p(R);nt(L);var F=g(L,2),V=p(F,!0);b(F),b(R);var te=g(R,2),de=p(te);at(de,1,r,ot,(D,o)=>{var Z=kt();let fe;var ne=p(Z),ve=p(ne),J=p(ve);let ge;var me=g(J,2);{var Me=Q=>{var Y=pt();E("click",Y,ie(()=>w(e(o).url))),S(Q,Y)};W(me,Q=>{e(u),e(o),k(()=>e(u)[e(o).url])&&Q(Me)})}var ae=g(me,2),Ie=p(ae,!0);b(ae),b(ve),b(ne);var We=g(ne,2);{var Te=Q=>{var Y=Pt(),he=p(Y);{var Be=P=>{var U=bt(),G=g(p(U));b(U),O(()=>X(G,` ${e(o),k(()=>e(o).id)??""}`)),S(P,U)};W(he,P=>{e(o),k(()=>e(o).id)&&P(Be)})}var pe=g(he,2);{var De=P=>{var U=_t(),G=g(p(U));b(U),O(()=>X(G,` ${e(o),k(()=>e(o).version)??""}`)),S(P,U)};W(pe,P=>{e(o),k(()=>e(o).version)&&P(De)})}var be=g(pe,2);{var He=P=>{var U=yt(),G=g(p(U));b(U),O(()=>X(G,` ${e(o),k(()=>e(o).author)??""}`)),S(P,U)};W(be,P=>{e(o),k(()=>e(o).author)&&P(He)})}var _e=g(be,2);{var Xe=P=>{var U=wt(),G=g(p(U));b(U),O(()=>X(G,` ${e(o),k(()=>e(o).description)??""}`)),S(P,U)};W(_e,P=>{e(o),k(()=>e(o).description)&&P(Xe)})}var se=g(_e,2),oe=g(p(se),2),Oe=p(oe,!0);b(oe),b(se);var ye=g(se,2),we=p(ye),je=g(we,2);b(ye),b(Y),O(()=>{re(oe,"href",(e(o),k(()=>e(o).url))),X(Oe,(e(o),k(()=>e(o).url)))}),E("click",we,()=>q(e(o).url)),E("click",je,()=>T(e(o).url)),E("click",Y,ie(function(P){st.call(this,y,P)})),S(Q,Y)};W(We,Q=>{e(d),e(o),k(()=>e(d)===e(o).url)&&Q(Te)})}b(Z),O(()=>{fe=ke(Z,1,"plugin-item svelte-a1qo0m",null,fe,{expanded:e(d)===e(o).url,disabled:e(o).enabled===!1}),ge=ke(J,1,"toggle-switch svelte-a1qo0m",null,ge,{checked:e(o).enabled!==!1}),re(J,"title",(e(o),k(()=>e(o).enabled!==!1?"Disable Plugin":"Enable Plugin"))),re(ae,"title",(e(o),k(()=>e(o).url))),X(Ie,(e(o),k(()=>e(o).name||e(o).url)))}),E("click",J,ie(()=>h(e(o).url))),E("click",Z,()=>A(d,e(d)===e(o).url?null:e(o).url)),S(D,Z)});var Ae=g(de,2);{var Ee=D=>{var o=qt();S(D,o)};W(Ae,D=>{r(),k(()=>r().length===0)&&D(Ee)})}b(te);var ue=g(te,2),$e=g(p(ue),4);$e.textContent=`Furnarchy Zero v${k(()=>window.Furnarchy?.version||"...")??""}`,b(ue),b(v),O(()=>{L.disabled=e(l),F.disabled=e(l),X(V,e(l)?"...":"Add")}),E("click",i,_),E("click",N,_),rt(L,()=>e(t),D=>A(t,D)),E("keydown",L,D=>D.key==="Enter"&&!e(l)&&M()),E("click",F,M),S(a,c)};W(Re,a=>{e(s)&&a(Fe)})}b(ee),E("click",ce,_),S(f,ee),xe(),$()}var xt=x('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),Ct=x('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),Rt=x('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),Ft=x('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function Xt(f,y){Se(y,!1);const r=le.PUBLIC_FURCADIA_CLIENT_JS_URL,m=le.PUBLIC_AUTH_PROXY_URL,$=le.PUBLIC_PLAY_FURCADIA_URL;let C=j(!1),s=j(""),t=!1;Le(()=>{const w=ct()||m;console.log(`[Furnarchy] Using backend URL: ${w}`),gt($,w),mt(),d()});async function d(){if(!t){A(C,!0),A(s,"");try{await ht(r),t=!0}catch(h){console.error(h),A(s,h.message||"An unknown error occurred")}finally{A(C,!1)}}}Ue();var l=Ft();Ke("hy9bcf",h=>{var w=xt();Ve(6),Ge(()=>{Ze.title="Furnarchy Zero"}),S(h,w)});var u=Ce(l);St(u,{});var n=g(u,2);{var _=h=>{var w=Ct();S(h,w)};W(n,h=>{e(C)&&h(_)})}var M=g(n,12);{var T=h=>{var w=Rt(),q=p(w),H=p(q);b(q);var B=g(q,2);b(w),O(()=>X(H,`Error: ${e(s)??""}`)),E("click",B,()=>window.location.reload()),S(h,w)};W(M,h=>{e(s)&&h(T)})}S(f,l),xe()}export{Xt as component};
