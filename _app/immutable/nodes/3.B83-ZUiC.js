import{f as R,a as C}from"../chunks/BTCE0DZM.js";import{i as Pe}from"../chunks/v9LOXSqa.js";import{o as ke}from"../chunks/Db6ANrXm.js";import{L as qe,W as He,X as Oe,O as Ue,P as p,y as W,w as N,R as u,x as e,Q as b,M as Fe,D as P,N as O,Y as Xe,V as je,$ as Ne}from"../chunks/Cg5NIOCX.js";import{e as A,s as X}from"../chunks/oVO9CO60.js";import{i as D,s as Qe,a as Ye}from"../chunks/BJP9K3nK.js";import{h as Ve}from"../chunks/B_JrXAzN.js";import{p as _e,F as Ge,g as Ze,h as J,l as Je,r as ze,e as Ke,s as ye,d as se,f as oe,k as et,i as tt,b as nt,m as at,v as st,c as re,a as ot}from"../chunks/DCQcqZOA.js";function rt(d,y){let s=y;s.endsWith("/")||(s+="/");const v=d.startsWith("/")?d.substring(1):d;return new URL(v,s).toString()}function it(d,y){const s=new URL(d),v=new URL(y),$=s.pathname.startsWith("/")?s.pathname.substring(1):s.pathname;let L=v.pathname;return L.endsWith("/")||(L+="/"),v.pathname=L+$,v.search=s.search,v.hash=s.hash,v.toString()}function lt(d){return!d.match(/^https?:\/\//)&&!d.startsWith("data:")&&!d.startsWith("blob:")}function ct(d){return d.startsWith("http://local-server.furcadia.com:8080/")||d.startsWith("https://terra.furcadia.com/")}function dt(d,y){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(v,$,...L){let o=$.toString();return lt(o)?(o=rt(o,d),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${o}`)):ct(o)&&(o=it(o,y),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${o}`)),super.open(v,o,...L)}}}class we{buffer="";append(y){this.buffer+=y;const s=[];let v;for(;(v=this.buffer.indexOf(`
`))!==-1;){const $=this.buffer.substring(0,v);s.push($),this.buffer=this.buffer.substring(v+1)}return s}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function ut(){const d={encode:o=>{const t=o.length,c=new Uint8Array(t);for(let i=0;i<t;i++)c[i]=o.charCodeAt(i)&255;return c}},y={decode:o=>{if(typeof o=="string")return o;let t;o instanceof Uint8Array?t=o:o instanceof ArrayBuffer?t=new Uint8Array(o):t=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);let c="";const i=t.length,f=32768;for(let g=0;g<i;g+=f){const U=t.subarray(g,Math.min(g+f,i));c+=String.fromCharCode.apply(null,U)}return c}};let s=null,v;window.waitForFurc=new Promise(o=>{v=o});function $(o,t,c){if(!t.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const i=d.encode(t),f=new MessageEvent("message",{data:i,origin:"wss://lightbringer.furcadia.com"});f.tag=c,o.dispatchEvent(f)}function L(o,t,c){if(o.readyState===WebSocket.OPEN){if(!t.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const i=d.encode(t);o.sendTagged?o.sendTagged(i,c):o.send(i)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new we;_outgoingBuffer=new we;_motdComplete=!1;constructor(t,c){if(super(t,c),t.toString().includes("furcadia")||t.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),s=this;const i=window.Furnarchy;i&&(i.send=(f,g)=>L(this,f,g),i.inject=(f,g)=>$(this,f,g),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>v(this))}}send(t){this.sendTagged(t,void 0)}sendTagged(t,c){if(s!==this){super.send(t);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let i=typeof t=="string"?t:y.decode(t);const f=this._outgoingBuffer.append(i);if(f.length===0)return;const g=[];for(let M of f){const _=window.Furnarchy;if(_){const h=await _.processOutgoing(M,c);if(h==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}M=h}g.push(M)}if(g.length===0)return;const U=g.join(`
`)+`
`,T=d.encode(U);super.send(T)}).catch(i=>{console.error("Error in outgoing message queue:",i)})}_hookMessageEvent(t,c){const i=t.tag;this._incomingQueue=this._incomingQueue.then(async()=>{let f=typeof t.data=="string"?t.data:y.decode(t.data);const g=this._incomingBuffer.append(f);if(g.length===0)return;const U=[];for(let h of g){if(!this._motdComplete){h==="Dragonroar"&&(this._motdComplete=!0),U.push(h);continue}const E=window.Furnarchy;if(E&&h==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),E.notifyLoggedIn()),E){const B=await E.processIncoming(h,i);if(B==null)continue;h=B}U.push(h)}if(U.length===0)return;const T=U.join(`
`)+`
`;let M=T;this.binaryType==="arraybuffer"?M=d.encode(T).buffer:this.binaryType==="blob"&&(M=new Blob([d.encode(T)]));const _=new MessageEvent("message",{data:M,origin:t.origin,source:t.source});c(_)}).catch(f=>{console.error("Error in incoming message queue:",f)})}set onmessage(t){s===this&&t?super.onmessage=c=>{this._hookMessageEvent(c,i=>{t.call(this,i)})}:super.onmessage=t}get onmessage(){return super.onmessage}addEventListener(t,c,i){if(t==="message"&&s===this&&typeof c=="function"){const f=g=>{this._hookMessageEvent(g,U=>{c.call(this,U)})};super.addEventListener(t,f,i);return}super.addEventListener(t,c,i)}}}async function ft(d){const y=await fetch(d);if(!y.ok)throw new Error(`Failed to fetch client script: ${y.statusText}`);let s=await y.text();s=s.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),s=s.replaceAll("WebSocket","FurcWebSocket");const v=document.createElement("script");v.textContent=s,v.async=!0,document.body.appendChild(v)}var vt=R('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">ID:</span> </div>'),gt=R('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),ht=R('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),mt=R('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Description:</span> </div>'),pt=R('<div class="plugin-details svelte-a1qo0m"><!> <!> <!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <div class="button-group svelte-a1qo0m"><button class="action-btn reload-btn svelte-a1qo0m">Reload Plugin</button> <button class="action-btn remove-btn svelte-a1qo0m">Remove Plugin</button></div></div>'),bt=R('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div>  <div class="config-btn svelte-a1qo0m" title="Configure Plugin">‚öôÔ∏è</div> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),_t=R('<li class="empty svelte-a1qo0m">No plugins installed</li>'),yt=R('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),wt=R('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function Pt(d,y){qe(y,!1);const s=()=>Ye(_e,"$pluginStore",v),[v,$]=Qe(),L=N();let o=N(!1),t=N(""),c=N(null),i=N(!1);ke(()=>{window.Furnarchy||(window.Furnarchy=new Ge),_e.set(Ze()),window.Furnarchy.onRegister(l=>{const a=l.metadata||l,m=a.sourceUrl||l.sourceUrl;if(m){const S=s().findIndex(H=>H.url===m);if(S!==-1){const H=window.Furnarchy.loadingPluginUrl===m,k=s()[S];let F=!1;const x={...k};if(H){const Q=a.toggle?!1:k.enabled!==!1;l._setEnabled(Q),a.toggle&&k.enabled!==!1&&(x.enabled=!1,F=!0)}else l.enabled!==(k.enabled!==!1)&&(x.enabled=l.enabled,F=!0);if(k.name!==a.name&&(x.name=a.name,F=!0),k.id!==a.id&&(x.id=a.id,F=!0),k.description!==a.description&&(x.description=a.description,F=!0),k.version!==a.version&&(x.version=a.version,F=!0),k.author!==a.author&&(x.author=a.author,F=!0),F){const Q=[...s()];Q[S]=x,J(Q)}}}});const n=window.Furnarchy?.version||"0.0.0";Je(n).then(()=>{h()})});function f(){W(o,!e(o))}async function g(){if(e(t)&&!s().some(n=>n.url===e(t))){W(i,!0);try{const n=await st(e(t)),l=[...s(),{id:n.id,url:e(t),name:n.name,description:n.description,version:n.version,author:n.author,enabled:n.toggle!==void 0?!n.toggle:!0}];J(l),E(e(t)),W(t,"")}catch(n){alert(`Failed to verify plugin: ${n.message||n}`)}finally{W(i,!1)}}}function U(n){const l=s().find(m=>m.url===n);l&&l.id&&at(l.id);const a=s().filter(m=>m.url!==n);J(a),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function T(n){const l=s().map(a=>{if(a.url===n){const m=a.enabled===void 0?!1:!a.enabled,S=window.Furnarchy;if(S&&S.plugins){const H=S.plugins.find(k=>k.metadata.sourceUrl===n);H&&H._setEnabled(m)}return{...a,enabled:m}}return a});J(l)}function M(n){const l=window.Furnarchy;if(l&&l.plugins){const a=l.plugins.find(m=>m.metadata.sourceUrl===n);a&&a._notifyConfigure()}}async function _(n){const l=document.querySelector(`script[data-plugin-url="${n}"]`);l&&l.remove();const a=window.Furnarchy;if(a&&a.plugins){const m=a.plugins.findIndex(S=>S.metadata.sourceUrl===n);m!==-1&&(a.plugins[m]._setEnabled(!1),a.plugins.splice(m,1))}await E(n)}function h(){s().forEach(n=>E(n.url))}async function E(n){if(!document.querySelector(`script[data-plugin-url="${n}"]`))try{const l=await fetch(n);if(!l.ok)throw new Error(`HTTP ${l.status}`);const a=await l.text();window.Furnarchy.loadingPluginUrl=n;const m=document.createElement("script");m.textContent=a,m.dataset.pluginUrl=n,document.body.appendChild(m),console.log(`[PluginManager] Loaded via fetch: ${n}`)}catch(l){console.warn(`[PluginManager] Fetch failed for ${n}, falling back to script tag.`,l);const a=document.createElement("script");a.src=n,a.async=!0,a.dataset.pluginUrl=n,a.onload=()=>console.log(`[PluginManager] Loaded via tag: ${n}`),a.onerror=()=>console.error(`[PluginManager] Failed to load: ${n}`),document.body.appendChild(a)}finally{window.Furnarchy.loadingPluginUrl=null}}He(()=>s(),()=>{W(L,s())}),Oe(),Pe();var B=wt(),V=p(B),Le=u(V,2);{var Se=n=>{var l=yt(),a=Fe(l),m=u(a,2),S=p(m),H=u(p(S),2);b(S);var k=u(S,2),F=p(k);ze(F);var x=u(F,2),Q=p(x,!0);b(x),b(k);var z=u(k,2),ie=p(z);Ke(ie,1,s,tt,(I,r)=>{var Y=bt();let ce;var K=p(Y),de=p(K),G=p(de);let ue;var fe=u(G,2),ee=u(fe,2),Ee=p(ee,!0);b(ee),b(de),b(K);var Ae=u(K,2);{var $e=te=>{var Z=pt(),ve=p(Z);{var Me=w=>{var q=vt(),j=u(p(q));b(q),O(()=>X(j,` ${e(r),P(()=>e(r).id)??""}`)),C(w,q)};D(ve,w=>{e(r),P(()=>e(r).id)&&w(Me)})}var ge=u(ve,2);{var We=w=>{var q=gt(),j=u(p(q));b(q),O(()=>X(j,` ${e(r),P(()=>e(r).version)??""}`)),C(w,q)};D(ge,w=>{e(r),P(()=>e(r).version)&&w(We)})}var he=u(ge,2);{var Te=w=>{var q=ht(),j=u(p(q));b(q),O(()=>X(j,` ${e(r),P(()=>e(r).author)??""}`)),C(w,q)};D(he,w=>{e(r),P(()=>e(r).author)&&w(Te)})}var me=u(he,2);{var Be=w=>{var q=mt(),j=u(p(q));b(q),O(()=>X(j,` ${e(r),P(()=>e(r).description)??""}`)),C(w,q)};D(me,w=>{e(r),P(()=>e(r).description)&&w(Be)})}var ne=u(me,2),ae=u(p(ne),2),Ie=p(ae,!0);b(ae),b(ne);var pe=u(ne,2),be=p(pe),De=u(be,2);b(pe),b(Z),O(()=>{se(ae,"href",(e(r),P(()=>e(r).url))),X(Ie,(e(r),P(()=>e(r).url)))}),A("click",be,()=>_(e(r).url)),A("click",De,()=>U(e(r).url)),A("click",Z,oe(function(w){et.call(this,y,w)})),C(te,Z)};D(Ae,te=>{e(c),e(r),P(()=>e(c)===e(r).url)&&te($e)})}b(Y),O(()=>{ce=ye(Y,1,"plugin-item svelte-a1qo0m",null,ce,{expanded:e(c)===e(r).url,disabled:e(r).enabled===!1}),ue=ye(G,1,"toggle-switch svelte-a1qo0m",null,ue,{checked:e(r).enabled!==!1}),se(G,"title",(e(r),P(()=>e(r).enabled!==!1?"Disable Plugin":"Enable Plugin"))),se(ee,"title",(e(r),P(()=>e(r).url))),X(Ee,(e(r),P(()=>e(r).name||e(r).url)))}),A("click",G,oe(()=>T(e(r).url))),A("click",fe,oe(()=>M(e(r).url))),A("click",Y,()=>W(c,e(c)===e(r).url?null:e(r).url)),C(I,Y)});var xe=u(ie,2);{var Ce=I=>{var r=_t();C(I,r)};D(xe,I=>{s(),P(()=>s().length===0)&&I(Ce)})}b(z);var le=u(z,2),Re=u(p(le),4);Re.textContent=`Furnarchy Zero v${P(()=>window.Furnarchy?.version||"...")??""}`,b(le),b(m),O(()=>{F.disabled=e(i),x.disabled=e(i),X(Q,e(i)?"...":"Add")}),A("click",a,f),A("click",H,f),nt(F,()=>e(t),I=>W(t,I)),A("keydown",F,I=>I.key==="Enter"&&!e(i)&&g()),A("click",x,g),C(n,l)};D(Le,n=>{e(o)&&n(Se)})}b(B),A("click",V,f),C(d,B),Ue(),$()}var kt=R('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),qt=R('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),Ut=R('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),Ft=R('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function Tt(d,y){qe(y,!1);const s=re.PUBLIC_FURCADIA_CLIENT_JS_URL,v=re.PUBLIC_AUTH_PROXY_URL,$=re.PUBLIC_PLAY_FURCADIA_URL;let L=N(!1),o=N(""),t=!1;ke(()=>{const h=ot()||v;console.log(`[Furnarchy] Using backend URL: ${h}`),dt($,h),ut(),c()});async function c(){if(!t){W(L,!0),W(o,"");try{await ft(s),t=!0}catch(_){console.error(_),W(o,_.message||"An unknown error occurred")}finally{W(L,!1)}}}Pe();var i=Ft();Ve("hy9bcf",_=>{var h=kt();je(6),Xe(()=>{Ne.title="Furnarchy Zero"}),C(_,h)});var f=Fe(i);Pt(f,{});var g=u(f,2);{var U=_=>{var h=qt();C(_,h)};D(g,_=>{e(L)&&_(U)})}var T=u(g,12);{var M=_=>{var h=Ut(),E=p(h),B=p(E);b(E);var V=u(E,2);b(h),O(()=>X(B,`Error: ${e(o)??""}`)),A("click",V,()=>window.location.reload()),C(_,h)};D(T,_=>{e(o)&&_(M)})}C(d,i),Ue()}export{Tt as component};
