import{f as R,a as x}from"../chunks/B36h28Ez.js";import{i as me}from"../chunks/Y9XORz2r.js";import{o as pe}from"../chunks/DxZxUW1L.js";import{L as be,W as Ee,X as Ae,O as ye,P as b,y as C,w as O,R as m,x as t,Q as y,M as _e,D as U,N as D,at as $e,V as Me,aL as We}from"../chunks/Do66v2T9.js";import{e as $,s as N}from"../chunks/DQ8Ufe3j.js";import{i as X,s as Te,a as Be}from"../chunks/Dz5cLF74.js";import{h as Ie}from"../chunks/D5y1lrV_.js";import{p as fe,F as He,g as Oe,h as Y,m as Xe,r as De,e as Ne,s as ve,d as ae,f as he,k as je,i as Qe,b as Ge,v as Ye,c as se,a as Ve}from"../chunks/CeDiczG7.js";function Ze(c,p){let n=p;n.endsWith("/")||(n+="/");const u=c.startsWith("/")?c.substring(1):c;return new URL(u,n).toString()}function Je(c,p){const n=new URL(c),u=new URL(p),F=n.pathname.startsWith("/")?n.pathname.substring(1):n.pathname;let _=u.pathname;return _.endsWith("/")||(_+="/"),u.pathname=_+F,u.search=n.search,u.hash=n.hash,u.toString()}function ze(c){return!c.match(/^https?:\/\//)&&!c.startsWith("data:")&&!c.startsWith("blob:")}function Ke(c){return c.startsWith("http://local-server.furcadia.com:8080/")||c.startsWith("https://terra.furcadia.com/")}function et(c,p){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(u,F,..._){let a=F.toString();return ze(a)?(a=Ze(a,c),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${a}`)):Ke(a)&&(a=Je(a,p),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${a}`)),super.open(u,a,..._)}}}class ge{buffer="";append(p){this.buffer+=p;const n=[];let u;for(;(u=this.buffer.indexOf(`
`))!==-1;){const F=this.buffer.substring(0,u);n.push(F),this.buffer=this.buffer.substring(u+1)}return n}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function tt(){const c={encode:a=>{const e=a.length,i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=a.charCodeAt(s)&255;return i}},p={decode:a=>{if(typeof a=="string")return a;let e;a instanceof Uint8Array?e=a:a instanceof ArrayBuffer?e=new Uint8Array(a):e=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);let i="";const s=e.length,d=32768;for(let f=0;f<s;f+=d){const w=e.subarray(f,Math.min(f+d,s));i+=String.fromCharCode.apply(null,w)}return i}};let n=null,u;window.waitForFurc=new Promise(a=>{u=a});function F(a,e,i){if(!e.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const s=c.encode(e),d=new MessageEvent("message",{data:s,origin:"wss://lightbringer.furcadia.com"});d.tag=i,a.dispatchEvent(d)}function _(a,e,i){if(a.readyState===WebSocket.OPEN){if(!e.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const s=c.encode(e);a.sendTagged?a.sendTagged(s,i):a.send(s)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new ge;_outgoingBuffer=new ge;constructor(e,i){if(super(e,i),e.toString().includes("furcadia")||e.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),n=this;const s=window.Furnarchy;s&&(s.send=(d,f="PLUGIN")=>_(this,d,f),s.inject=(d,f="PLUGIN")=>F(this,d,f),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>u(this))}}send(e){this.sendTagged(e,void 0)}sendTagged(e,i){if(n!==this){super.send(e);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let s=typeof e=="string"?e:p.decode(e);const d=this._outgoingBuffer.append(s);if(d.length===0)return;const f=[];for(let q of d){const h=window.Furnarchy;if(h){const v=await h.processOutgoing(q,i);if(v==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}q=v}f.push(q)}if(f.length===0)return;const w=f.join(`
`)+`
`,M=c.encode(w);super.send(M)}).catch(s=>{console.error("Error in outgoing message queue:",s)})}_hookMessageEvent(e,i){const s=e.tag;this._incomingQueue=this._incomingQueue.then(async()=>{let d=typeof e.data=="string"?e.data:p.decode(e.data);const f=this._incomingBuffer.append(d);if(f.length===0)return;const w=[];for(let v of f){const S=window.Furnarchy;if(S&&v==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),S.notifyLoggedIn()),S){const B=await S.processIncoming(v,s);if(B==null)continue;v=B}w.push(v)}if(w.length===0)return;const M=w.join(`
`)+`
`;let q=M;this.binaryType==="arraybuffer"?q=c.encode(M).buffer:this.binaryType==="blob"&&(q=new Blob([c.encode(M)]));const h=new MessageEvent("message",{data:q,origin:e.origin,source:e.source});i(h)}).catch(d=>{console.error("Error in incoming message queue:",d)})}set onmessage(e){n===this&&e?super.onmessage=i=>{this._hookMessageEvent(i,s=>{e.call(this,s)})}:super.onmessage=e}get onmessage(){return super.onmessage}addEventListener(e,i,s){if(e==="message"&&n===this&&typeof i=="function"){const d=f=>{this._hookMessageEvent(f,w=>{i.call(this,w)})};super.addEventListener(e,d,s);return}super.addEventListener(e,i,s)}}}async function nt(c){const p=await fetch(c);if(!p.ok)throw new Error(`Failed to fetch client script: ${p.statusText}`);let n=await p.text();n=n.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),n=n.replaceAll("WebSocket","FurcWebSocket");const u=document.createElement("script");u.textContent=n,u.async=!0,document.body.appendChild(u)}var at=R('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),st=R('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),ot=R('<div class="plugin-details svelte-a1qo0m"><!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <button class="remove-btn svelte-a1qo0m">Remove Plugin</button></div>'),rt=R('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),it=R('<li class="empty svelte-a1qo0m">No plugins installed</li>'),lt=R('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),ct=R('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function dt(c,p){be(p,!1);const n=()=>Be(fe,"$pluginStore",u),[u,F]=Te(),_=O();let a=O(!1),e=O(""),i=O(null),s=O(!1);pe(()=>{window.Furnarchy||(window.Furnarchy=new He),fe.set(Oe()),window.Furnarchy.onRegister(g=>{const l=g.metadata||g,P=l.sourceUrl||g.sourceUrl;if(P){const L=n().findIndex(k=>k.url===P);if(L!==-1){typeof g._setEnabled=="function"?g._setEnabled(n()[L].enabled!==!1):g.enabled=n()[L].enabled!==!1;let k=!1;const E=n()[L],A={...E};if(E.name||(A.name=l.name,k=!0),l.version&&E.version!==l.version&&(A.version=l.version,k=!0),l.author&&E.author!==l.author&&(A.author=l.author,k=!0),k){const I=[...n()];I[L]=A,Y(I)}}}});const o=window.Furnarchy?.version||"0.0.0";Xe(o).then(()=>{q()})});function d(){C(a,!t(a))}async function f(){if(t(e)&&!n().some(o=>o.url===t(e))){C(s,!0);try{const o=await Ye(t(e)),g=[...n(),{url:t(e),name:o.name,version:o.version,author:o.author,enabled:!0}];Y(g),h(t(e)),C(e,"")}catch(o){alert(`Failed to verify plugin: ${o.message||o}`)}finally{C(s,!1)}}}function w(o){const g=n().filter(l=>l.url!==o);Y(g),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function M(o){const g=n().map(l=>{if(l.url===o){const P=l.enabled===void 0?!1:!l.enabled,L=window.Furnarchy;if(L&&L.plugins){const k=L.plugins.find(E=>E.metadata.sourceUrl===o);k&&(typeof k._setEnabled=="function"?k._setEnabled(P):k.enabled=P)}return{...l,enabled:P}}return l});Y(g)}function q(){n().forEach(o=>h(o.url))}async function h(o){if(!document.querySelector(`script[data-plugin-url="${o}"]`))try{window.Furnarchy.loadingPluginUrl=o;const g=await fetch(o);if(!g.ok)throw new Error(`HTTP ${g.status}`);const l=await g.text(),P=document.createElement("script");P.textContent=l,P.dataset.pluginUrl=o,document.body.appendChild(P),console.log(`[PluginManager] Loaded via fetch: ${o}`)}catch(g){console.warn(`[PluginManager] Fetch failed for ${o}, falling back to script tag.`,g);const l=document.createElement("script");l.src=o,l.async=!0,l.dataset.pluginUrl=o,l.onload=()=>console.log(`[PluginManager] Loaded via tag: ${o}`),l.onerror=()=>console.error(`[PluginManager] Failed to load: ${o}`),document.body.appendChild(l)}finally{window.Furnarchy.loadingPluginUrl=null}}Ee(()=>n(),()=>{C(_,n())}),Ae(),me();var v=ct(),S=b(v),B=m(S,2);{var V=o=>{var g=lt(),l=_e(g),P=m(l,2),L=b(P),k=m(b(L),2);y(L);var E=m(L,2),A=b(E);De(A);var I=m(A,2),we=b(I,!0);y(I),y(E);var Z=m(E,2),oe=b(Z);Ne(oe,1,n,Qe,(W,r)=>{var j=rt();let ie;var J=b(j),le=b(J),Q=b(le);let ce;var z=m(Q,2),Ue=b(z,!0);y(z),y(le),y(J);var Fe=m(J,2);{var qe=K=>{var G=ot(),de=b(G);{var Se=T=>{var H=at(),ne=m(b(H));y(H),D(()=>N(ne,` ${t(r),U(()=>t(r).version)??""}`)),x(T,H)};X(de,T=>{t(r),U(()=>t(r).version)&&T(Se)})}var ue=m(de,2);{var xe=T=>{var H=st(),ne=m(b(H));y(H),D(()=>N(ne,` ${t(r),U(()=>t(r).author)??""}`)),x(T,H)};X(ue,T=>{t(r),U(()=>t(r).author)&&T(xe)})}var ee=m(ue,2),te=m(b(ee),2),Ce=b(te,!0);y(te),y(ee);var Re=m(ee,2);y(G),D(()=>{ae(te,"href",(t(r),U(()=>t(r).url))),N(Ce,(t(r),U(()=>t(r).url)))}),$("click",Re,()=>w(t(r).url)),$("click",G,he(function(T){je.call(this,p,T)})),x(K,G)};X(Fe,K=>{t(i),t(r),U(()=>t(i)===t(r).url)&&K(qe)})}y(j),D(()=>{ie=ve(j,1,"plugin-item svelte-a1qo0m",null,ie,{expanded:t(i)===t(r).url,disabled:t(r).enabled===!1}),ce=ve(Q,1,"toggle-switch svelte-a1qo0m",null,ce,{checked:t(r).enabled!==!1}),ae(Q,"title",(t(r),U(()=>t(r).enabled!==!1?"Disable Plugin":"Enable Plugin"))),ae(z,"title",(t(r),U(()=>t(r).url))),N(Ue,(t(r),U(()=>t(r).name||t(r).url)))}),$("click",Q,he(()=>M(t(r).url))),$("click",j,()=>C(i,t(i)===t(r).url?null:t(r).url)),x(W,j)});var Pe=m(oe,2);{var Le=W=>{var r=it();x(W,r)};X(Pe,W=>{n(),U(()=>n().length===0)&&W(Le)})}y(Z);var re=m(Z,2),ke=m(b(re),4);ke.textContent=`Furnarchy Zero v${U(()=>window.Furnarchy?.version||"...")??""}`,y(re),y(P),D(()=>{A.disabled=t(s),I.disabled=t(s),N(we,t(s)?"...":"Add")}),$("click",l,d),$("click",k,d),Ge(A,()=>t(e),W=>C(e,W)),$("keydown",A,W=>W.key==="Enter"&&!t(s)&&f()),$("click",I,f),x(o,g)};X(B,o=>{t(a)&&o(V)})}y(v),$("click",S,d),x(c,v),ye(),F()}var ut=R('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),ft=R('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),vt=R('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),ht=R('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function Ut(c,p){be(p,!1);const n=se.PUBLIC_FURCADIA_CLIENT_JS_URL,u=se.PUBLIC_AUTH_PROXY_URL,F=se.PUBLIC_PLAY_FURCADIA_URL;let _=O(!1),a=O(""),e=!1;pe(()=>{const v=Ve()||u;console.log(`[Furnarchy] Using backend URL: ${v}`),et(F,v),tt(),i()});async function i(){if(!e){C(_,!0),C(a,"");try{await nt(n),e=!0}catch(h){console.error(h),C(a,h.message||"An unknown error occurred")}finally{C(_,!1)}}}me();var s=ht();Ie("hy9bcf",h=>{var v=ut();Me(6),$e(()=>{We.title="Furnarchy Zero"}),x(h,v)});var d=_e(s);dt(d,{});var f=m(d,2);{var w=h=>{var v=ft();x(h,v)};X(f,h=>{t(_)&&h(w)})}var M=m(f,12);{var q=h=>{var v=vt(),S=b(v),B=b(S);y(S);var V=m(S,2);y(v),D(()=>N(B,`Error: ${t(a)??""}`)),$("click",V,()=>window.location.reload()),x(h,v)};X(M,h=>{t(a)&&h(q)})}x(c,s),ye()}export{Ut as component};
