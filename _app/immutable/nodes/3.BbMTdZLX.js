import{f as C,a as x}from"../chunks/BTCE0DZM.js";import{i as _e}from"../chunks/v9LOXSqa.js";import{o as ye}from"../chunks/Db6ANrXm.js";import{L as we,W as We,X as Te,O as Pe,P as p,y as M,w as N,R as v,x as e,Q as b,M as ke,D as P,N as H,Y as Be,V as Ie,$ as De}from"../chunks/Cg5NIOCX.js";import{e as W,s as O}from"../chunks/oVO9CO60.js";import{i as I,s as He,a as Oe}from"../chunks/BJP9K3nK.js";import{h as Xe}from"../chunks/B_JrXAzN.js";import{p as ge,F as je,g as Ne,h as Z,l as Qe,r as Ye,e as Ve,s as me,d as se,f as pe,k as Ge,i as Ze,b as Je,m as ze,v as Ke,c as oe,a as et}from"../chunks/BfWfghp-.js";function tt(c,_){let n=_;n.endsWith("/")||(n+="/");const f=c.startsWith("/")?c.substring(1):c;return new URL(f,n).toString()}function nt(c,_){const n=new URL(c),f=new URL(_),R=n.pathname.startsWith("/")?n.pathname.substring(1):n.pathname;let F=f.pathname;return F.endsWith("/")||(F+="/"),f.pathname=F+R,f.search=n.search,f.hash=n.hash,f.toString()}function at(c){return!c.match(/^https?:\/\//)&&!c.startsWith("data:")&&!c.startsWith("blob:")}function st(c){return c.startsWith("http://local-server.furcadia.com:8080/")||c.startsWith("https://terra.furcadia.com/")}function ot(c,_){window.FurcXMLHttpRequest=class extends XMLHttpRequest{open(f,R,...F){let a=R.toString();return at(a)?(a=tt(a,c),console.log(`[FurcXMLHttpRequest] Remapped relative URL to: ${a}`)):st(a)&&(a=nt(a,_),console.log(`[FurcXMLHttpRequest] Remapped backend URL to: ${a}`)),super.open(f,a,...F)}}}class be{buffer="";append(_){this.buffer+=_;const n=[];let f;for(;(f=this.buffer.indexOf(`
`))!==-1;){const R=this.buffer.substring(0,f);n.push(R),this.buffer=this.buffer.substring(f+1)}return n}get isEmpty(){return this.buffer.length===0}clear(){this.buffer=""}}function rt(){const c={encode:a=>{const t=a.length,l=new Uint8Array(t);for(let o=0;o<t;o++)l[o]=a.charCodeAt(o)&255;return l}},_={decode:a=>{if(typeof a=="string")return a;let t;a instanceof Uint8Array?t=a:a instanceof ArrayBuffer?t=new Uint8Array(a):t=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);let l="";const o=t.length,d=32768;for(let h=0;h<o;h+=d){const q=t.subarray(h,Math.min(h+d,o));l+=String.fromCharCode.apply(null,q)}return l}};let n=null,f;window.waitForFurc=new Promise(a=>{f=a});function R(a,t,l){if(!t.endsWith(`
`))throw new Error("Furnarchy.inject() requires a complete command (must end with \\n)");const o=c.encode(t),d=new MessageEvent("message",{data:o,origin:"wss://lightbringer.furcadia.com"});d.tag=l,a.dispatchEvent(d)}function F(a,t,l){if(a.readyState===WebSocket.OPEN){if(!t.endsWith(`
`))throw new Error("Furnarchy.send() requires a complete command (must end with \\n)");const o=c.encode(t);a.sendTagged?a.sendTagged(o,l):a.send(o)}}window.FurcWebSocket=class extends WebSocket{_outgoingQueue=Promise.resolve();_incomingQueue=Promise.resolve();_incomingBuffer=new be;_outgoingBuffer=new be;_motdComplete=!1;constructor(t,l){if(super(t,l),t.toString().includes("furcadia")||t.toString().includes("6502")){console.log("%cüòà Game Socket Captured","color: #ff00ff;"),n=this;const o=window.Furnarchy;o&&(o.send=(d,h)=>F(this,d,h),o.inject=(d,h)=>R(this,d,h),console.log("[Furnarchy] Connected to Game Socket")),this.addEventListener("open",()=>f(this))}}send(t){this.sendTagged(t,void 0)}sendTagged(t,l){if(n!==this){super.send(t);return}this._outgoingQueue=this._outgoingQueue.then(async()=>{let o=typeof t=="string"?t:_.decode(t);const d=this._outgoingBuffer.append(o);if(d.length===0)return;const h=[];for(let A of d){const m=window.Furnarchy;if(m){const u=await m.processOutgoing(A,l);if(u==null){console.log("%cüö´ Outgoing Dropped (Furnarchy)","color: gray; font-size: 9px");continue}A=u}h.push(A)}if(h.length===0)return;const q=h.join(`
`)+`
`,T=c.encode(q);super.send(T)}).catch(o=>{console.error("Error in outgoing message queue:",o)})}_hookMessageEvent(t,l){const o=t.tag;this._incomingQueue=this._incomingQueue.then(async()=>{let d=typeof t.data=="string"?t.data:_.decode(t.data);const h=this._incomingBuffer.append(d);if(h.length===0)return;const q=[];for(let u of h){if(!this._motdComplete){u==="Dragonroar"&&(this._motdComplete=!0),q.push(u);continue}const E=window.Furnarchy;if(E&&u==="&&&&&&&&&&&&&"&&(console.log("%cüü¢ Login Detected - Notifying Plugins","color: green;"),E.notifyLoggedIn()),E){const X=await E.processIncoming(u,o);if(X==null)continue;u=X}q.push(u)}if(q.length===0)return;const T=q.join(`
`)+`
`;let A=T;this.binaryType==="arraybuffer"?A=c.encode(T).buffer:this.binaryType==="blob"&&(A=new Blob([c.encode(T)]));const m=new MessageEvent("message",{data:A,origin:t.origin,source:t.source});l(m)}).catch(d=>{console.error("Error in incoming message queue:",d)})}set onmessage(t){n===this&&t?super.onmessage=l=>{this._hookMessageEvent(l,o=>{t.call(this,o)})}:super.onmessage=t}get onmessage(){return super.onmessage}addEventListener(t,l,o){if(t==="message"&&n===this&&typeof l=="function"){const d=h=>{this._hookMessageEvent(h,q=>{l.call(this,q)})};super.addEventListener(t,d,o);return}super.addEventListener(t,l,o)}}}async function it(c){const _=await fetch(c);if(!_.ok)throw new Error(`Failed to fetch client script: ${_.statusText}`);let n=await _.text();n=n.replaceAll("XMLHttpRequest","FurcXMLHttpRequest"),n=n.replaceAll("WebSocket","FurcWebSocket");const f=document.createElement("script");f.textContent=n,f.async=!0,document.body.appendChild(f)}var lt=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">ID:</span> </div>'),ct=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Version:</span> </div>'),dt=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Author:</span> </div>'),ut=C('<div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">Description:</span> </div>'),ft=C('<div class="plugin-details svelte-a1qo0m"><!> <!> <!> <!> <div class="detail-row svelte-a1qo0m"><span class="label svelte-a1qo0m">URL:</span> <a target="_blank" rel="noopener noreferrer" class="url-link svelte-a1qo0m"> </a></div> <button class="remove-btn svelte-a1qo0m">Remove Plugin</button></div>'),vt=C('<li><div class="plugin-header svelte-a1qo0m"><div class="plugin-title-group svelte-a1qo0m"><div></div> <span class="plugin-name svelte-a1qo0m"> </span></div></div> <!></li>'),ht=C('<li class="empty svelte-a1qo0m">No plugins installed</li>'),gt=C('<div class="modal-backdrop svelte-a1qo0m"></div> <div class="modal retro-theme svelte-a1qo0m"><div class="header-row svelte-a1qo0m"><h2 class="svelte-a1qo0m">Plugin Manager</h2> <button class="close-btn svelte-a1qo0m" aria-label="Close">‚úï</button></div> <div class="add-plugin svelte-a1qo0m"><input type="text" placeholder="https://example.com/my-plugin.js" class="svelte-a1qo0m"/> <button class="svelte-a1qo0m"> </button></div> <ul class="plugin-list svelte-a1qo0m"><!> <!></ul> <div class="footer svelte-a1qo0m"><small>Plugins have full access to your game session.</small> <br/> <small></small></div></div>',1),mt=C('<div class="plugin-manager svelte-a1qo0m"><button class="fab svelte-a1qo0m" title="Plugin Manager">‚öôÔ∏è</button> <!></div>');function pt(c,_){we(_,!1);const n=()=>Oe(ge,"$pluginStore",f),[f,R]=He(),F=N();let a=N(!1),t=N(""),l=N(null),o=N(!1);ye(()=>{window.Furnarchy||(window.Furnarchy=new je),ge.set(Ne()),window.Furnarchy.onRegister(g=>{const i=g.metadata||g,y=i.sourceUrl||g.sourceUrl;if(y){const $=n().findIndex(D=>D.url===y);if($!==-1){const D=window.Furnarchy.loadingPluginUrl===y,k=n()[$];let U=!1;const S={...k};if(D){const Q=i.toggle?!1:k.enabled!==!1;g._setEnabled(Q),i.toggle&&k.enabled!==!1&&(S.enabled=!1,U=!0)}else g.enabled!==(k.enabled!==!1)&&(S.enabled=g.enabled,U=!0);if(k.name!==i.name&&(S.name=i.name,U=!0),k.id!==i.id&&(S.id=i.id,U=!0),k.description!==i.description&&(S.description=i.description,U=!0),k.version!==i.version&&(S.version=i.version,U=!0),k.author!==i.author&&(S.author=i.author,U=!0),U){const Q=[...n()];Q[$]=S,Z(Q)}}}});const r=window.Furnarchy?.version||"0.0.0";Qe(r).then(()=>{A()})});function d(){M(a,!e(a))}async function h(){if(e(t)&&!n().some(r=>r.url===e(t))){M(o,!0);try{const r=await Ke(e(t)),g=[...n(),{id:r.id,url:e(t),name:r.name,description:r.description,version:r.version,author:r.author,enabled:r.toggle!==void 0?!r.toggle:!0}];Z(g),m(e(t)),M(t,"")}catch(r){alert(`Failed to verify plugin: ${r.message||r}`)}finally{M(o,!1)}}}function q(r){const g=n().find(y=>y.url===r);g&&g.id&&ze(g.id);const i=n().filter(y=>y.url!==r);Z(i),confirm("Plugin removed. Reload page to take effect?")&&window.location.reload()}function T(r){const g=n().map(i=>{if(i.url===r){const y=i.enabled===void 0?!1:!i.enabled,$=window.Furnarchy;if($&&$.plugins){const D=$.plugins.find(k=>k.metadata.sourceUrl===r);D&&D._setEnabled(y)}return{...i,enabled:y}}return i});Z(g)}function A(){n().forEach(r=>m(r.url))}async function m(r){if(!document.querySelector(`script[data-plugin-url="${r}"]`))try{const g=await fetch(r);if(!g.ok)throw new Error(`HTTP ${g.status}`);const i=await g.text();window.Furnarchy.loadingPluginUrl=r;const y=document.createElement("script");y.textContent=i,y.dataset.pluginUrl=r,document.body.appendChild(y),console.log(`[PluginManager] Loaded via fetch: ${r}`)}catch(g){console.warn(`[PluginManager] Fetch failed for ${r}, falling back to script tag.`,g);const i=document.createElement("script");i.src=r,i.async=!0,i.dataset.pluginUrl=r,i.onload=()=>console.log(`[PluginManager] Loaded via tag: ${r}`),i.onerror=()=>console.error(`[PluginManager] Failed to load: ${r}`),document.body.appendChild(i)}finally{window.Furnarchy.loadingPluginUrl=null}}We(()=>n(),()=>{M(F,n())}),Te(),_e();var u=mt(),E=p(u),X=v(E,2);{var J=r=>{var g=gt(),i=ke(g),y=v(i,2),$=p(y),D=v(p($),2);b($);var k=v($,2),U=p(k);Ye(U);var S=v(U,2),Q=p(S,!0);b(S),b(k);var z=v(k,2),re=p(z);Ve(re,1,n,Ze,(B,s)=>{var Y=vt();let le;var K=p(Y),ce=p(K),V=p(ce);let de;var ee=v(V,2),Fe=p(ee,!0);b(ee),b(ce),b(K);var Se=v(K,2);{var xe=te=>{var G=ft(),ue=p(G);{var Ce=w=>{var L=lt(),j=v(p(L));b(L),H(()=>O(j,` ${e(s),P(()=>e(s).id)??""}`)),x(w,L)};I(ue,w=>{e(s),P(()=>e(s).id)&&w(Ce)})}var fe=v(ue,2);{var Re=w=>{var L=ct(),j=v(p(L));b(L),H(()=>O(j,` ${e(s),P(()=>e(s).version)??""}`)),x(w,L)};I(fe,w=>{e(s),P(()=>e(s).version)&&w(Re)})}var ve=v(fe,2);{var Ae=w=>{var L=dt(),j=v(p(L));b(L),H(()=>O(j,` ${e(s),P(()=>e(s).author)??""}`)),x(w,L)};I(ve,w=>{e(s),P(()=>e(s).author)&&w(Ae)})}var he=v(ve,2);{var Ee=w=>{var L=ut(),j=v(p(L));b(L),H(()=>O(j,` ${e(s),P(()=>e(s).description)??""}`)),x(w,L)};I(he,w=>{e(s),P(()=>e(s).description)&&w(Ee)})}var ne=v(he,2),ae=v(p(ne),2),$e=p(ae,!0);b(ae),b(ne);var Me=v(ne,2);b(G),H(()=>{se(ae,"href",(e(s),P(()=>e(s).url))),O($e,(e(s),P(()=>e(s).url)))}),W("click",Me,()=>q(e(s).url)),W("click",G,pe(function(w){Ge.call(this,_,w)})),x(te,G)};I(Se,te=>{e(l),e(s),P(()=>e(l)===e(s).url)&&te(xe)})}b(Y),H(()=>{le=me(Y,1,"plugin-item svelte-a1qo0m",null,le,{expanded:e(l)===e(s).url,disabled:e(s).enabled===!1}),de=me(V,1,"toggle-switch svelte-a1qo0m",null,de,{checked:e(s).enabled!==!1}),se(V,"title",(e(s),P(()=>e(s).enabled!==!1?"Disable Plugin":"Enable Plugin"))),se(ee,"title",(e(s),P(()=>e(s).url))),O(Fe,(e(s),P(()=>e(s).name||e(s).url)))}),W("click",V,pe(()=>T(e(s).url))),W("click",Y,()=>M(l,e(l)===e(s).url?null:e(s).url)),x(B,Y)});var Le=v(re,2);{var qe=B=>{var s=ht();x(B,s)};I(Le,B=>{n(),P(()=>n().length===0)&&B(qe)})}b(z);var ie=v(z,2),Ue=v(p(ie),4);Ue.textContent=`Furnarchy Zero v${P(()=>window.Furnarchy?.version||"...")??""}`,b(ie),b(y),H(()=>{U.disabled=e(o),S.disabled=e(o),O(Q,e(o)?"...":"Add")}),W("click",i,d),W("click",D,d),Je(U,()=>e(t),B=>M(t,B)),W("keydown",U,B=>B.key==="Enter"&&!e(o)&&h()),W("click",S,h),x(r,g)};I(X,r=>{e(a)&&r(J)})}b(u),W("click",E,d),x(c,u),Pe(),R()}var bt=C('<link rel="stylesheet" type="text/css" href="https://play.furcadia.com/web/furcadia.css?v=a1599e9c4ed5bc2f3aa66c66e96df767"/> <style id="variableCSS"></style> <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" id="viewportTag"/> <meta name="theme-color" content="#392b67"/>',1),_t=C('<div class="loading svelte-hy9bcf"><p>Loading Furcadia Web Client...</p></div>'),yt=C('<div class="error svelte-hy9bcf"><p> </p> <button class="svelte-hy9bcf">Try Again</button></div>'),wt=C('<!> <!> <div id="furcContainer"></div> <div id="firstLoadScene"></div> <div id="modalOverlay"></div> <div id="dialogBox"><div id="dialogText">Would you like to transfer this Ferian Hotdoggen to Dr. Cat?</div> <div id="dialogControls"><button id="dialogButton1" class="svelte-hy9bcf">Yes</button> <button id="dialogButton2" class="svelte-hy9bcf">No</button> <button id="dialogButton3" class="svelte-hy9bcf">Cancel</button></div></div> <div id="pounce" style="display: none"></div> <!>',1);function At(c,_){we(_,!1);const n=oe.PUBLIC_FURCADIA_CLIENT_JS_URL,f=oe.PUBLIC_AUTH_PROXY_URL,R=oe.PUBLIC_PLAY_FURCADIA_URL;let F=N(!1),a=N(""),t=!1;ye(()=>{const u=et()||f;console.log(`[Furnarchy] Using backend URL: ${u}`),ot(R,u),rt(),l()});async function l(){if(!t){M(F,!0),M(a,"");try{await it(n),t=!0}catch(m){console.error(m),M(a,m.message||"An unknown error occurred")}finally{M(F,!1)}}}_e();var o=wt();Xe("hy9bcf",m=>{var u=bt();Ie(6),Be(()=>{De.title="Furnarchy Zero"}),x(m,u)});var d=ke(o);pt(d,{});var h=v(d,2);{var q=m=>{var u=_t();x(m,u)};I(h,m=>{e(F)&&m(q)})}var T=v(h,12);{var A=m=>{var u=yt(),E=p(u),X=p(E);b(E);var J=v(E,2);b(u),H(()=>O(X,`Error: ${e(a)??""}`)),W("click",J,()=>window.location.reload()),x(m,u)};I(T,m=>{e(a)&&m(A)})}x(c,o),Pe()}export{At as component};
